<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  

  
  
  
  
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  

  
  <!-- baidu webmaster push -->
  <script src='//push.zhanzhang.baidu.com/push.js'></script>
<meta name="generator" content="Hexo 5.4.1"></head>
<body class="home blog custom-background custom-font-enabled single-author">
  <div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="Hexo" rel="home">Hexo</a>
      </h1>
      
        <h2 class="site-description hitokoto"></h2>
        <script type="text/javascript" src="https://v1.hitokoto.cn/?encode=js"></script>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Home</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/archives">Archives</a></li>
                
                </ul>
            </div>
    </nav>
</header>

      <div id="main" class="wrapper">
        <div id="primary" class="site-content"><div id="content" role="main">
  
    <article id="post-vue-lifeCycle" class="post-vue-lifeCycle post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/09/03/vue-lifeCycle/">vue-lifeCycle</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/09/03/vue-lifeCycle/" data-id="cl06j26yv0008ac070mpo118q" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">设置当前实例</span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> setActiveInstance(vm: Component) &#123;</span><br><span class="line">  const prevActiveInstance = activeInstance</span><br><span class="line">  activeInstance = vm</span><br><span class="line">  <span class="built_in">return</span> () =&gt; &#123;</span><br><span class="line">    activeInstance = prevActiveInstance</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> initLifecycle (vm: Component) &#123;</span><br><span class="line">  <span class="comment"># 初始化了一系列的值</span></span><br><span class="line">  const options = vm.<span class="variable">$options</span></span><br><span class="line"></span><br><span class="line">  // locate first non-abstract parent</span><br><span class="line">  <span class="built_in">let</span> parent = options.parent</span><br><span class="line">  <span class="keyword">if</span> (parent &amp;&amp; !options.abstract) &#123;</span><br><span class="line">    <span class="keyword">while</span> (parent.<span class="variable">$options</span>.abstract &amp;&amp; parent.<span class="variable">$parent</span>) &#123;</span><br><span class="line">      parent = parent.<span class="variable">$parent</span></span><br><span class="line">    &#125;</span><br><span class="line">    parent.<span class="variable">$children</span>.push(vm)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  vm.<span class="variable">$parent</span> = parent</span><br><span class="line">  vm.<span class="variable">$root</span> = parent ? parent.<span class="variable">$root</span> : vm</span><br><span class="line"></span><br><span class="line">  vm.<span class="variable">$children</span> = []</span><br><span class="line">  vm.<span class="variable">$refs</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  vm._watcher = null</span><br><span class="line">  vm._inactive = null</span><br><span class="line">  vm._directInactive = <span class="literal">false</span></span><br><span class="line">  vm._isMounted = <span class="literal">false</span></span><br><span class="line">  vm._isDestroyed = <span class="literal">false</span></span><br><span class="line">  vm._isBeingDestroyed = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># _update将虚拟dom渲染成实际dom</span></span><br><span class="line">Vue.prototype._update = <span class="keyword">function</span> (vnode: VNode, hydrating?: boolean) &#123;</span><br><span class="line">    const vm: Component = this</span><br><span class="line">    const prevEl = vm.<span class="variable">$el</span></span><br><span class="line">    const prevVnode = vm._vnode</span><br><span class="line">    const restoreActiveInstance = setActiveInstance(vm)</span><br><span class="line">    vm._vnode = vnode</span><br><span class="line">    // Vue.prototype.__patch__ is injected <span class="keyword">in</span> entry points</span><br><span class="line">    // based on the rendering backend used.</span><br><span class="line">    <span class="keyword">if</span> (!prevVnode) &#123;</span><br><span class="line">      // initial render</span><br><span class="line">      vm.<span class="variable">$el</span> = vm.__patch__(vm.<span class="variable">$el</span>, vnode, hydrating, <span class="literal">false</span> /* removeOnly */)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      // updates</span><br><span class="line">      vm.<span class="variable">$el</span> = vm.__patch__(prevVnode, vnode)</span><br><span class="line">    &#125;</span><br><span class="line">    restoreActiveInstance()</span><br><span class="line">    // update __vue__ reference</span><br><span class="line">    <span class="keyword">if</span> (prevEl) &#123;</span><br><span class="line">      prevEl.__vue__ = null</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (vm.<span class="variable">$el</span>) &#123;</span><br><span class="line">      vm.<span class="variable">$el</span>.__vue__ = vm</span><br><span class="line">    &#125;</span><br><span class="line">    // <span class="keyword">if</span> parent is an HOC, update its <span class="variable">$el</span> as well</span><br><span class="line">    <span class="keyword">if</span> (vm.<span class="variable">$vnode</span> &amp;&amp; vm.<span class="variable">$parent</span> &amp;&amp; vm.<span class="variable">$vnode</span> === vm.<span class="variable">$parent</span>._vnode) &#123;</span><br><span class="line">      vm.<span class="variable">$parent</span>.<span class="variable">$el</span> = vm.<span class="variable">$el</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Vue.prototype.<span class="variable">$forceUpdate</span> = <span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">    const vm: Component = this</span><br><span class="line">    <span class="keyword">if</span> (vm._watcher) &#123;</span><br><span class="line">      vm._watcher.update()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Vue.prototype.<span class="variable">$destroy</span> = <span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">    const vm: Component = this</span><br><span class="line">    <span class="keyword">if</span> (vm._isBeingDestroyed) &#123;</span><br><span class="line">      <span class="built_in">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 声明钩子函数</span></span><br><span class="line">    callHook(vm, <span class="string">&#x27;beforeDestroy&#x27;</span>)</span><br><span class="line">    vm._isBeingDestroyed = <span class="literal">true</span></span><br><span class="line">    // remove self from parent</span><br><span class="line">    const parent = vm.<span class="variable">$parent</span></span><br><span class="line">    <span class="comment"># 如果有父级，在父级中移除当前子级</span></span><br><span class="line">    <span class="keyword">if</span> (parent &amp;&amp; !parent._isBeingDestroyed &amp;&amp; !vm.<span class="variable">$options</span>.abstract) &#123;</span><br><span class="line">      remove(parent.<span class="variable">$children</span>, vm)</span><br><span class="line">    &#125;</span><br><span class="line">    // teardown watchers</span><br><span class="line">    <span class="keyword">if</span> (vm._watcher) &#123;</span><br><span class="line">      vm._watcher.teardown()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">let</span> i = vm._watchers.length</span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      vm._watchers[i].teardown()</span><br><span class="line">    &#125;</span><br><span class="line">    // remove reference from data ob</span><br><span class="line">    // frozen object may not have observer.</span><br><span class="line">    <span class="keyword">if</span> (vm._data.__ob__) &#123;</span><br><span class="line">      vm._data.__ob__.vmCount--</span><br><span class="line">    &#125;</span><br><span class="line">    // call the last hook...</span><br><span class="line">    vm._isDestroyed = <span class="literal">true</span></span><br><span class="line">    // invoke destroy hooks on current rendered tree</span><br><span class="line">    vm.__patch__(vm._vnode, null)</span><br><span class="line">    // fire destroyed hook</span><br><span class="line">    callHook(vm, <span class="string">&#x27;destroyed&#x27;</span>)</span><br><span class="line">    // turn off all instance listeners.</span><br><span class="line">    vm.<span class="variable">$off</span>()</span><br><span class="line">    // remove __vue__ reference</span><br><span class="line">    <span class="keyword">if</span> (vm.<span class="variable">$el</span>) &#123;</span><br><span class="line">      vm.<span class="variable">$el</span>.__vue__ = null</span><br><span class="line">    &#125;</span><br><span class="line">    // release circular reference (<span class="comment">#6759)</span></span><br><span class="line">    <span class="keyword">if</span> (vm.<span class="variable">$vnode</span>) &#123;</span><br><span class="line">      vm.<span class="variable">$vnode</span>.parent = null</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">export</span> <span class="keyword">function</span> mountComponent (</span><br><span class="line">  vm: Component,</span><br><span class="line">  el: ?Element,</span><br><span class="line">  hydrating?: boolean</span><br><span class="line">): Component &#123;</span><br><span class="line">  vm.<span class="variable">$el</span> = el</span><br><span class="line">  <span class="keyword">if</span> (!vm.<span class="variable">$options</span>.render) &#123;</span><br><span class="line">    vm.<span class="variable">$options</span>.render = createEmptyVNode</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment"># 这时候还没有进行挂载 </span></span><br><span class="line">callHook(vm, <span class="string">&#x27;beforeMount&#x27;</span>)</span><br><span class="line">  <span class="built_in">let</span> updateComponent</span><br><span class="line">  /* istanbul ignore <span class="keyword">if</span> */</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; config.performance &amp;&amp; mark) &#123;</span><br><span class="line">    updateComponent = () =&gt; &#123;</span><br><span class="line">      const name = vm._name</span><br><span class="line">      const id = vm._uid</span><br><span class="line">      const startTag = `vue-perf-start:<span class="variable">$&#123;id&#125;</span>`</span><br><span class="line">      const endTag = `vue-perf-end:<span class="variable">$&#123;id&#125;</span>`</span><br><span class="line"></span><br><span class="line">      mark(startTag)</span><br><span class="line">      const vnode = vm._render() // 生成虚拟dom</span><br><span class="line">      mark(endTag)</span><br><span class="line">      measure(`vue <span class="variable">$&#123;name&#125;</span> render`, startTag, endTag)</span><br><span class="line"></span><br><span class="line">      mark(startTag)</span><br><span class="line">      vm._update(vnode, hydrating) // 传入虚拟dom,渲染成真正的dom</span><br><span class="line">      mark(endTag)</span><br><span class="line">      measure(`vue <span class="variable">$&#123;name&#125;</span> patch`, startTag, endTag)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    updateComponent = () =&gt; &#123;</span><br><span class="line">      vm._update(vm._render(), hydrating)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># 终于在这看到了 new Watcher的入口，updateComponent是一个函数，_update生成了实际的dom,现在我们到watcher里看看对updateComponent的操作</span></span><br><span class="line"></span><br><span class="line">  new Watcher(vm, updateComponent, noop, &#123;</span><br><span class="line">    <span class="function"><span class="title">before</span></span> () &#123;</span><br><span class="line">      <span class="keyword">if</span> (vm._isMounted &amp;&amp; !vm._isDestroyed) &#123;</span><br><span class="line">        callHook(vm, <span class="string">&#x27;beforeUpdate&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="literal">true</span> /* isRenderWatcher */)</span><br><span class="line">  hydrating = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="variable">$vnode</span> == null) &#123;</span><br><span class="line">    vm._isMounted = <span class="literal">true</span></span><br><span class="line">    callHook(vm, <span class="string">&#x27;mounted&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> vm</span><br><span class="line">&#125;</span><br><span class="line">  </span><br></pre></td></tr></table></figure>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/09/03/vue-lifeCycle/">
    <time datetime="2021-09-03T09:00:57.000Z" class="entry-date">
        2021-09-03
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-自动化生成页面模板" class="post-自动化生成页面模板 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/07/30/%E8%87%AA%E5%8A%A8%E5%8C%96%E7%94%9F%E6%88%90%E9%A1%B5%E9%9D%A2%E6%A8%A1%E6%9D%BF/">自动化生成页面模板</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/07/30/%E8%87%AA%E5%8A%A8%E5%8C%96%E7%94%9F%E6%88%90%E9%A1%B5%E9%9D%A2%E6%A8%A1%E6%9D%BF/" data-id="cl06j26z0000mac07c4zkapos" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>场景 ： 满足新增带修改页面的模板或新增一个单独的vue文件，区分变量 simple<br>使用方法 ：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run bpage src/views/admin/pages/position <span class="built_in">test</span> simple</span><br></pre></td></tr></table></figure>
<p>pageage.json中 scripts 添加命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;bpage&quot;</span>: <span class="string">&quot;node ./src/utils/build-page.js&quot;</span>,</span><br></pre></td></tr></table></figure>
<p>新建build-page.js,写入下面代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">var fs = require(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line">var path = require(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">// 获取要写入的URL</span><br><span class="line"><span class="built_in">let</span> pathUrl = process.argv[2];</span><br><span class="line">// 创建的文件夹的名称</span><br><span class="line"><span class="built_in">let</span> fileName = process.argv[3];</span><br><span class="line">// 是否只创建单页面</span><br><span class="line"><span class="built_in">let</span> simple = process.argv[4];</span><br><span class="line">// 检测path是否以/结尾</span><br><span class="line"><span class="built_in">let</span> regEnd = /\/$/  </span><br><span class="line"><span class="built_in">let</span> regStart = /^\// </span><br><span class="line">// 格式化path 和name，path后面带/，name前面不带/</span><br><span class="line"><span class="built_in">let</span> aPath = regEnd.test(pathUrl) ? pathUrl : pathUrl+<span class="string">&#x27;/&#x27;</span></span><br><span class="line"><span class="built_in">let</span> aName = regStart.test(fileName) ? fileName.slice(1) : fileName</span><br><span class="line">//path.resolve(aPath+aName)获取到的是相对路径，比如在 项目根目录下执行结果为 /User/.../项目根目录/写入的目录</span><br><span class="line"><span class="built_in">let</span> fullPath = path.resolve(aPath+aName)</span><br><span class="line">//文件写入</span><br><span class="line">const fileWrite = <span class="keyword">function</span>(from,to) &#123;</span><br><span class="line">  <span class="built_in">let</span> readable=fs.createReadStream(from,&#123;encoding:<span class="string">&#x27;utf8&#x27;</span>&#125;);</span><br><span class="line">  //simple判断是不是新增一个单独的vue页面（），如果是单独的页面，以to+<span class="string">&#x27;.vue&#x27;</span>创建文件</span><br><span class="line">  <span class="built_in">let</span> writable=simple ? fs.createWriteStream(to+<span class="string">&#x27;.vue&#x27;</span>) : fs.createWriteStream(to);</span><br><span class="line">  readable.pipe(writable);</span><br><span class="line">&#125;</span><br><span class="line">//文件夹写入</span><br><span class="line">const dirWrite = <span class="keyword">function</span>(from,to,callback) &#123;</span><br><span class="line">  //创建新的目录，并执行回调</span><br><span class="line">  fs.mkdir(to,<span class="keyword">function</span>(error)&#123;</span><br><span class="line">    <span class="keyword">if</span>(error)&#123;</span><br><span class="line">        console.log(error);</span><br><span class="line">        <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  callback(from,to);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const copyDir = <span class="keyword">function</span>(from,to) &#123;</span><br><span class="line">  //读取源文件夹，得到的paths是文件的集合</span><br><span class="line">  fs.readdir(from,<span class="keyword">function</span>(err,paths)&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)throw err;</span><br><span class="line">    paths.forEach(pathName =&gt; &#123;</span><br><span class="line">      //获取到文件的路径</span><br><span class="line">      var _copyFrom=from+<span class="string">&#x27;/&#x27;</span>+pathName;</span><br><span class="line">      var _copyTo=to+<span class="string">&#x27;/&#x27;</span>+pathName;</span><br><span class="line">      //判断目标文件是否存在，不存在先创建再写入，存在的话直接写入</span><br><span class="line">      fs.access(_copyTo, fs.constants.F_OK, (err) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123; </span><br><span class="line">          //如果不存在，调用copy  </span><br><span class="line">          copy(_copyFrom,_copyTo,copyDir)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          copyDir(_copyFrom,_copyTo);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const copy = <span class="keyword">function</span> (from ,to ,callback) &#123;</span><br><span class="line">  fs.stat(from ,<span class="keyword">function</span> (err,stats) &#123;</span><br><span class="line">    <span class="keyword">if</span>(stats.isFile()) &#123;</span><br><span class="line">      fileWrite(from ,to)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123; </span><br><span class="line">      dirWrite(from,to,callback)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//components/common/add-page-withedit 下存放的是带修改功能的文件 ，components/common/add-simplepage/index.vue 是单文件</span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> templatePath = !simple ?  <span class="string">&#x27;../components/common/add-page-withedit&#x27;</span> : <span class="string">&#x27;../components/common/add-simplepage/index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line">copy(path.resolve(__dirname,templatePath),fullPath,copyDir)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>




      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/07/30/%E8%87%AA%E5%8A%A8%E5%8C%96%E7%94%9F%E6%88%90%E9%A1%B5%E9%9D%A2%E6%A8%A1%E6%9D%BF/">
    <time datetime="2021-07-30T08:49:41.000Z" class="entry-date">
        2021-07-30
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-vue添加全局水印" class="post-vue添加全局水印 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/07/27/vue%E6%B7%BB%E5%8A%A0%E5%85%A8%E5%B1%80%E6%B0%B4%E5%8D%B0/">vue添加全局水印</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/07/27/vue%E6%B7%BB%E5%8A%A0%E5%85%A8%E5%B1%80%E6%B0%B4%E5%8D%B0/" data-id="cl06j26yw000cac079nai8kz4" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>首先在utils目录下增加watermarkDom文件，文件内容如下,这里因为想达到类似企业微信的水印做了一下修改，增加了str2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;use strict&#x27;</span></span><br><span class="line">import store from <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line">const watermark = &#123;</span><br><span class="line">    <span class="built_in">set</span>: <span class="keyword">function</span> (str, str2) &#123;</span><br><span class="line">        var canvas = document.createElement(<span class="string">&#x27;canvas&#x27;</span>)</span><br><span class="line">        canvas.width = 450;</span><br><span class="line">        canvas.height = 200;</span><br><span class="line">        // canvas.style.display = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">        var shuiyin = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">        // 控制文字的旋转角度和上下位置</span><br><span class="line">        // shuiyin.rotate(-15 * Math.PI / 180);</span><br><span class="line">        // shuiyin.translate(-50, 20)</span><br><span class="line">        //文字颜色</span><br><span class="line">        shuiyin.fillStyle = <span class="string">&quot;rgba(200, 200, 200, 0.2)&quot;</span>;</span><br><span class="line">        //文字样式</span><br><span class="line">        shuiyin.font = <span class="string">&quot;14px Vedana&quot;</span>;</span><br><span class="line">        shuiyin.fillText(str, 0, 50)</span><br><span class="line">        shuiyin.fillText(str2, 220, 150)</span><br><span class="line">        /* 新建一个用于填充canvas水印的标签，之所以没有直接在body上添加，</span><br><span class="line">           是因为z-index对个别内容影响，才考虑的不用body */</span><br><span class="line">        var watermark = document.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">        const styleStr = `</span><br><span class="line">            position:fixed;</span><br><span class="line">            top:-20vh;</span><br><span class="line">            left:-50vw;</span><br><span class="line">            width:200vw;</span><br><span class="line">            height:200vh;</span><br><span class="line">            z-index:99999;</span><br><span class="line">            transform : rotate(-15deg);</span><br><span class="line">            pointer-events:none;</span><br><span class="line">            background-repeat:repeat;</span><br><span class="line">            mix-blend-mode: multiply;</span><br><span class="line">            background-image:url(<span class="string">&#x27;$&#123;canvas.toDataURL(&quot;image/png&quot;)&#125;&#x27;</span>)`;</span><br><span class="line">        watermark.setAttribute(<span class="string">&#x27;style&#x27;</span>, styleStr);</span><br><span class="line">        watermark.classList.add(<span class="string">&#x27;watermark&#x27;</span>)</span><br><span class="line">        document.body.appendChild(watermark)</span><br><span class="line"></span><br><span class="line">        //此方法是防止用户通过控制台修改样式去除水印效果</span><br><span class="line">        /* MutationObserver 是一个可以监听DOM结构变化的接口。 */</span><br><span class="line">        const observer = new MutationObserver(() =&gt; &#123;</span><br><span class="line">            const wmInstance = document.querySelector(<span class="string">&#x27;.watermark&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> ((wmInstance &amp;&amp; wmInstance.getAttribute(<span class="string">&#x27;style&#x27;</span>) !== styleStr) || !wmInstance) &#123;</span><br><span class="line">                //如果标签在，只修改了属性，重新赋值属性</span><br><span class="line">                <span class="keyword">if</span> (wmInstance) &#123;</span><br><span class="line">                    // 避免一直触发</span><br><span class="line">                    // observer.disconnect();</span><br><span class="line">                    // console.log(<span class="string">&#x27;水印属性修改了&#x27;</span>);</span><br><span class="line">                    wmInstance.setAttribute(<span class="string">&#x27;style&#x27;</span>, styleStr);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    /* 此处根据用户登录状态，判断是否终止监听，避免用户退出后登录页面仍然有水印 */</span><br><span class="line">                    <span class="keyword">if</span> (store.state.user.token) &#123;</span><br><span class="line">                        //标签被移除，重新添加标签</span><br><span class="line">                        console.log(<span class="string">&#x27;水印标签被移除了&#x27;</span>);</span><br><span class="line">                        document.body.appendChild(watermark)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        observer.disconnect();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        observer.observe(document.body, &#123;</span><br><span class="line">            attributes: <span class="literal">true</span>,</span><br><span class="line">            subtree: <span class="literal">true</span>,</span><br><span class="line">            childList: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    close: <span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">        /* 关闭页面的水印，即要移除水印标签 */</span><br><span class="line">        <span class="built_in">let</span> watermark = document.querySelector(<span class="string">&#x27;.watermark&#x27;</span>)</span><br><span class="line">        document.body.removeChild(watermark)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">export</span> default watermark</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在获取用户信息接口中，调用watermark.set()，接口调用完之后，页面会出现水印</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/07/27/vue%E6%B7%BB%E5%8A%A0%E5%85%A8%E5%B1%80%E6%B0%B4%E5%8D%B0/">
    <time datetime="2021-07-27T02:27:53.000Z" class="entry-date">
        2021-07-27
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-Vue" class="post-Vue post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/07/08/Vue/">Vue</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/07/08/Vue/" data-id="cl06j26ys0001ac071tw41xm4" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>inheritAttrs: false, //一个没见过的</p>
<p>接下来，按我的理解来理一下vue实现的过程<br>首先打开项目node_modules的vue/src/core/index.js,从这可以看到，入口文件是’instance/index’,</p>
<p>执行了[initGlobalAPI(Vue)]</p>
<p>进到 instance/index中，这个文件对Vue做了一系列的初始化</p>
<p>首先执行this._init(options)，所以先看init.js 文件</p>
<p>我在一个页面打印 console.log(this, this.constructor, “this”);打印出的结果如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> VueComponent (options) &#123;</span><br><span class="line">      this._init(options);</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<p>这段代码在Vue.extend中找到了，可见后面创建的页面应该是通过Vue.extend创建的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> resolveConstructorOptions (Ctor: Class&lt;Component&gt;) &#123;</span><br><span class="line">  <span class="built_in">let</span> options = Ctor.options</span><br><span class="line">  <span class="keyword">if</span> (Ctor.super) &#123;</span><br><span class="line">    // 通过Vue.extend 生成的实例会有super属性，</span><br><span class="line">    const superOptions = resolveConstructorOptions(Ctor.super)</span><br><span class="line">    const cachedSuperOptions = Ctor.superOptions</span><br><span class="line">    <span class="keyword">if</span> (superOptions !== cachedSuperOptions) &#123;</span><br><span class="line">      // super option changed,</span><br><span class="line">      // need to resolve new options.</span><br><span class="line">      Ctor.superOptions = superOptions</span><br><span class="line">      // check <span class="keyword">if</span> there are any late-modified/attached options (<span class="comment">#4976)</span></span><br><span class="line">      const modifiedOptions = resolveModifiedOptions(Ctor)</span><br><span class="line">      // update base extend options</span><br><span class="line">      <span class="keyword">if</span> (modifiedOptions) &#123;</span><br><span class="line">        extend(Ctor.extendOptions, modifiedOptions)</span><br><span class="line">      &#125;</span><br><span class="line">      options = Ctor.options = mergeOptions(superOptions, Ctor.extendOptions)</span><br><span class="line">      <span class="keyword">if</span> (options.name) &#123;</span><br><span class="line">        options.components[options.name] = Ctor</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> options</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Vue.use</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> toArray (list, start) &#123;</span><br><span class="line">  start = start || 0;</span><br><span class="line">  var i = list.length - start;</span><br><span class="line">  var ret = new Array(i);</span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    ret[i] = list[i + start];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Vue.use = <span class="keyword">function</span> (plugin) &#123;</span><br><span class="line">   var installedPlugins = (this._installedPlugins || (this._installedPlugins = []));</span><br><span class="line">   <span class="keyword">if</span> (installedPlugins.indexOf(plugin) &gt; -1) &#123;</span><br><span class="line">     <span class="built_in">return</span> this</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   // additional parameters</span><br><span class="line">   var args = toArray(arguments, 1);</span><br><span class="line">   args.unshift(this);</span><br><span class="line">   <span class="keyword">if</span> (typeof plugin.install === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">     plugin.install.apply(plugin, args);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeof plugin === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">     plugin.apply(null, args);</span><br><span class="line">   &#125;</span><br><span class="line">   installedPlugins.push(plugin);</span><br><span class="line">   <span class="built_in">return</span> this</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>

<h2 id="optionMergeStrategies"><a href="#optionMergeStrategies" class="headerlink" title="optionMergeStrategies"></a>optionMergeStrategies</h2><p>在vue/src/core/config.js中有一段代码,约定optionMergeStrategies是有一个个函数组成的对象</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="built_in">type</span> Config = &#123;</span><br><span class="line">    optionMergeStrategies: &#123; [key: string]: Function &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面代码是默认合并策略，优先取子级，没有的话取父级</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var defaultStrat = <span class="keyword">function</span> (parentVal, childVal) &#123;</span><br><span class="line">  <span class="built_in">return</span> childVal === undefined</span><br><span class="line">    ? parentVal</span><br><span class="line">    : childVal</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="el，propsData"><a href="#el，propsData" class="headerlink" title="el，propsData"></a>el，propsData</h3><p>el，propsData采用默认合并</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const strats = config.optionMergeStrategies = Object.create(null);</span><br><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">  strats.el = strats.propsData = <span class="keyword">function</span> (parent, child, vm, key) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!vm) &#123;</span><br><span class="line">      warn<span class="variable">$1</span>(</span><br><span class="line">        <span class="string">&quot;option \&quot;&quot;</span> + key + <span class="string">&quot;\&quot; can only be used during instance &quot;</span> +</span><br><span class="line">        <span class="string">&#x27;creation with the `new` keyword.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> defaultStrat(parent, child)</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="data"><a href="#data" class="headerlink" title="data"></a>data</h3><p>在!vm情况下，子级不存在，取父级，否则mergeDataOrFn合并，vm存在，mergeDataOrFn合并，参数增加vm</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">strats.data = <span class="keyword">function</span> (</span><br><span class="line">  parentVal,</span><br><span class="line">  childVal,</span><br><span class="line">  vm</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!vm) &#123;</span><br><span class="line">    <span class="keyword">if</span> (childVal &amp;&amp; typeof childVal !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; warn<span class="variable">$1</span>(</span><br><span class="line">        <span class="string">&#x27;The &quot;data&quot; option should be a function &#x27;</span> +</span><br><span class="line">        <span class="string">&#x27;that returns a per-instance value in component &#x27;</span> +</span><br><span class="line">        <span class="string">&#x27;definitions.&#x27;</span>,</span><br><span class="line">        vm</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="built_in">return</span> parentVal</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> mergeDataOrFn(parentVal, childVal)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> mergeDataOrFn(parentVal, childVal, vm)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>看下mergeDataOrFn是什么<br>在没有vm时，return mergedDataFn，else return mergedInstanceDataFn,这里有个区别parentVal.call(this, this)和parentVal.call(vm, vm)，这两个函数都返回mergeData（child,parent）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> mergeDataOrFn (</span><br><span class="line">  parentVal,</span><br><span class="line">  childVal,</span><br><span class="line">  vm</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!vm) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!childVal) &#123;</span><br><span class="line">      <span class="built_in">return</span> parentVal</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!parentVal) &#123;</span><br><span class="line">      <span class="built_in">return</span> childVal</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> <span class="keyword">function</span> <span class="function"><span class="title">mergedDataFn</span></span> () &#123;</span><br><span class="line">      <span class="built_in">return</span> mergeData(</span><br><span class="line">        typeof childVal === <span class="string">&#x27;function&#x27;</span> ? childVal.call(this, this) : childVal,</span><br><span class="line">        typeof parentVal === <span class="string">&#x27;function&#x27;</span> ? parentVal.call(this, this) : parentVal</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">return</span> <span class="keyword">function</span> <span class="function"><span class="title">mergedInstanceDataFn</span></span> () &#123;</span><br><span class="line">      // instance merge</span><br><span class="line">      var instanceData = typeof childVal === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? childVal.call(vm, vm)</span><br><span class="line">        : childVal;</span><br><span class="line">      var defaultData = typeof parentVal === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? parentVal.call(vm, vm)</span><br><span class="line">        : parentVal;</span><br><span class="line">      <span class="keyword">if</span> (instanceData) &#123;</span><br><span class="line">        <span class="built_in">return</span> mergeData(instanceData, defaultData)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">return</span> defaultData</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>接下来看mergeData,如果子级没有key,则把父级的key给子级赋值，如果父级和子级都是对象，则调用mergeData，最终作用就是把父级有，子级没有的拷贝，其他不做处理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> mergeData (to, from) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!from) &#123; <span class="built_in">return</span> to &#125;</span><br><span class="line">  var key, toVal, fromVal;</span><br><span class="line">  var keys = Object.keys(from);</span><br><span class="line">  <span class="keyword">for</span> (var i = 0; i &lt; keys.length; i++) &#123;</span><br><span class="line">    key = keys[i];</span><br><span class="line">    toVal = to[key];</span><br><span class="line">    fromVal = from[key];</span><br><span class="line">    <span class="keyword">if</span> (!hasOwn(to, key)) &#123;</span><br><span class="line">      <span class="built_in">set</span>(to, key, fromVal);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isPlainObject(toVal) &amp;&amp; isPlainObject(fromVal)) &#123;</span><br><span class="line">      mergeData(toVal, fromVal);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> to</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="hooks钩子"><a href="#hooks钩子" class="headerlink" title="hooks钩子"></a>hooks钩子</h3><p>子级存在，如果父级存在，使用concat将子级合并到父级数组里，如果不存在，判断子级是不是数组，如果是返回子级，否，返回[ 子级 ]<br>子级不存在，返回父级</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var LIFECYCLE_HOOKS = [<span class="string">&#x27;beforeCreate&#x27;</span>,<span class="string">&#x27;created&#x27;</span>,<span class="string">&#x27;beforeMount&#x27;</span>,<span class="string">&#x27;mounted&#x27;</span>,<span class="string">&#x27;beforeUpdate&#x27;</span>,<span class="string">&#x27;updated&#x27;</span>,<span class="string">&#x27;beforeDestroy&#x27;</span>,<span class="string">&#x27;destroyed&#x27;</span>,<span class="string">&#x27;activated&#x27;</span>,<span class="string">&#x27;deactivated&#x27;</span>,<span class="string">&#x27;errorCaptured&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> mergeHook (</span><br><span class="line">  parentVal: ?Array&lt;Function&gt;,</span><br><span class="line">  childVal: ?Function | ?Array&lt;Function&gt;</span><br><span class="line">): ?Array&lt;Function&gt; &#123;</span><br><span class="line">  <span class="built_in">return</span> childVal</span><br><span class="line">    ? parentVal</span><br><span class="line">      ? parentVal.concat(childVal)</span><br><span class="line">      : Array.isArray(childVal)</span><br><span class="line">        ? childVal</span><br><span class="line">        : [childVal]</span><br><span class="line">    : parentVal</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LIFECYCLE_HOOKS.forEach(hook =&gt; &#123;</span><br><span class="line">  strats[hook] = mergeHook</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="components-directives-filters"><a href="#components-directives-filters" class="headerlink" title="components,directives,filters"></a>components,directives,filters</h3><p>extend函数就是一个复制的函数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">var ASSET_TYPES = [</span><br><span class="line">  <span class="string">&#x27;component&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;directive&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;filter&#x27;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> assertObjectType (name, value, vm) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!isPlainObject(value)) &#123;</span><br><span class="line">    warn<span class="variable">$1</span>(</span><br><span class="line">      <span class="string">&quot;Invalid value for option \&quot;&quot;</span> + name + <span class="string">&quot;\&quot;: expected an Object, &quot;</span> +</span><br><span class="line">      <span class="string">&quot;but got &quot;</span> + (toRawType(value)) + <span class="string">&quot;.&quot;</span>,</span><br><span class="line">      vm</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> extend (to, _from) &#123;</span><br><span class="line">  <span class="keyword">for</span> (var key <span class="keyword">in</span> _from) &#123;</span><br><span class="line">    to[key] = _from[key];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> to</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> mergeAssets (</span><br><span class="line">  parentVal,</span><br><span class="line">  childVal,</span><br><span class="line">  vm,</span><br><span class="line">  key</span><br><span class="line">) &#123;</span><br><span class="line">  var res = Object.create(parentVal || null); //新建一个以父级为原型的函数</span><br><span class="line">  <span class="keyword">if</span> (childVal) &#123;</span><br><span class="line">    //如果子级有值，就把子级的值复制到res中，childVal必须是一个对象，否则报错</span><br><span class="line">    process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; assertObjectType(key, childVal, vm);</span><br><span class="line">    <span class="built_in">return</span> extend(res, childVal)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ASSET_TYPES.forEach(<span class="keyword">function</span> (<span class="built_in">type</span>) &#123;</span><br><span class="line">  strats[<span class="built_in">type</span> + <span class="string">&#x27;s&#x27;</span>] = mergeAssets;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h3><p>返回ret:{key:[…parent,…child]},每个key的值最后都是一个数组，这个数组里面注册着父子中定义的所有同属性的回调函数。而且执行顺序是父亲先孩子后</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">strats.watch = <span class="keyword">function</span> (</span><br><span class="line">  parentVal,</span><br><span class="line">  childVal,</span><br><span class="line">  vm,</span><br><span class="line">  key</span><br><span class="line">) &#123;</span><br><span class="line">  //看不懂</span><br><span class="line">  <span class="keyword">if</span> (parentVal === nativeWatch) &#123; parentVal = undefined; &#125;</span><br><span class="line">  <span class="keyword">if</span> (childVal === nativeWatch) &#123; childVal = undefined; &#125;</span><br><span class="line">  //子级不存在，以父级为原型创建对象</span><br><span class="line">  <span class="keyword">if</span> (!childVal) &#123; <span class="built_in">return</span> Object.create(parentVal || null) &#125;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    assertObjectType(key, childVal, vm);</span><br><span class="line">  &#125;</span><br><span class="line">  //父级不存在，直接返回子级</span><br><span class="line">  <span class="keyword">if</span> (!parentVal) &#123; <span class="built_in">return</span> childVal &#125;</span><br><span class="line">  //都存在的情况，首先将父级的值复制到ret中</span><br><span class="line">  var ret = &#123;&#125;;</span><br><span class="line">  extend(ret, parentVal);</span><br><span class="line">  <span class="keyword">for</span> (var key<span class="variable">$1</span> <span class="keyword">in</span> childVal) &#123;</span><br><span class="line">    //遍历子级元素，如果父级有值（不是数组就使用[]进行包装），最后使用concat合并子级，否则返回子级</span><br><span class="line">    var parent = ret[key<span class="variable">$1</span>];</span><br><span class="line">    var child = childVal[key<span class="variable">$1</span>];</span><br><span class="line">    <span class="keyword">if</span> (parent &amp;&amp; !Array.isArray(parent)) &#123;</span><br><span class="line">      parent = [parent];</span><br><span class="line">    &#125;</span><br><span class="line">    ret[key<span class="variable">$1</span>] = parent</span><br><span class="line">      ? parent.concat(child)</span><br><span class="line">      : Array.isArray(child) ? child : [child];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> ret</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="props-methods-inject-computed"><a href="#props-methods-inject-computed" class="headerlink" title="props ,methods,inject,computed"></a>props ,methods,inject,computed</h3><p> extend(ret, parentVal),extend(ret, childVal)，将父级子级分别复制到ret中，返回ret，子组件会覆盖父组件的值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">strats.props =</span><br><span class="line">strats.methods =</span><br><span class="line">strats.inject =</span><br><span class="line">strats.computed = <span class="keyword">function</span> (</span><br><span class="line">  parentVal,</span><br><span class="line">  childVal,</span><br><span class="line">  vm,</span><br><span class="line">  key</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">if</span> (childVal &amp;&amp; process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    assertObjectType(key, childVal, vm);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!parentVal) &#123; <span class="built_in">return</span> childVal &#125;</span><br><span class="line">  var ret = Object.create(null);</span><br><span class="line">  extend(ret, parentVal);</span><br><span class="line">  <span class="keyword">if</span> (childVal) &#123; extend(ret, childVal); &#125;</span><br><span class="line">  <span class="built_in">return</span> ret</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="provide"><a href="#provide" class="headerlink" title="provide"></a>provide</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strats.provide = mergeDataOrFn;</span><br></pre></td></tr></table></figure>

<h3 id="看下strats是什么"><a href="#看下strats是什么" class="headerlink" title="看下strats是什么"></a>看下strats是什么</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const options = &#123;&#125;</span><br><span class="line"><span class="built_in">let</span> key</span><br><span class="line"><span class="keyword">for</span> (key <span class="keyword">in</span> parent) &#123;</span><br><span class="line">  mergeField(key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (key <span class="keyword">in</span> child) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!hasOwn(parent, key)) &#123;</span><br><span class="line">    mergeField(key)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> mergeField (key) &#123;</span><br><span class="line">  const strat = strats[key] || defaultStrat</span><br><span class="line">  options[key] = strat(parent[key], child[key], vm, key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">return</span> option</span><br></pre></td></tr></table></figure>
<h3 id="mergeOptions"><a href="#mergeOptions" class="headerlink" title="mergeOptions"></a>mergeOptions</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> mergeOptions (</span><br><span class="line">  parent: Object,</span><br><span class="line">  child: Object,</span><br><span class="line">  vm?: Component</span><br><span class="line">): Object &#123;</span><br><span class="line">  //检测子级是不是组件</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    checkComponents(child)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 在global-api.js中，Vue.options = Object.create(null) 有对options进行初始化</span><br><span class="line">  <span class="keyword">if</span> (typeof child === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    child = child.options</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  normalizeProps(child, vm)</span><br><span class="line">  normalizeInject(child, vm)</span><br><span class="line">  normalizeDirectives(child)</span><br><span class="line">  //没看懂</span><br><span class="line">  <span class="keyword">if</span> (!child._base) &#123;</span><br><span class="line">    <span class="keyword">if</span> (child.extends) &#123;</span><br><span class="line">      parent = mergeOptions(parent, child.extends, vm)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (child.mixins) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">let</span> i = 0, l = child.mixins.length; i &lt; l; i++) &#123;</span><br><span class="line">        parent = mergeOptions(parent, child.mixins[i], vm)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const options = &#123;&#125;</span><br><span class="line">  <span class="built_in">let</span> key</span><br><span class="line">  <span class="keyword">for</span> (key <span class="keyword">in</span> parent) &#123;</span><br><span class="line">    mergeField(key)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (key <span class="keyword">in</span> child) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!hasOwn(parent, key)) &#123;</span><br><span class="line">      mergeField(key)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> mergeField (key) &#123;</span><br><span class="line">    const strat = strats[key] || defaultStrat</span><br><span class="line">    options[key] = strat(parent[key], child[key], vm, key)</span><br><span class="line">  &#125;</span><br><span class="line">  /**</span><br><span class="line">  strats[key]是特定的策略合并函数，如果没有，就使用默认的策略合并函数</span><br><span class="line">  options[key] 是执行特定策略函数得到的结果</span><br><span class="line">  mergeOptions的作用 : 如果child有extends或mixins，合并得到新的parent，</span><br><span class="line">  声明一个options为空对象，遍历parent，执行mergeField(key)，就是得到这个key的策略合并函数，并将执行结果赋值给options【key】 </span><br><span class="line">  如果parent已经存在key，child 就不调用，避免重复调用</span><br><span class="line">  最终的接口就是options将parent和child的key进行合并</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line">  <span class="built_in">return</span> options</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>normalizeProps做的事情，检测props是不是数组，是数组的话说明存的是prop的名字，使用camelize(val)转驼峰，结果为[name]:{ type: null };<br>如果props是个对象，遍历，检测prop是不是对象，不是的话转为对象[name]:{type:val},是的话不做处理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> normalizeProps (options: Object, vm: ?Component) &#123;</span><br><span class="line">  const props = options.props</span><br><span class="line">  <span class="keyword">if</span> (!props) <span class="built_in">return</span></span><br><span class="line">  const res = &#123;&#125;</span><br><span class="line">  <span class="built_in">let</span> i, val, name</span><br><span class="line">  <span class="keyword">if</span> (Array.isArray(props)) &#123;</span><br><span class="line">    i = props.length</span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      val = props[i]</span><br><span class="line">      <span class="keyword">if</span> (typeof val === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        name = camelize(val)</span><br><span class="line">        res[name] = &#123; <span class="built_in">type</span>: null &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">        warn(<span class="string">&#x27;props must be strings when using array syntax.&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isPlainObject(props)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (const key <span class="keyword">in</span> props) &#123;</span><br><span class="line">      val = props[key]</span><br><span class="line">      name = camelize(key)</span><br><span class="line">      res[name] = isPlainObject(val)</span><br><span class="line">        ? val</span><br><span class="line">        : &#123; <span class="built_in">type</span>: val &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">   ...</span><br><span class="line">  &#125;</span><br><span class="line">  options.props = res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>normalizeInject做的事情，定义normalized={},如果options.inject是个数组，normalized[name]= {from:name},如果inject是个对象，判断每一项的值是不是对象，如果是对象，合并{from:key}和val，最后得到的是normalized[name]={from:key, …val},如果val是简单类型的值，得到normalized[name] = {from:val}</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> normalizeInject (options: Object, vm: ?Component) &#123;</span><br><span class="line">  const inject = options.inject</span><br><span class="line">  <span class="keyword">if</span> (!inject) <span class="built_in">return</span></span><br><span class="line">  const normalized = options.inject = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (Array.isArray(inject)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">let</span> i = 0; i &lt; inject.length; i++) &#123;</span><br><span class="line">      normalized[inject[i]] = &#123; from: inject[i] &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isPlainObject(inject)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (const key <span class="keyword">in</span> inject) &#123;</span><br><span class="line">      const val = inject[key]</span><br><span class="line">      normalized[key] = isPlainObject(val)</span><br><span class="line">        ? extend(&#123; from: key &#125;, val)</span><br><span class="line">        : &#123; from: val &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    warn(</span><br><span class="line">      `Invalid value <span class="keyword">for</span> option <span class="string">&quot;inject&quot;</span>: expected an Array or an Object, ` +</span><br><span class="line">      `but got <span class="variable">$&#123;toRawType(inject)&#125;</span>.`,</span><br><span class="line">      vm</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>normalizeDirectives做的事情，转换成对象，就是把val 转换成 {bind:val,update:val}</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> normalizeDirectives (options: Object) &#123;</span><br><span class="line">  const <span class="built_in">dirs</span> = options.directives</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">dirs</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (const key <span class="keyword">in</span> <span class="built_in">dirs</span>) &#123;</span><br><span class="line">      const def = <span class="built_in">dirs</span>[key]</span><br><span class="line">      <span class="keyword">if</span> (typeof def === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">dirs</span>[key] = &#123; <span class="built_in">bind</span>: def, update: def &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="nextTick"><a href="#nextTick" class="headerlink" title="$nextTick"></a>$nextTick</h2><p>在下次dom更新之后执行回调，确保拿到的是dom最新的值 因为dom是异步更新</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/07/08/Vue/">
    <time datetime="2021-07-08T02:22:40.000Z" class="entry-date">
        2021-07-08
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-浏览器" class="post-浏览器 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/07/07/%E6%B5%8F%E8%A7%88%E5%99%A8/">浏览器</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/07/07/%E6%B5%8F%E8%A7%88%E5%99%A8/" data-id="cl06j26yz000jac075dlk7vp0" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="URLSearchParams"><a href="#URLSearchParams" class="headerlink" title="URLSearchParams"></a>URLSearchParams</h2><p>浏览器内置链接参数操作工具 </p>
<p>如何使用？<br><img src="/2021/07/07/%E6%B5%8F%E8%A7%88%E5%99%A8/URLSP"></p>
<p>判断某一参数是否存在</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchParams.has(<span class="string">&#x27;processInstanceId&#x27;</span>) &gt; <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>get 获取参数的值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchParams.get(<span class="string">&#x27;processInstanceId&#x27;</span>) &gt; 37749504</span><br></pre></td></tr></table></figure>
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/07/07/%E6%B5%8F%E8%A7%88%E5%99%A8/">
    <time datetime="2021-07-07T08:39:16.000Z" class="entry-date">
        2021-07-07
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-axios学习笔记" class="post-axios学习笔记 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">axios学习笔记</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="cl06j26yt0003ac074gp4b8t2" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h1 id="查找入口文件"><a href="#查找入口文件" class="headerlink" title="查找入口文件"></a>查找入口文件</h1><p><img src="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/package.png"></p>
<h1 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h1><p><img src="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/indexjs.png"></p>
<h1 id="找到lib-axios-js"><a href="#找到lib-axios-js" class="headerlink" title="找到lib/axios.js"></a>找到lib/axios.js</h1><p>为了避免迷糊，先放一段defaultConfig的伪代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> defaultConfig = &#123;</span><br><span class="line">      baseURL,</span><br><span class="line">      timeout: TIMEOUT_MILLISECONDS,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      params: payLoadParams</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>进入文件倒数第二行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">module.exports = axios;</span><br></pre></td></tr></table></figure>
<p>可知axios文件输出axios，axios = createInstance(defaults)，看下createInstance内部做了什么</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> createInstance(defaultConfig) &#123;</span><br><span class="line">  var context = new Axios(defaultConfig);</span><br><span class="line">  var instance = <span class="built_in">bind</span>(Axios.prototype.request, context);</span><br><span class="line">  utils.extend(instance, Axios.prototype, context);</span><br><span class="line">  utils.extend(instance, context);</span><br><span class="line">   <span class="built_in">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解释一下上面的代码 ： </p>
<p>第一行： var context = new Axios(defaultConfig),</p>
<p>得到结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">context = &#123;</span><br><span class="line">  default:defaultConfig,</span><br><span class="line">  interceptors: &#123;</span><br><span class="line">    request :  new InterCeptorManager(),</span><br><span class="line">    responese : new InterCeptorManager(),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二行： var instance = bind(Axios.prototype.request, context);<br>先看下bind方法<br><img src="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/bind.png"><br>bind方法返回一个wrap函数，并将wrap的参数传给外层函数fn,绑定上下文context<br>执行结果为</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">instance = <span class="keyword">function</span> <span class="function"><span class="title">wrap</span></span>() &#123;</span><br><span class="line">  ... </span><br><span class="line">  <span class="built_in">return</span> Axios.prototype.request.apply(thisArg, args)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 调用instance，返回Axios.prototype.request的执行结果，并将调用instance的参数作为axios.prototype.request执行的传参</span></span><br></pre></td></tr></table></figure>
<p>第三行：utils.extend(instance, Axios.prototype, context);<br>看下extend方法<br><img src="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/extend.png"><br>代码逻辑为 ： 遍历Axios.prototype ，因为Axios.prototype上有方法request，getUri,delete,get,head,options,post,put,patch,直接执行if代码块，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">instance[<span class="string">&#x27;get&#x27;</span>] = <span class="built_in">bind</span>(Axios.prototype.get,context)</span><br><span class="line"><span class="comment"># instance.get(url,config)相当于 Axios.prototype.get(url,config)</span></span><br></pre></td></tr></table></figure>
<p>第四行：<br>utils.extend(instance, context);<br>只有两个参数，说明是要instance 复制context的属性 ， 根据上面代码所得到的context可知，<br>会得到一下结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">instance.default = context.default;</span><br><span class="line">instance.interceptor = context.interceptor;</span><br></pre></td></tr></table></figure>
<p>现在的instance 已经拥有了Axios.prototype和context的属性和方法，通过调用createInstance返回,赋值给axios。</p>
<p>可以看到context是Axios的实例，Axios 是核心 </p>
<h3 id="进入Axios-js"><a href="#进入Axios-js" class="headerlink" title="进入Axios.js"></a>进入Axios.js</h3><p> 看下Axios.prototype.request做了些什么<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (typeof config === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">   config = arguments[1] || &#123;&#125;;</span><br><span class="line">   config.url = arguments[0];</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   config = config || &#123;&#125;;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment"># 这段代码是为了支持axios(url,config)</span></span><br><span class="line"></span><br><span class="line"> config = mergeConfig(this.defaults, config);</span><br><span class="line"> <span class="comment">#  参数中config是指调用比如axios.get(condig = &#123;&#125;)的参数</span></span><br><span class="line"></span><br><span class="line"> config.method = config.method ? config.method.toLowerCase() : <span class="string">&#x27;get&#x27;</span>;</span><br><span class="line"> <span class="comment"># 指定methods或默认get</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># ！！！这儿是重点，dispatchRequest会在接下来介绍</span></span><br><span class="line"> var chain = [dispatchRequest, undefined];</span><br><span class="line"> var promise = Promise.resolve(config); <span class="comment"># 可以使用promise.then</span></span><br><span class="line"> this.interceptors.request.forEach(<span class="keyword">function</span> unshiftRequestInterceptors(interceptor) &#123;</span><br><span class="line">   chain.unshift(interceptor.fulfilled, interceptor.rejected);</span><br><span class="line"> &#125;);</span><br><span class="line"> <span class="comment"># use和forEach的代码在下面， 遍历handlers，如果值存在，就执行unshiftRequestInterceptors，参数是我们使用this.interceptors.request.use传入的值， 在chain从开始处插入interceptor.fulfilled, interceptor.rejected</span></span><br><span class="line"></span><br><span class="line"> this.interceptors.response.forEach(<span class="keyword">function</span> pushResponseInterceptors(interceptor) &#123;</span><br><span class="line">   chain.push(interceptor.fulfilled, interceptor.rejected);</span><br><span class="line"> &#125;);</span><br><span class="line"> <span class="comment"># 同上，执行pushResponseInterceptors，在chain结尾处插入interceptor.fulfilled, interceptor.rejected，此时，chain = [interceptor.fulfilled(request), interceptor.rejected(request),dispatchRequest,undefined,interceptor.fulfilled, interceptor.rejected],</span></span><br><span class="line"> <span class="keyword">while</span> (chain.length) &#123;</span><br><span class="line">   promise = promise.then(chain.shift(), chain.shift());</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment"># 首先取出index = 0,1位置的request fulfilled和rejected执行，因为是promise是链式操作，所以第一个 chain.shift() 执行要返回config作为下一步传参，第二个 chain.shift是处理异常</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 定义Axios.prototype上的方法，可以通过axios[method](url,config)来调用</span></span><br><span class="line"> utils.forEach([<span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;head&#x27;</span>, <span class="string">&#x27;options&#x27;</span>], <span class="keyword">function</span> forEachMethodNoData(method) &#123;</span><br><span class="line">   Axios.prototype[method] = <span class="keyword">function</span>(url, config) &#123;</span><br><span class="line">     <span class="built_in">return</span> this.request(utils.merge(config || &#123;&#125;, &#123;</span><br><span class="line">       method: method,</span><br><span class="line">       url: url</span><br><span class="line">     &#125;));</span><br><span class="line">   &#125;;</span><br><span class="line"> &#125;);</span><br><span class="line"></span><br><span class="line"> utils.forEach([<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;put&#x27;</span>, <span class="string">&#x27;patch&#x27;</span>], <span class="keyword">function</span> forEachMethodWithData(method) &#123;</span><br><span class="line">   Axios.prototype[method] = <span class="keyword">function</span>(url, data, config) &#123;</span><br><span class="line">     <span class="built_in">return</span> this.request(utils.merge(config || &#123;&#125;, &#123;</span><br><span class="line">       method: method,</span><br><span class="line">       url: url,</span><br><span class="line">       data: data</span><br><span class="line">     &#125;));</span><br><span class="line">   &#125;;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="跳出Axios-js"><a href="#跳出Axios-js" class="headerlink" title="跳出Axios.js"></a>跳出Axios.js</h3><h3 id="请求和返回的拦截都用到了new-InterceptorManager（），-接下来看下InterceptorManager-构造函数都做了什么"><a href="#请求和返回的拦截都用到了new-InterceptorManager（），-接下来看下InterceptorManager-构造函数都做了什么" class="headerlink" title="请求和返回的拦截都用到了new InterceptorManager（）， 接下来看下InterceptorManager 构造函数都做了什么"></a>请求和返回的拦截都用到了new InterceptorManager（）， 接下来看下InterceptorManager 构造函数都做了什么</h3><h4 id="lib-core-InterceptorManager-js-【"><a href="#lib-core-InterceptorManager-js-【" class="headerlink" title="lib/core/InterceptorManager.js 【"></a>lib/core/InterceptorManager.js 【</h4> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">function</span> <span class="function"><span class="title">InterceptorManager</span></span>() &#123;</span><br><span class="line">  this.handlers = [];</span><br><span class="line">  <span class="comment"># 定义一个数组用来存放数据</span></span><br><span class="line">  InterceptorManager.prototype.use = <span class="keyword">function</span> use(fulfilled, rejected) &#123;</span><br><span class="line">  this.handlers.push(&#123;</span><br><span class="line">    fulfilled: fulfilled,</span><br><span class="line">    rejected: rejected</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">return</span> this.handlers.length - 1;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment"># 我们在项目里的写法是instance.interceptors.request.use((config) =&gt; &#123; return config&#125;) ; instance.interceptors.response.use((response) =&gt; &#123; return response&#125;,err =&gt; &#123;...&#125;) ,fulfilled, rejected分别是成功回调，失败回调,use返回值为数组最后一项，即新添加进来的回调对象</span></span><br><span class="line">  InterceptorManager.prototype.forEach = <span class="keyword">function</span> forEach(fn) &#123;</span><br><span class="line">    utils.forEach(this.handlers, <span class="keyword">function</span> forEachHandler(h) &#123;</span><br><span class="line">      <span class="keyword">if</span> (h !== null) &#123;</span><br><span class="line">        fn(h);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="跳出InterceptorManager-js-】"><a href="#跳出InterceptorManager-js-】" class="headerlink" title="跳出InterceptorManager.js  】"></a>跳出InterceptorManager.js  】</h4><h4 id="dispatchRequest-【"><a href="#dispatchRequest-【" class="headerlink" title="dispatchRequest 【"></a>dispatchRequest 【</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">throwIfCancellationRequested(config);</span><br><span class="line"><span class="comment"># 如果设置了config.cancelToken，且有中断原因，抛出</span></span><br><span class="line"><span class="keyword">if</span> (config.baseURL &amp;&amp; !isAbsoluteURL(config.url)) &#123;</span><br><span class="line">  config.url = combineURLs(config.baseURL, config.url);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#  如果URL不是绝对路径，合并url</span></span><br><span class="line">config.headers = config.headers || &#123;&#125;;</span><br><span class="line">config.data = transformData(</span><br><span class="line">    config.data,</span><br><span class="line">    config.headers,</span><br><span class="line">    config.transformRequest</span><br><span class="line">  );</span><br><span class="line">config.headers = utils.merge(</span><br><span class="line">    config.headers.common || &#123;&#125;,</span><br><span class="line">    config.headers[config.method] || &#123;&#125;,</span><br><span class="line">    config.headers || &#123;&#125;</span><br><span class="line">  ); </span><br><span class="line">  <span class="comment"># 合并request config传入的headers.common和headers[&#x27;method&#x27;]，headers</span></span><br><span class="line">  utils.forEach(</span><br><span class="line">    [<span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;head&#x27;</span>, <span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;put&#x27;</span>, <span class="string">&#x27;patch&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">    <span class="keyword">function</span> cleanHeaderConfig(method) &#123;</span><br><span class="line">      delete config.headers[method];</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  <span class="comment"># 因为已经将 config.headers[method]的值合并到config.headers ,所以删除config.headers[method]，避免出现config.headers.get 依然存在的现象</span></span><br><span class="line"></span><br><span class="line"> var adapter = config.adapter || defaults.adapter; <span class="comment"># </span></span><br><span class="line"> <span class="comment"># adapter后面会介绍default.js文件会介绍</span></span><br><span class="line"> <span class="built_in">return</span> adapter(config).<span class="keyword">then</span>(response =&gt; &#123;</span><br><span class="line">  根据transformResponse对response.data 进行转换 </span><br><span class="line">  <span class="built_in">return</span> response </span><br><span class="line"> &#125;,err =&gt; &#123;</span><br><span class="line"></span><br><span class="line"> &#125;)</span><br><span class="line"><span class="comment">#  config是从interceptor.resolve() return出来的，adapter(config)会发送请求，定义response，通过return new Promise((resolve) =&gt; &#123;resolve(response)&#125;)</span></span><br><span class="line"><span class="comment">#  将response返回给后面的链接</span></span><br></pre></td></tr></table></figure>
<h4 id="跳出dispatchRequest】"><a href="#跳出dispatchRequest】" class="headerlink" title="跳出dispatchRequest】"></a>跳出dispatchRequest】</h4><p>接着看axios.js中的代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var axios = createInstance(defaults);</span><br><span class="line">axios.Axios = Axios;</span><br><span class="line">axios.Cancel = require(<span class="string">&#x27;./cancel/Cancel&#x27;</span>);</span><br><span class="line">axios.CancelToken = require(<span class="string">&#x27;./cancel/CancelToken&#x27;</span>);</span><br><span class="line">axios.isCancel = require(<span class="string">&#x27;./cancel/isCancel&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>defaults就是defaultConfig，defaults引自require(‘./defaults’) ，</p>
<h3 id="进入axios-lib-defaults-js【"><a href="#进入axios-lib-defaults-js【" class="headerlink" title="进入axios/lib/defaults.js【"></a>进入axios/lib/defaults.js【</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">var DEFAULT_CONTENT_TYPE = &#123;</span><br><span class="line">  <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line">default = &#123;</span><br><span class="line">  <span class="comment"># 适配器。代码在下面</span></span><br><span class="line">  adapter : getDefaultAdapter(),</span><br><span class="line">  transformRequest:[f()], <span class="comment"># 这两个我还没看懂是怎么个用法</span></span><br><span class="line">  transformResponse:[f()],</span><br><span class="line">  timeout：0,</span><br><span class="line">  xsrfCookieName: <span class="string">&#x27;XSRF-TOKEN&#x27;</span>,</span><br><span class="line">  xsrfHeaderName: <span class="string">&#x27;X-XSRF-TOKEN&#x27;</span>,</span><br><span class="line">  maxContentLength: -1,</span><br><span class="line">  validateStatus: <span class="keyword">function</span> validateStatus(status) &#123;</span><br><span class="line">    <span class="built_in">return</span> status &gt;= 200 &amp;&amp; status &lt; 300;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># 响应状态</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getDefaultAdapter</span></span>() &#123;</span><br><span class="line">  var adapter;</span><br><span class="line">  <span class="comment"># adapter适配器，根据nodejs 和浏览器环境，分别使用http 和xhr进行请求</span></span><br><span class="line">  <span class="keyword">if</span> (typeof process !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; Object.prototype.toString.call(process) === <span class="string">&#x27;[object process]&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment"># For node use HTTP adapter</span></span><br><span class="line">    adapter = require(<span class="string">&#x27;./adapters/http&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeof XMLHttpRequest !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment"># For browsers use XHR adapter</span></span><br><span class="line">    adapter = require(<span class="string">&#x27;./adapters/xhr&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> adapter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defaults.headers = &#123;</span><br><span class="line">  common: &#123;</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">utils.forEach([<span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;head&#x27;</span>], <span class="keyword">function</span> forEachMethodNoData(method) &#123;</span><br><span class="line">  defaults.headers[method] = &#123;&#125;;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment"># &#x27;delete&#x27;, &#x27;get&#x27;, &#x27;head&#x27;为&#123;&#125;</span></span><br><span class="line"></span><br><span class="line">utils.forEach([<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;put&#x27;</span>, <span class="string">&#x27;patch&#x27;</span>], <span class="keyword">function</span> forEachMethodWithData(method) &#123;</span><br><span class="line">  defaults.headers[method] = utils.merge(DEFAULT_CONTENT_TYPE);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment"># post , put,patch 默认请求头为&#123;&#x27;Content-Type&#x27;: &#x27;application/x-www-form-urlencoded&#x27;&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>着重看下adapter = require(‘./adapters/xhr’);</p>
<h4 id="进入axios-lib-adapters-xhr-js【"><a href="#进入axios-lib-adapters-xhr-js【" class="headerlink" title="进入axios/lib/adapters/xhr.js【"></a>进入axios/lib/adapters/xhr.js【</h4><p>xhrAdapter 返回一个promise函数，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">var requestData = config.data;</span><br><span class="line"><span class="keyword">if</span> (utils.isFormData(requestData)) &#123;</span><br><span class="line">  delete requestHeaders[<span class="string">&#x27;Content-Type&#x27;</span>];</span><br><span class="line">  <span class="comment"># 如果是FormData格式，删除Content-Type，由浏览器赋值</span></span><br><span class="line">&#125;</span><br><span class="line">var request = new XMLHttpRequest();</span><br><span class="line"><span class="comment"># XMLHttpRequest在其他文章里可以查看，是浏览器内置构造函数</span></span><br><span class="line"><span class="comment"># open方法三个参数分别为：请求方法,url,是否异步</span></span><br><span class="line">request.open(config.method.toUpperCase(), buildURL(config.url, config.params, config.paramsSerializer), <span class="literal">true</span>);</span><br><span class="line">var responseHeaders = <span class="string">&#x27;getAllResponseHeaders&#x27;</span> <span class="keyword">in</span> request ? parseHeaders(request.getAllResponseHeaders()) : null;</span><br><span class="line">var responseData = !config.responseType || config.responseType === <span class="string">&#x27;text&#x27;</span> ? request.responseText : request.response;</span><br><span class="line">request.onreadystatechange = <span class="function"><span class="title">f</span></span>()&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment"># 定义了response</span></span><br><span class="line">  var response = &#123;</span><br><span class="line">    data: responseData,</span><br><span class="line">    status: request.status,</span><br><span class="line">    statusText: request.statusText,</span><br><span class="line">    headers: responseHeaders,</span><br><span class="line">    config: config,</span><br><span class="line">    request: request</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">settle(resolve, reject, response);</span><br><span class="line"><span class="comment"># 设置响应状态，是resolve(response) 还是抛出异常，settle代码在下面</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#处理请求并抛出异常，将request设为null</span></span><br><span class="line">request.onabort  = f()</span><br><span class="line">request.onerror  = f()</span><br><span class="line">request.ontimeout  = f() </span><br><span class="line"></span><br><span class="line"><span class="comment">#用户设置config.cancelToken，来中断请求</span></span><br><span class="line"><span class="keyword">if</span> (config.cancelToken) &#123;</span><br><span class="line">// Handle cancellation</span><br><span class="line">  config.cancelToken.promise.then(<span class="keyword">function</span> onCanceled(cancel) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!request) &#123;</span><br><span class="line">      <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request.abort();</span><br><span class="line">    reject(cancel);</span><br><span class="line">    // Clean up request</span><br><span class="line">    request = null;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#发送请求</span></span><br><span class="line">request.send(requestData); </span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">module.exports = <span class="keyword">function</span> settle(resolve, reject, response) &#123;</span><br><span class="line">  var validateStatus = response.config.validateStatus;</span><br><span class="line">  <span class="keyword">if</span> (!validateStatus || validateStatus(response.status)) &#123;</span><br><span class="line">    resolve(response);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject(createError(</span><br><span class="line">      <span class="string">&#x27;Request failed with status code &#x27;</span> + response.status,</span><br><span class="line">      response.config,</span><br><span class="line">      null,</span><br><span class="line">      response.request,</span><br><span class="line">      response</span><br><span class="line">    ));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/response.png"><br>可以看到request.onreadystatechange 里面定义了response的内容，和接口返回的response是一样的构造,然后根据response.connfig.validateStatus(status &gt;= 200 &amp;&amp; status &lt; 300)设置响应状态是resolve(response) 还是报错</p>
<h4 id="跳出xhr-js】"><a href="#跳出xhr-js】" class="headerlink" title="跳出xhr.js】"></a>跳出xhr.js】</h4><h3 id="跳出default-js】"><a href="#跳出default-js】" class="headerlink" title="跳出default.js】"></a>跳出default.js】</h3><p>接着看axios.js中的代码<br>在代码中，出现Cancel，CancelToken，isCancel，首先我们进入文件看下这三个到底是什么<br>cancel是一个相对简单的类，是用于抛出取消请求返回的信息<br><img src="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/cancel.png"><br>cancelToken是可用于请求取消操作的对象。<br><img src="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/cancelToken.png"><br>首先cancelToken的参数executor必须是一个函数，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var resolvePromise;</span><br><span class="line">this.promise = new Promise(<span class="keyword">function</span> promiseExecutor(resolve) &#123;</span><br><span class="line">  resolvePromise = resolve;</span><br><span class="line">&#125;);</span><br><span class="line">executor(<span class="keyword">function</span> cancel(message) &#123;</span><br><span class="line">    <span class="keyword">if</span> (token.reason) &#123;</span><br><span class="line">      // Cancellation has already been requested</span><br><span class="line">      <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    token.reason = new Cancel(message); = &#123;message : <span class="string">&#x27;...&#x27;</span>&#125;</span><br><span class="line">    resolvePromise(token.reason);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>使得resolve可以在外部被执行,resolvePromise().then，下面代码摘自xhr.js,<br>当config.cancelToken为true，通过 request.abort()终止请求，并且抛出终止信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (config.cancelToken) &#123;</span><br><span class="line">  // Handle cancellation</span><br><span class="line">  config.cancelToken.promise.then(<span class="keyword">function</span> onCanceled(cancel) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!request) &#123;</span><br><span class="line">      <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request.abort();</span><br><span class="line">    reject(cancel);</span><br><span class="line">    // Clean up request</span><br><span class="line">    request = null;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>config.cancelToken.promise.then()要求用户设置config.cancelToken 必须是CancelToken的实例，才能调用promise,所以</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> cancel </span><br><span class="line">config.cancelToken = new cancelToken(<span class="keyword">function</span> e(c) &#123;</span><br><span class="line">  cancel = c</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在接口被第一次请求的时候，用cancel保存中止函数，当需要进行中止操作，比如重复请求，调用cancel</p>
<p>一般我们应用的场景是当在接口还没返回，重复请求，取消之前请求，保留最后一个请求，如何做到判断一个接口还没请求完，开始了第二次请求</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
    <time datetime="2021-06-29T08:38:00.000Z" class="entry-date">
        2021-06-29
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-XMLHttpRequest" class="post-XMLHttpRequest post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/06/16/XMLHttpRequest/">XMLHttpRequest</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/06/16/XMLHttpRequest/" data-id="cl06j26yt0002ac070cfm6gqf" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>概念：浏览器通过XMLHttpRequest对象进行http通信，换句话说，我们通过XMLHttpRequest对象来发送Ajax请求</p>
<p>详解地址 (<a target="_blank" rel="noopener" href="https://www.w3school.com.cn/xmldom/dom_http.asp">https://www.w3school.com.cn/xmldom/dom_http.asp</a>)</p>
<p>如何判断某网站应用了http/2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">    // 保证这个方法只在支持loadTimes的chrome浏览器下执行</span><br><span class="line">    <span class="keyword">if</span>(window.chrome &amp;&amp; typeof chrome.loadTimes === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        var loadTimes = window.chrome.loadTimes();</span><br><span class="line">        var spdy = loadTimes.wasFetchedViaSpdy;</span><br><span class="line">        var info = loadTimes.npnNegotiatedProtocol || loadTimes.connectionInfo;</span><br><span class="line">        // 就以 「h2」作为判断标识</span><br><span class="line">        <span class="keyword">if</span>(spdy &amp;&amp; /^h2/i.test(info)) &#123;</span><br><span class="line">            <span class="built_in">return</span> console.info(<span class="string">&#x27;本站点使用了HTTP/2&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    console.warn(<span class="string">&#x27;本站点没有使用HTTP/2&#x27;</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>


      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/06/16/XMLHttpRequest/">
    <time datetime="2021-06-16T09:31:21.000Z" class="entry-date">
        2021-06-16
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-String" class="post-String post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/05/13/String/">String</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/05/13/String/" data-id="cl06j26yp0000ac077o1tbtyk" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="replace-用于在字符串中用一些字符替换另一些字符，或替换一个与正则表达式匹配的子串"><a href="#replace-用于在字符串中用一些字符替换另一些字符，或替换一个与正则表达式匹配的子串" class="headerlink" title="replace 用于在字符串中用一些字符替换另一些字符，或替换一个与正则表达式匹配的子串"></a>replace 用于在字符串中用一些字符替换另一些字符，或替换一个与正则表达式匹配的子串</h2><p>举例：根据分号进行换行（还有就是小程序中要用text才能实现换行效果）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str.replace(/\；/g,`</span><br><span class="line">          `)</span><br></pre></td></tr></table></figure>
<p>replace中的第一个数是正则时，第二个参数可以使一个函数，接受多个参数，<br>第一个参数是捕捉到的内容<br>第二个参数是捕捉到的组匹配<br>倒数第二个参数是匹配到的index<br>倒数第一个参数是字符串</p>
<h2 id="substr-截取字符串-str-substr-index-length-包含index位置"><a href="#substr-截取字符串-str-substr-index-length-包含index位置" class="headerlink" title="substr 截取字符串 str.substr(index,length),包含index位置"></a>substr 截取字符串 str.substr(index,length),包含index位置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> str = <span class="string">&#x27;01234&#x27;</span></span><br><span class="line">str.substr(0，2) // <span class="string">&#x27;01&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="String-fromCodePoint-返回码点对应自符"><a href="#String-fromCodePoint-返回码点对应自符" class="headerlink" title="String.fromCodePoint() 返回码点对应自符"></a>String.fromCodePoint() 返回码点对应自符</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String.fromCodePoint(97) //a </span><br></pre></td></tr></table></figure>
<h2 id="codePointAt是fromCodePoint的逆操作"><a href="#codePointAt是fromCodePoint的逆操作" class="headerlink" title="codePointAt是fromCodePoint的逆操作"></a>codePointAt是fromCodePoint的逆操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;abc&#x27;</span>.codePointAt(0)</span><br></pre></td></tr></table></figure>
<h2 id="repeat-将字符串重复几次"><a href="#repeat-将字符串重复几次" class="headerlink" title="repeat 将字符串重复几次"></a>repeat 将字符串重复几次</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var str = <span class="string">&quot;Runoob&quot;</span>;</span><br><span class="line">str.repeat(2);</span><br></pre></td></tr></table></figure>
<h2 id="startsWith"><a href="#startsWith" class="headerlink" title="startsWith"></a>startsWith</h2><h2 id="endsWith"><a href="#endsWith" class="headerlink" title="endsWith"></a>endsWith</h2>
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/05/13/String/">
    <time datetime="2021-05-13T13:54:33.000Z" class="entry-date">
        2021-05-13
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-文本溢出" class="post-文本溢出 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/04/15/%E6%96%87%E6%9C%AC%E6%BA%A2%E5%87%BA/">文本溢出</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/04/15/%E6%96%87%E6%9C%AC%E6%BA%A2%E5%87%BA/" data-id="cl06j26yz000iac0710s79a0t" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="显示两行"><a href="#显示两行" class="headerlink" title="显示两行"></a>显示两行</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">overflow: hidden;</span><br><span class="line">text-overflow: ellipsis; //自适应布局：链接</span><br><span class="line">display: -webkit-box;</span><br><span class="line">-webkit-line-clamp: 2;</span><br><span class="line">-webkit-box-orient: vertical;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">overflow: hidden;</span><br><span class="line">text-overflow: ellipsis; </span><br><span class="line">white-space:nowrap;</span><br></pre></td></tr></table></figure>




      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/04/15/%E6%96%87%E6%9C%AC%E6%BA%A2%E5%87%BA/">
    <time datetime="2021-04-15T02:44:16.000Z" class="entry-date">
        2021-04-15
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/css/" rel="tag">css</a></li></ul>

    </footer>
</article>






  
    <article id="post-vue中input使用回车键第一次进入页面的时候总会刷新页面" class="post-vue中input使用回车键第一次进入页面的时候总会刷新页面 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/04/12/vue%E4%B8%ADinput%E4%BD%BF%E7%94%A8%E5%9B%9E%E8%BD%A6%E9%94%AE%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%BF%9B%E5%85%A5%E9%A1%B5%E9%9D%A2%E7%9A%84%E6%97%B6%E5%80%99%E6%80%BB%E4%BC%9A%E5%88%B7%E6%96%B0%E9%A1%B5%E9%9D%A2/">vue中input使用回车键第一次进入页面的时候总会刷新页面</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/04/12/vue%E4%B8%ADinput%E4%BD%BF%E7%94%A8%E5%9B%9E%E8%BD%A6%E9%94%AE%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%BF%9B%E5%85%A5%E9%A1%B5%E9%9D%A2%E7%9A%84%E6%97%B6%E5%80%99%E6%80%BB%E4%BC%9A%E5%88%B7%E6%96%B0%E9%A1%B5%E9%9D%A2/" data-id="cl06j26yw000bac07fn2k9rce" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>背景 ：当页面只有一个input时，第一次进入页面（不包含在本页面进行刷新操作），input使用回车键总会刷新页面，不会执行搜索</p>
<p>原因 ： 在form 中，当只有一个input，回车键会自动触发页面的提交</p>
<p>解决方法 ： 在form表单增加@submit.native.prevent（@submit: 表单提交，.native 绑定系统原生事件，.prevent 提交以后不刷新页面）</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/04/12/vue%E4%B8%ADinput%E4%BD%BF%E7%94%A8%E5%9B%9E%E8%BD%A6%E9%94%AE%E7%AC%AC%E4%B8%80%E6%AC%A1%E8%BF%9B%E5%85%A5%E9%A1%B5%E9%9D%A2%E7%9A%84%E6%97%B6%E5%80%99%E6%80%BB%E4%BC%9A%E5%88%B7%E6%96%B0%E9%A1%B5%E9%9D%A2/">
    <time datetime="2021-04-12T08:48:26.000Z" class="entry-date">
        2021-04-12
    </time>
</a>
    
    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
</article>






  
  
    <nav id="pagination">
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &amp;raquo;</a>
      </nav>
    </nav>
  

</div></div>
        <div id="secondary" class="widget-area" role="complementary">
  
    <aside id="search" class="widget widget_search"><form role="search" method="get" accept-charset="utf-8" id="searchform" class="searchform" action="//google.com/search">
    <div>
        <input type="text" value="" name="s" id="s" />
        <input type="submit" id="searchsubmit" value="搜索" />
    </div>
</form></aside>
  
    
  
    
  
    
  <aside class="widget">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-content">
      <ul>
        
          <li>
            <a href="/2022/02/25/uniapp%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/">uniapp遇到的问题</a>
          </li>
        
          <li>
            <a href="/2022/02/25/%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/">遇到的问题</a>
          </li>
        
          <li>
            <a href="/2021/11/06/%E7%BC%96%E7%A8%8B%E9%A2%98/">编程题</a>
          </li>
        
          <li>
            <a href="/2021/09/17/webpack/">webpack</a>
          </li>
        
          <li>
            <a href="/2021/09/07/vue-observer/">vue-observer</a>
          </li>
        
      </ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-content">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-content tagcloud">
      <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/vue/" style="font-size: 10px;">vue</a>
    </div>
  </aside>

  
</div>
      </div>
      <footer id="colophon" role="contentinfo">
    <p>&copy; 2022 John Doe
    All rights reserved.</p>
    <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</footer>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/js/share.js'];</script>

<script src="/js/jquery-3.3.1.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


<script src="/js/navigation.js"></script>

<div id="bg"></div>

  </div>
</body>
</html>