<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  

  
  
  
  
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  

  
  <!-- baidu webmaster push -->
  <script src='//push.zhanzhang.baidu.com/push.js'></script>
<meta name="generator" content="Hexo 5.4.1"></head>
<body class="home blog custom-background custom-font-enabled single-author">
  <div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="Hexo" rel="home">Hexo</a>
      </h1>
      
        <h2 class="site-description hitokoto"></h2>
        <script type="text/javascript" src="https://v1.hitokoto.cn/?encode=js"></script>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Home</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/archives">Archives</a></li>
                
                </ul>
            </div>
    </nav>
</header>

      <div id="main" class="wrapper">
        <div id="primary" class="site-content"><div id="content" role="main">
  
    <article id="post-编程题" class="post-编程题 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/11/06/%E7%BC%96%E7%A8%8B%E9%A2%98/">编程题</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/11/06/%E7%BC%96%E7%A8%8B%E9%A2%98/" data-id="cl023jlke000lh107aocid8od" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>使用Math.max()进行排序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> arr = [1,2,4,5,3,5,66,3,32,23232,4545,66,7,11]</span><br><span class="line"><span class="built_in">let</span> newArr  = [];</span><br><span class="line"><span class="keyword">function</span> sliceArr (arr) &#123;</span><br><span class="line">    const index = arr.findIndex(item =&gt;item ===Math.max(...arr));</span><br><span class="line">    newArr.unshift(arr[index])</span><br><span class="line">    arr.splice(index,1)</span><br><span class="line">    arr.length &amp;&amp; sliceArr(arr);</span><br><span class="line">    <span class="built_in">return</span> newArr</span><br><span class="line">&#125;</span><br><span class="line">const res = sliceArr(arr)</span><br></pre></td></tr></table></figure>
<p>1.快速排序<br>原理：取中间数作为基准值，其他值与这个数进行对比，如果小于，则塞入left数组，大于塞入right数组，递归，直到所有的数组剩下一个值，返回</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> quickSort (arr) &#123;</span><br><span class="line">    <span class="keyword">if</span>(arr.length &lt;= 1) &#123;</span><br><span class="line">        <span class="built_in">return</span> arr</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">let</span> index = Math.floor(arr.length/2)</span><br><span class="line">    <span class="built_in">let</span> current = arr.splice(index,1)[0];</span><br><span class="line">    <span class="built_in">let</span> left = [];</span><br><span class="line">    <span class="built_in">let</span> right = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">let</span> i =0;i&lt;arr.length;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[i] &lt; current) &#123;</span><br><span class="line">            left.push(arr[i])</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            right.push(arr[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="built_in">return</span> quickSort(left).concat([current],quickSort(right))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> res = quickSort([1,3,5,3,2,7,78,65,54,78,90,4,55,5677])</span><br><span class="line">console.log(res,<span class="string">&#x27;ressss&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>2.冒泡排序<br>是由两层循环嵌套，每执行一轮内层的循环，都会把最大的值放到数组的最后，所以下一次循环，就会截取arr.length-i-1进行循环</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> pup(arr) &#123;</span><br><span class="line">  <span class="keyword">for</span> ( <span class="built_in">let</span> i =0;i&lt;arr.length-1;i++) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">let</span> j = 0;j&lt;arr.length-i-1;j++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[j] &gt; arr[j+1]) &#123;</span><br><span class="line">            <span class="built_in">let</span> temp = arr[j];</span><br><span class="line">            arr[j] = arr[j+1]</span><br><span class="line">            arr[j+1] = temp</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> arr</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> res = pup([8,5,4,6,74,54,3232,5545,545,55])</span><br><span class="line">console.log(res,<span class="string">&#x27;resss&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>3.选择排序<br>每次循环里层的时候，找到最小的值的index,对minIndex进行重新赋值，并换位置，使得最小的值总是被提到最前面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> func(arr) &#123;</span><br><span class="line">    <span class="built_in">let</span> minIndex, temp;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">let</span> i = 0; i &lt; arr.length; i++) &#123;</span><br><span class="line">        minIndex = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">let</span> j = i + 1; j &lt; arr.length; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[j] &lt; arr[minIndex]) &#123;</span><br><span class="line">                minIndex = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        temp = arr[i];</span><br><span class="line">        arr[i] = arr[minIndex]</span><br><span class="line">        arr[minIndex] = temp</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> arr</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> res = func([23, 4, 6, 7, 4, 3, 434, 545, 65, 6565, 434, 45])</span><br><span class="line">console.log(res, <span class="string">&#x27;resss&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>4.url拆解问题</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> url = <span class="string">&#x27;http://sample.com/?a=1&amp;e&amp;b=2&amp;c=xx&amp;d#hash&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> fuc(url) &#123;</span><br><span class="line">    <span class="built_in">let</span> obj = &#123;&#125;</span><br><span class="line">    <span class="built_in">let</span> query = url.split(<span class="string">&#x27;?&#x27;</span>)[1].split(<span class="string">&#x27;#&#x27;</span>)[0].split(<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line">    query.forEach(item =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (item.split(<span class="string">&#x27;=&#x27;</span>)[1]) &#123;</span><br><span class="line">            obj[item.split(<span class="string">&#x27;=&#x27;</span>)[0]] = item.split(<span class="string">&#x27;=&#x27;</span>)[1]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">return</span> obj</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> res = fuc(url)</span><br><span class="line">console.log(res, <span class="string">&#x27;ressss&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>5.数组扁平化<br>原地解法： 首选这种</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.flat(3)  // 3代表递归的层数</span><br></pre></td></tr></table></figure>
<p>第一种方法 ： 递归方式实现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> arr = [1, 2, 3, [3, 4, 5], [7, 6, 4]]</span><br><span class="line"><span class="built_in">let</span> newArr = []</span><br><span class="line"><span class="keyword">function</span> func(arr) &#123;</span><br><span class="line">    arr.forEach(item =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (Array.isArray(item)) &#123;</span><br><span class="line">            func(item)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newArr.push(item)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">func(arr)</span><br><span class="line">console.log(newArr, <span class="string">&#x27;newArr&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>第二种方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String(arr).split(<span class="string">&#x27;,&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>第三种</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> flatten(arr) &#123;</span><br><span class="line">    <span class="keyword">while</span>(arr.some(item =&gt; Array.isArray(item))) &#123;</span><br><span class="line">        console.log(arr)</span><br><span class="line">        arr = [].concat(...arr)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> arr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6.深拷贝<br>第一种：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JSON.parse(JSON.stringify(copyObj))</span><br></pre></td></tr></table></figure>
<p>第二种</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> deepClone(obj) &#123;</span><br><span class="line">    <span class="keyword">if</span>(Object.prototype.toString.call(obj)!=<span class="string">&#x27;[object Object]&#x27;</span></span><br><span class="line">     &amp;&amp; Object.prototype.toString.call(obj)!=<span class="string">&#x27;[object Array]&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">return</span> obj</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">let</span> res </span><br><span class="line">    <span class="keyword">if</span>(obj instanceof Array ) &#123;</span><br><span class="line">        res = []</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">       res  = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">if</span>(obj.hasOwnProperty(key)) &#123;</span><br><span class="line">            res[key] = deepClone(obj[key])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> obj = &#123;a:&#123;b:&#123;c:<span class="string">&#x27;ccc&#x27;</span>&#125;&#125;,f:[1,2,3,[4,5,[6,7]]]&#125;</span><br><span class="line"><span class="built_in">let</span> newobj = deepClone(obj)</span><br><span class="line"></span><br><span class="line">obj.a.b = <span class="string">&#x27;111&#x27;</span></span><br><span class="line">console.log(newobj,<span class="string">&#x27;newobj&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>7.浅拷贝<br>第一种：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object.assign(&#123;&#125;,obj)</span><br></pre></td></tr></table></figure>
<p>第二种 ：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> &#123;...cloneObj&#125; = obj</span><br></pre></td></tr></table></figure>
<p>8.手写bind函数<br>这样shuo :bind返回一个函数，这个函数的参数<br>首先看下bind函数的用法 以及bind 函数及apply,call函数的区别<br>bind函数是返回一个函数， apply,call函数是调用原函数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.myBind = <span class="keyword">function</span> (context,...args) &#123;</span><br><span class="line">    // <span class="built_in">bind</span>的原理就是返回一个函数，参数是里外函数参数的集合</span><br><span class="line">    <span class="keyword">if</span>(typeof this !==<span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">       <span class="built_in">return</span>  </span><br><span class="line">    &#125;</span><br><span class="line">    const _self = this;</span><br><span class="line">    <span class="built_in">return</span> <span class="keyword">function</span>(...anotherArg) &#123;</span><br><span class="line">        <span class="built_in">return</span> _self.apply(context,[...args,...anotherArg])</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">function</span> foo(name,age) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> obj = &#123;lick:<span class="string">&#x27;1222&#x27;</span>&#125;</span><br><span class="line"><span class="built_in">let</span> a = foo.bind(obj)</span><br><span class="line">a(13,12)</span><br><span class="line">console.log(obj)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>9.首先call函数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.myCall = <span class="keyword">function</span>(context,...args) &#123;</span><br><span class="line">    //原理是把foo作为obj的一个属性，然后去调用</span><br><span class="line">    <span class="keyword">if</span>(typeof this !== <span class="string">&#x27;function&#x27;</span>)&#123;</span><br><span class="line">      throw new TypeError(<span class="string">&#x27;It must be a function&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!context) &#123;</span><br><span class="line">        context = window</span><br><span class="line">    &#125;</span><br><span class="line">    const fn = Symbol();</span><br><span class="line">    context[fn] = this;</span><br><span class="line">    const result = context[fn](...args)</span><br><span class="line">    delete context[fn]</span><br><span class="line">    <span class="built_in">return</span> result    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> foo(name,age) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> obj = &#123;lick:<span class="string">&#x27;1222&#x27;</span>&#125;</span><br><span class="line"> foo.myCall(obj,<span class="string">&#x27;12&#x27;</span>,22)</span><br><span class="line"> console.log(obj)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>10.手写apply<br>跟call唯一的区别就是call传的是数组解构后的值，apply 传的是数组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.myApply = <span class="keyword">function</span>(context,args) &#123;</span><br><span class="line">    //原理是把foo作为obj的一个属性，然后去调用</span><br><span class="line">    <span class="keyword">if</span>(typeof this !== <span class="string">&#x27;function&#x27;</span>)&#123;</span><br><span class="line">      throw new TypeError(<span class="string">&#x27;It must be a function&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!context) &#123;</span><br><span class="line">        context = window</span><br><span class="line">    &#125;</span><br><span class="line">    const fn = Symbol();</span><br><span class="line">    context[fn] = this;</span><br><span class="line">    const result = context[fn](...args)</span><br><span class="line">    delete context[fn]</span><br><span class="line">    <span class="built_in">return</span> result    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> foo(name,age) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> obj = &#123;lick:<span class="string">&#x27;1222&#x27;</span>&#125;</span><br><span class="line"> foo.myApply(obj,[<span class="string">&#x27;12&#x27;</span>,22])</span><br><span class="line"> console.log(obj)</span><br></pre></td></tr></table></figure>
<p>11.手写promise.all<br>全部是true才返回列表，否则返回第一个报错的，且参数必须是Promise的集合</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> all(promiseArray) &#123;</span><br><span class="line">    <span class="keyword">if</span>(promiseArray.some(item =&gt;!(item instanceof Promise)))&#123;</span><br><span class="line">         throw new Error(<span class="string">&#x27;有存在不是promise的&#x27;</span>)</span><br><span class="line">         <span class="built_in">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">let</span> result = []</span><br><span class="line">    <span class="built_in">return</span> new Promise((resolve,reject) =&gt; &#123;</span><br><span class="line">        promiseArray.forEach(item =&gt; &#123;</span><br><span class="line">            item.then(res =&gt; &#123;</span><br><span class="line">                result.push(res)</span><br><span class="line">                result.length == promiseArray.length &amp;&amp; (resolve(result))</span><br><span class="line">            &#125;).catch(err =&gt; &#123;</span><br><span class="line">                reject(err)  </span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> p1 = Promise.resolve(1)</span><br><span class="line"><span class="built_in">let</span> p2 = Promise.resolve(2)</span><br><span class="line"><span class="built_in">let</span> p3 =1</span><br><span class="line">all([p1,p2,p3]).<span class="keyword">then</span>(res =&gt; &#123;</span><br><span class="line">    console.log(res,<span class="string">&#x27;ressss&#x27;</span>)</span><br><span class="line">&#125;).catch(err =&gt; &#123;</span><br><span class="line">    console.log(err,<span class="string">&#x27;errr&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>12.race </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// 实现promise.race，返回第一个为<span class="literal">false</span>的值，数组必须是promise的集合</span><br><span class="line"><span class="keyword">function</span> race(promiseArray) &#123;</span><br><span class="line">    <span class="keyword">if</span>(promiseArray.some(item =&gt;!(item instanceof Promise)))&#123;</span><br><span class="line">         throw new Error(<span class="string">&#x27;有存在不是promise的&#x27;</span>)</span><br><span class="line">         <span class="built_in">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> new Promise((resolve,reject) =&gt; &#123;</span><br><span class="line">        promiseArray.forEach(item =&gt; &#123;</span><br><span class="line">            item.then(res =&gt; &#123;</span><br><span class="line">                resolve(res)</span><br><span class="line">            &#125;).catch(err =&gt; &#123;</span><br><span class="line">                reject(err)  </span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> p1 = Promise.reject(1)</span><br><span class="line"><span class="built_in">let</span> p2 = Promise.resolve(2)</span><br><span class="line"><span class="built_in">let</span> p3 =Promise.resolve(3)</span><br><span class="line">race([p1,p2,p3]).<span class="keyword">then</span>(res =&gt; &#123;</span><br><span class="line">    console.log(res,<span class="string">&#x27;ressss&#x27;</span>)</span><br><span class="line">&#125;).catch(err =&gt; &#123;</span><br><span class="line">    console.log(err,<span class="string">&#x27;errr&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>13.防抖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> debounce(fn,delay=1000) &#123;</span><br><span class="line">    <span class="built_in">let</span> timer = null;</span><br><span class="line">    <span class="built_in">return</span> (...args) =&gt;  &#123;</span><br><span class="line">        <span class="keyword">if</span>(timer) &#123;</span><br><span class="line">            clearTimeout(timer)</span><br><span class="line">        &#125;</span><br><span class="line">        timer = setTimeout(() =&gt; &#123;</span><br><span class="line">            fn.call(this,...args)</span><br><span class="line">        &#125;,delay)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> input  = document.getElementById(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">input.addEventListener(<span class="string">&#x27;keyup&#x27;</span>,debounce(() =&gt; &#123;</span><br><span class="line">    console.log(<span class="string">&#x27;执行&#x27;</span>)</span><br><span class="line">&#125;,3000))</span><br></pre></td></tr></table></figure>
<p>14.节流</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> throttle(func,delay) &#123;</span><br><span class="line">    <span class="built_in">let</span> acTime  = 0;</span><br><span class="line">    <span class="built_in">return</span> () =&gt; &#123;</span><br><span class="line">        const current = Date.now();</span><br><span class="line">        <span class="keyword">if</span>(current-acTime &gt; delay) &#123;</span><br><span class="line">            func.apply(this,arguments)</span><br><span class="line">            acTime = Date.now()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> input = document.getElementById(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">input.addEventListener(<span class="string">&#x27;keyup&#x27;</span>, throttle(() =&gt; &#123;</span><br><span class="line">    console.log(<span class="string">&#x27;执行&#x27;</span>)</span><br><span class="line">&#125;, 5000))</span><br></pre></td></tr></table></figure>
<p>15.如何用Ajax实现一个post请求</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var ajax = new XMLHttpRequest();</span><br><span class="line">ajax.open(<span class="string">&#x27;post&#x27;</span>,url,)</span><br><span class="line">ajax.setRequestHeader(<span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;text-plain&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span>(data) &#123;</span><br><span class="line">  ajax.send(data)</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">  ajax.send()</span><br><span class="line">&#125;</span><br><span class="line">ajax.onreadystatechange = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">  <span class="keyword">if</span>(ajax.readyState ==4 &amp;&amp; ajax.status ===200) &#123;</span><br><span class="line">    console.log(responseText)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>16.vue的双向绑定过程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> Target = null;</span><br><span class="line"><span class="built_in">let</span> data = &#123;</span><br><span class="line">    a: 1,</span><br><span class="line">    b: 2,</span><br><span class="line">    c: &#123; d: <span class="string">&#x27;111&#x27;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">let</span> i <span class="keyword">in</span> data) &#123;</span><br><span class="line">    observer(i, data[i], data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> observer(key, value, data) &#123;</span><br><span class="line">    <span class="built_in">let</span> subs = [];</span><br><span class="line">    value = value || data[key]</span><br><span class="line">    Object.defineProperty(data, key,</span><br><span class="line">        &#123;</span><br><span class="line">            get: <span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">                console.log(Target,<span class="string">&#x27;11&#x27;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (Target) &#123;</span><br><span class="line">                    subs.push(Target)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">return</span> value</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="built_in">set</span>: <span class="keyword">function</span> (newValue) &#123;</span><br><span class="line">                value = newValue</span><br><span class="line">                subs.forEach(fn =&gt; fn())</span><br><span class="line">                <span class="built_in">return</span> value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> watch(key, callback) &#123;</span><br><span class="line">    console.log(key,callback)</span><br><span class="line">    Target = callback;</span><br><span class="line">    data[key];</span><br><span class="line">    Target = null;</span><br><span class="line">&#125;</span><br><span class="line">watch(<span class="string">&#x27;a&#x27;</span>,<span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">    console.log(12)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>17.继承</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> Parent(name,eye) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.eye = eye</span><br><span class="line">&#125;</span><br><span class="line">Parent.prototype.getName = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">    <span class="built_in">return</span> this.name</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> Child(name,age,...args) &#123;</span><br><span class="line">    Parent.call(this,name,age)</span><br><span class="line">    this.other = args</span><br><span class="line">&#125;</span><br><span class="line">Child.prototype = Parent.prototype</span><br><span class="line"><span class="built_in">let</span> child = new Child(<span class="string">&#x27;一个名字1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">console.log(child.getName())</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>18.eventBus实现 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">// 试下eventbus</span><br><span class="line">class EventBus &#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span></span>() &#123;</span><br><span class="line">        this.event = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    on(name,fn) &#123;</span><br><span class="line">        (!this.event[name] &amp;&amp; (this.event[name] = [])).push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">    emit(name,...args) &#123;</span><br><span class="line">        this.event[name] &amp;&amp; this.event[name].forEach(fn=&gt; &#123;</span><br><span class="line">            fn(...args)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    once(name,fn) &#123;</span><br><span class="line">        const cb = (...args) =&gt; &#123;</span><br><span class="line">            fn.apply(this,args)</span><br><span class="line">            this.off(name,fn)</span><br><span class="line">        &#125;</span><br><span class="line">        this.on(name,cb)</span><br><span class="line">    &#125;</span><br><span class="line">    off(name,offcb) &#123;</span><br><span class="line">        <span class="keyword">if</span>(this.event[name]) &#123;</span><br><span class="line">            <span class="built_in">let</span> index = this.event[name].findIndex(fn=&gt;&#123;</span><br><span class="line">                <span class="built_in">return</span> fn===offcb</span><br><span class="line">            &#125;)</span><br><span class="line">            this.event[name].splice(index,1)</span><br><span class="line">            <span class="keyword">if</span>(!this.event[name].length) &#123;</span><br><span class="line">                delete this.event[name]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> bus = new EventBus();</span><br><span class="line">bus.on(<span class="string">&quot;start&quot;</span>, <span class="keyword">function</span> (...arg) &#123;</span><br><span class="line">    console.log(arg,<span class="string">&#x27;arg&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">bus.emit(<span class="string">&#x27;start&#x27;</span>,<span class="string">&#x27;ad&#x27;</span>,<span class="string">&#x27;ed&#x27;</span>)</span><br><span class="line">bus.emit(<span class="string">&#x27;start&#x27;</span>,<span class="string">&#x27;vvvv&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>19,手写Promise</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">//手写一个promise</span><br><span class="line">const RESOLVED = <span class="string">&#x27;RESOLVED&#x27;</span>;</span><br><span class="line">const REJECTED = <span class="string">&#x27;REJECTED&#x27;</span>;</span><br><span class="line">const PENDING = <span class="string">&#x27;PENDING&#x27;</span>;</span><br><span class="line">class MyPromise &#123;</span><br><span class="line">    constructor(excutor) &#123;</span><br><span class="line">        this.status = PENDING;</span><br><span class="line">        this.value = undefined;</span><br><span class="line">        this.reason = undefined;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">let</span> catchs = (rej) =&gt; &#123;</span><br><span class="line">            rej(this.reason)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="built_in">let</span> resolve = (value) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (this.status == PENDING) &#123;</span><br><span class="line">                this.value = value;</span><br><span class="line">                this.status = RESOLVED</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">let</span> reject = (reason) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (this.status == PENDING) &#123;</span><br><span class="line">                this.reason = reason;</span><br><span class="line">                this.status = REJECTED</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            excutor(resolve, reject)</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">            reject(e)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">then</span>(onfulfilled, onrejected) &#123;</span><br><span class="line">        <span class="keyword">if</span> (this.status == RESOLVED) &#123;</span><br><span class="line">            <span class="built_in">let</span> res = onfulfilled(this.value)</span><br><span class="line">            <span class="built_in">return</span> new MyPromise((resolve, reject)=&gt;  &#123;</span><br><span class="line">                resolve(res)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (this.status == REJECTED) &#123;</span><br><span class="line">            <span class="built_in">let</span> rej = onrejected &amp;&amp; onrejected(this.reason)</span><br><span class="line">            <span class="built_in">return</span> new MyPromise((resolve, reject) =&gt; &#123;</span><br><span class="line">                reject(rej || this.reason)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    catch(onrejected) &#123;</span><br><span class="line">       this.status == REJECTED&amp;&amp;  onrejected(this.reason)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> p = new MyPromise((res, rej) =&gt; &#123;</span><br><span class="line">    rej(<span class="string">&#x27;错了&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">p.then(res =&gt; &#123;</span><br><span class="line">    console.log(res, <span class="string">&#x27;1111&#x27;</span>)</span><br><span class="line">&#125;).<span class="keyword">then</span>(res =&gt; &#123;</span><br><span class="line">    console.log(res, <span class="string">&#x27;reeeee&#x27;</span>)</span><br><span class="line">&#125;).catch(err =&gt; &#123;</span><br><span class="line">    console.log(err, 111)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>








      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/11/06/%E7%BC%96%E7%A8%8B%E9%A2%98/">
    <time datetime="2021-11-06T07:50:22.000Z" class="entry-date">
        2021-11-06
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-总结" class="post-总结 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/10/11/%E6%80%BB%E7%BB%93/">总结</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/10/11/%E6%80%BB%E7%BB%93/" data-id="cl023jlkd000hh107carwgglw" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>1.实现千分位</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> str = <span class="string">&#x27;12333&#x27;</span></span><br><span class="line">String(str).split(<span class="string">&#x27;&#x27;</span>).reverse().reduce((prev,next,index) =&gt; &#123;(index%3 ? next:next+<span class="string">&#x27;,&#x27;</span>)+prev&#125;&#125;)</span><br><span class="line">(Number(str)).toLocaleString()</span><br></pre></td></tr></table></figure>
<p>2.数组扁平化并去重，从小到大排列</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">flatten(arr) &#123;</span><br><span class="line">     // 编写一个程序将数组扁平化去并除其中重复部分数据，最终得到一个升序且不重复的数组</span><br><span class="line">     arr.forEach((item, index) =&gt; &#123;</span><br><span class="line">       <span class="keyword">if</span> (Array.isArray(item)) &#123;</span><br><span class="line">         this.flatten(item);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         this.newArr.push(item);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;);</span><br><span class="line">     <span class="built_in">return</span> Array.from(new Set(this.newArr)).sort((a, b) =&gt; a - b);</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>
<p>3.给定一个数组，计算他们的交集</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">intersection(arr1, arr2) &#123;</span><br><span class="line">     <span class="built_in">return</span> arr1.filter((item) =&gt; arr2.includes(item));</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>
<p>4.随机生成一个长度为 10 的整数类型的数组，例如 [2, 10, 3, 4, 5, 11, 10, 11, 20]，将其排列成一个新数组，要求新数组形式如下，例如 [[2, 3, 4, 5], [10, 11], [20]]。<br>5.如何把一个字符串的大小写取反（大写变小写小写变大写），例如 ’AbC’ 变成 ‘aBc’</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> str = <span class="string">&#x27;AAAbbb&#x27;</span></span><br><span class="line"><span class="built_in">let</span> news = str.replace(/[a-zA-Z]/g,content =&gt; &#123;</span><br><span class="line">    <span class="built_in">return</span> /[a-z]/.<span class="built_in">test</span>(content) ? content.toUpperCase() : content.toLowerCase() </span><br><span class="line">&#125;)</span><br><span class="line">console.log(news)</span><br></pre></td></tr></table></figure>


<p>6.手写一个iterator<br>7.手写promise.all和promise.race</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Promise.all = <span class="keyword">function</span>(iterator) &#123;</span><br><span class="line">   <span class="built_in">let</span> count = 0;</span><br><span class="line">   <span class="built_in">let</span> length = iterator.length;</span><br><span class="line">   <span class="built_in">let</span> res = [];</span><br><span class="line">   <span class="built_in">let</span> err = []</span><br><span class="line">   <span class="built_in">return</span> new Promise((resolve,reject) =&gt; &#123;</span><br><span class="line">       <span class="keyword">for</span>(<span class="built_in">let</span> i <span class="keyword">in</span> iterator) &#123;</span><br><span class="line">           Promise.resolve(iterator[i])</span><br><span class="line">           .<span class="keyword">then</span>(data =&gt; &#123;</span><br><span class="line">            // 如果是all,需要等到所有的执行完且全部为resolve状态，++count == length来判断</span><br><span class="line">              res[i] = data;</span><br><span class="line">              <span class="keyword">if</span>(++count == length) &#123;</span><br><span class="line">                  resolve(res)</span><br><span class="line">              &#125;</span><br><span class="line">            //  如果是race，直接执行resolve（res[i] ）</span><br><span class="line">            </span><br><span class="line">           &#125;)</span><br><span class="line">           .catch(e =&gt; &#123;</span><br><span class="line">             // 这边如果想要获取 </span><br><span class="line">               err[i] = e;</span><br><span class="line">               reject(e)</span><br><span class="line">           &#125;)</span><br><span class="line">           </span><br><span class="line">       &#125;</span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> a = Promise.resolve(3);</span><br><span class="line"><span class="built_in">let</span> b = new Promise((resolve,reject) =&gt; &#123;</span><br><span class="line">    setTimeout(resolve,100,<span class="string">&#x27;foo&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">let</span> c = 33</span><br><span class="line"><span class="built_in">let</span> d = Promise.reject(<span class="string">&#x27;报错了&#x27;</span>)</span><br><span class="line">Promise.all([a,b,c,d]).<span class="keyword">then</span>(value =&gt; &#123;</span><br><span class="line">    console.log(value,<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">&#125;).catch(e =&gt; &#123;</span><br><span class="line">    console.log(e)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/10/11/%E6%80%BB%E7%BB%93/">
    <time datetime="2021-10-11T12:32:51.000Z" class="entry-date">
        2021-10-11
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-webpack" class="post-webpack post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/09/17/webpack/">webpack</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/09/17/webpack/" data-id="cl023jlkd000eh107b7v2hy82" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>npx webpack</p>
<p>npx webpack –config webpack.config.js  指定配置文件<br>报错了看这篇[<a target="_blank" rel="noopener" href="https://juejin.cn/post/6891873387350917134]">https://juejin.cn/post/6891873387350917134]</a></p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/09/17/webpack/">
    <time datetime="2021-09-17T03:23:09.000Z" class="entry-date">
        2021-09-17
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-vue-observer" class="post-vue-observer post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/09/07/vue-observer/">vue-observer</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/09/07/vue-observer/" data-id="cl023jlk90008h107aqpg0lp2" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="observer"><a href="#observer" class="headerlink" title="observer"></a>observer</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">new Observer（</span><br><span class="line">  value: any;</span><br><span class="line">  dep: Dep;</span><br><span class="line">  vmCount: number</span><br><span class="line">  ）做的几件事</span><br><span class="line"></span><br><span class="line">1.this.value = value</span><br><span class="line">2.this.dep = new Dep()</span><br><span class="line">this.vmCount = 0</span><br><span class="line">3.def(value, <span class="string">&#x27;__ob__&#x27;</span>, this) //将value的__ob__属性设置为当前实例，不可枚举</span><br><span class="line"></span><br><span class="line">4.</span><br><span class="line">如果value是数组</span><br><span class="line"> //给value添加数组的属性</span><br><span class="line"> <span class="keyword">if</span> (hasProto) &#123;</span><br><span class="line">    protoAugment(value, arrayMethods) // value.__proto__ = arrayMethods</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    copyAugment(value, arrayMethods, arrayKeys)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  this.observeArray(value)</span><br><span class="line"></span><br><span class="line">  observeArray(items: Array&lt;any&gt;) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">let</span> i = 0, l = items.length; i &lt; l; i++) &#123;</span><br><span class="line">      observe(items[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">给数组的每一项执行observe方法</span><br><span class="line"></span><br><span class="line">observe方法</span><br><span class="line">声明ob；</span><br><span class="line">如果value.__ob__存在并且是Observer的实例，说明已经执行过new Observer,ob = value.__ob__</span><br><span class="line">否则，ob = new Observer(value)，</span><br><span class="line"></span><br><span class="line">5.如果是对象，执行work方法（遍历value的每一项， 执行defineReactive(obj, keys[i])）</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>接下来看下defineReactive<br>参数<br>  obj: Object,<br>  key: string, // 健值<br>  val: any,<br>  customSetter?: ?Function,<br>  shallow?: boolean</p>
<p>  执行 Object.defineProperty（target，key,value）<br>  get 操作：<br>  在每一个属性下面，都设置了一个dep数组，里面包含id和subs，<br>  const dep = new Dep()<br>  如果我们在遍历data的时候，而其中属性没有被$watch监听，get 操作也仅仅是 返回了 value的值<br>  因为只有在watcher中才用到Dep.target，<br>  如果是$watch 监听的属性，</p>
<p>  if (childOb) { //childOb存在，说明是有__ob__属性的，<br>    childOb.dep.depend() //这里再添加一次依赖是为了在使用Vue.set()设置时，是使用ob.dep.notify()去触发依赖<br>    if (Array.isArray(value)) {<br>      dependArray(value)<br>    }<br>  }<br>  执行childOb.dep.depend()，执行 Dep.target.addDep(this)，Dep.target是当前Watcher实例, 就是执行dep的addSub，将当前watcher实例添加到__ob__的dep的subs中<br>  比如我在页面上给reqConfig加到了watch中，在reqConfig的__ob__的dep中的subs就会有一条Watcher记录，expression: “reqConfig”，<br>  dep.notify()执行subs[i].update()。重新求值</p>
<p>  set操作<br>  if (setter) {<br>    setter.call(obj, newVal)<br>  } else {<br>    val = newVal<br>  }<br>  childOb = !shallow &amp;&amp; observe(newVal)<br>  遍历给newVal设置__ob__，childOb就是observe返回的ob,即new Observer（）的实例</p>
<p>  dep.notify()<br>  #遍历subs，执行update操作</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/09/07/vue-observer/">
    <time datetime="2021-09-07T06:17:11.000Z" class="entry-date">
        2021-09-07
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-vue-state" class="post-vue-state post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/09/07/vue-state/">vue-state</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/09/07/vue-state/" data-id="cl023jlka0009h107duodhmd8" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>当我看到这个文件的时候，终于知道怎么监听的data，因为前面在lifecycle中看到了给实例添加了 _watcher ，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vm._watchers = []</span><br><span class="line"><span class="keyword">if</span> (opts.props) initProps(vm, opts.props)</span><br><span class="line"><span class="comment"># 在initProps内部执行了 defineReactive(props, key, value)</span></span><br><span class="line"><span class="keyword">if</span> (opts.methods) initMethods(vm, opts.methods)</span><br><span class="line"><span class="comment">#在initMethods内部执行了 vm[key] = typeof methods[key] !== &#x27;function&#x27; ? noop : bind(methods[key], vm)</span></span><br><span class="line"><span class="keyword">if</span> (opts.data) &#123;</span><br><span class="line">    initData(vm)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    observe(vm._data = &#123;&#125;, <span class="literal">true</span> /* asRootData */)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># 就是这里了，终于看到久违的data，</span></span><br><span class="line">  然后我们回到之前看到的observer看下针对data多了什么处理</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> getData (data: Function, vm: Component): any &#123;</span><br><span class="line">  <span class="comment">#可以看到，在data中也执行了pushTarget</span></span><br><span class="line">  pushTarget()</span><br><span class="line">  try &#123;</span><br><span class="line">    <span class="built_in">return</span> data.call(vm, vm)</span><br><span class="line">  &#125; catch (e) &#123;</span><br><span class="line">    handleError(e, vm, `data()`)</span><br><span class="line">    <span class="built_in">return</span> &#123;&#125;</span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    popTarget()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/09/07/vue-state/">
    <time datetime="2021-09-07T02:55:18.000Z" class="entry-date">
        2021-09-07
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-vue-dep" class="post-vue-dep post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/09/05/vue-dep/">vue-dep</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/09/05/vue-dep/" data-id="cl023jlk80004h1076xycciom" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> default class Dep &#123;</span><br><span class="line">  <span class="comment"># target是一个私有属性</span></span><br><span class="line">  static target: ?Watcher;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">Dep.target = null</span><br><span class="line">const targetStack = []</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> pushTarget(target: ?Watcher) &#123;</span><br><span class="line">  targetStack.push(target)</span><br><span class="line">  Dep.target = target</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> <span class="function"><span class="title">popTarget</span></span>() &#123;</span><br><span class="line">  targetStack.pop()</span><br><span class="line">  Dep.target = targetStack[targetStack.length - 1]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>不是每次执行pushTarget都会有参数，如果Dep.target存在值，说明是<br>new Watcher(vm, updateComponent, noop, null, true /* isRenderWatcher */); 在实例上添加的watcher<br>或者var watcher = new Watcher(vm, expOrFn, cb, options); 在Vue.prototype.$watch中定义的<br>或者在initComputed中定义的<br>在遍历data的时候其实这段是跳过去的，因为initData中执行了pushTarget()，Dep.target = target 取到的值是null</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/09/05/vue-dep/">
    <time datetime="2021-09-05T06:05:45.000Z" class="entry-date">
        2021-09-05
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-watcher的实现" class="post-watcher的实现 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/09/03/watcher%E7%9A%84%E5%AE%9E%E7%8E%B0/">watcher的实现</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/09/03/watcher%E7%9A%84%E5%AE%9E%E7%8E%B0/" data-id="cl023jlkc000dh1079nhkarbk" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h1 id="可以看到，expOrFn就是我们在lifeCircle中传的updateComponent"><a href="#可以看到，expOrFn就是我们在lifeCircle中传的updateComponent" class="headerlink" title="可以看到，expOrFn就是我们在lifeCircle中传的updateComponent,"></a>可以看到，expOrFn就是我们在lifeCircle中传的updateComponent,</h1><p>当前实例大概是这样</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  vm:vm,</span><br><span class="line">  _watcher:Watcher,</span><br><span class="line">  _watchers:[Watcher,Watcher,Watcher], </span><br><span class="line">  deps : [],</span><br><span class="line">  newDeps : [],</span><br><span class="line">  depIds : [],</span><br><span class="line">  newDepIds :[],</span><br><span class="line">  getter:f=&gt; updateComponent,</span><br><span class="line">  value:f =&gt; get </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> default class Watcher &#123;</span><br><span class="line">  expression</span><br><span class="line">   constructor (</span><br><span class="line">    vm: Component,</span><br><span class="line">    expOrFn: string | Function,</span><br><span class="line">    isRenderWatcher</span><br><span class="line">    ...</span><br><span class="line">   )&#123;</span><br><span class="line">    this.vm = vm</span><br><span class="line">     <span class="keyword">if</span> (isRenderWatcher) &#123;</span><br><span class="line">      <span class="comment">#  this 是当前的watch实例</span></span><br><span class="line">      vm._watcher = this</span><br><span class="line">    &#125;</span><br><span class="line">    vm._watchers.push(this)</span><br><span class="line">    this.deps = []</span><br><span class="line">    this.newDeps = []</span><br><span class="line">    this.depIds = new Set()</span><br><span class="line">    this.newDepIds = new Set()</span><br><span class="line">    this.getter = expOrFn </span><br><span class="line">    this.value = this.lazy</span><br><span class="line">      ? undefined</span><br><span class="line">      : this.get()</span><br><span class="line">   &#125;</span><br><span class="line">  <span class="comment"># this.value 用到了get， pushTarget是dep中的方法</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">get</span></span> () &#123;</span><br><span class="line">    <span class="comment"># 收集观察者</span></span><br><span class="line">    pushTarget(this) </span><br><span class="line">    <span class="built_in">let</span> value</span><br><span class="line">    const vm = this.vm</span><br><span class="line">    try &#123;</span><br><span class="line">      <span class="comment">#在监听当前组件的时候，value的取值其实是重新渲染实际dom，没有传deep,也不会走traverse(value)这一步</span></span><br><span class="line">      value = this.getter.call(vm, vm)</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">      <span class="keyword">if</span> (this.user) &#123;</span><br><span class="line">        handleError(e, vm, `getter <span class="keyword">for</span> watcher <span class="string">&quot;<span class="variable">$&#123;this.expression&#125;</span>&quot;</span>`)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        throw e</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">      <span class="comment"># 循环遍历value ， 如果有__ob__这个属性，则把depId添加到一个数组中</span></span><br><span class="line">      <span class="keyword">if</span> (this.deep) &#123;</span><br><span class="line">        traverse(value)</span><br><span class="line">      &#125;</span><br><span class="line">      popTarget()</span><br><span class="line">      this.cleanupDeps()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/09/03/watcher%E7%9A%84%E5%AE%9E%E7%8E%B0/">
    <time datetime="2021-09-03T12:17:58.000Z" class="entry-date">
        2021-09-03
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-vue-globalApi" class="post-vue-globalApi post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/09/03/vue-globalApi/">vue-globalApi</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/09/03/vue-globalApi/" data-id="cl023jlk80005h107ch7naqzm" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">... </span><br><span class="line">Vue.set = <span class="built_in">set</span></span><br><span class="line">Vue.delete = del</span><br><span class="line">Vue.nextTick = nextTick</span><br><span class="line">Vue.options = &#123;</span><br><span class="line">  <span class="string">&#x27;component&#x27;</span>:,</span><br><span class="line">  <span class="string">&#x27;directive&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;filter&#x27;</span>,</span><br><span class="line">  _base:Vue</span><br><span class="line">&#125;</span><br><span class="line">Vue.use</span><br><span class="line">Vue.extend</span><br><span class="line">Vue.mixin</span><br></pre></td></tr></table></figure>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/09/03/vue-globalApi/">
    <time datetime="2021-09-03T09:01:52.000Z" class="entry-date">
        2021-09-03
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-vue-init" class="post-vue-init post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/09/03/vue-init/">vue-init</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/09/03/vue-init/" data-id="cl023jlk90006h107fa6cdr7x" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>vm是当前实例，<br>vm.constructor是构造函数，new Vue() ，vm.constructor 如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> Vue (options) &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp;</span><br><span class="line">    !(this instanceof Vue)</span><br><span class="line">  ) &#123;</span><br><span class="line">    warn(<span class="string">&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  this._init(options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面贴一些init.js 中的代码来解析</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const vm: Component = this //当前实例</span><br><span class="line"> vm._uid = uid++ //唯一的标识</span><br><span class="line"> vm._isVue = <span class="literal">true</span> //Vue标识</span><br><span class="line"> //下面这一步的操作都是设置vm.<span class="variable">$options</span>,</span><br><span class="line">  <span class="keyword">if</span> (options &amp;&amp; options._isComponent) &#123;</span><br><span class="line">    initInternalComponent(vm, options)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    vm.<span class="variable">$options</span> = mergeOptions(</span><br><span class="line">      resolveConstructorOptions(vm.constructor), </span><br><span class="line">      <span class="comment">#new Vue()的情况下， vm.constructor.options 直接返回Vue.options，</span></span><br><span class="line">      options || &#123;&#125;,</span><br><span class="line">      vm</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># 指定上下文，赋值给_renderProxy</span></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    initProxy(vm)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    vm._renderProxy = vm</span><br><span class="line">  &#125;</span><br><span class="line">  vm._self = vm</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>接下来就是引用了好几个别的文件，首先是[initLifecycle]</p>
<p>这一段我好难懂，所以贴出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> resolveConstructorOptions(Ctor: Class&lt;Component&gt;) &#123; </span><br><span class="line">  <span class="built_in">let</span> options = Ctor.options</span><br><span class="line">  <span class="keyword">if</span> (Ctor.super) &#123;</span><br><span class="line">    <span class="comment">#说明是通过let Ex = Vue.entend();new Ex()创建的实例,</span></span><br><span class="line">    <span class="comment">#Ctor在extend中是构造函数，就是Sub函数</span></span><br><span class="line">    const superOptions = resolveConstructorOptions(Ctor.super)</span><br><span class="line">    <span class="comment">#Ctor.super其实就是Vue，superOptions保存的是Vue.options</span></span><br><span class="line">    const cachedSuperOptions = Ctor.superOptions</span><br><span class="line">    <span class="comment"># Ctor.superOptions中是保存的执行Vue.extend时Vue.options的值</span></span><br><span class="line">    <span class="keyword">if</span> (superOptions !== cachedSuperOptions) &#123;</span><br><span class="line">      <span class="comment"># 如果出现差异，更新Sub中Vue.options的字段</span></span><br><span class="line">      Ctor.superOptions = superOptions</span><br><span class="line">      <span class="comment"># 获取到更新的字段，然后重新赋值给Vue.options，现在Sub存储了最新的options</span></span><br><span class="line">      const modifiedOptions = resolveModifiedOptions(Ctor)</span><br><span class="line">      <span class="keyword">if</span> (modifiedOptions) &#123;</span><br><span class="line">        extend(Ctor.extendOptions, modifiedOptions)</span><br><span class="line">      &#125;</span><br><span class="line">      options = Ctor.options = mergeOptions(superOptions, Ctor.extendOptions)</span><br><span class="line">      <span class="keyword">if</span> (options.name) &#123;</span><br><span class="line">        options.components[options.name] = Ctor</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> options</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Vue.extend(&#123;&#125;)de constructor 如下</span><br><span class="line">&#96;&#96;&#96;bash</span><br><span class="line"># const Sub &#x3D;</span><br><span class="line">    function VueComponent(options) &#123;</span><br><span class="line">      this._init(options)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>所以此处的options可以是下面这样</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">new Vue(&#123;</span><br><span class="line">  data:&#123;&#125;,</span><br><span class="line">  created: <span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">    console.log(this.<span class="variable">$options</span>.customOption) // =&gt; <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">//或者</span><br><span class="line"></span><br><span class="line">Vue.extend(&#123;</span><br><span class="line">  template: <span class="string">&#x27;&lt;p&gt;&#123;&#123;firstName&#125;&#125; &#123;&#123;lastName&#125;&#125; aka &#123;&#123;alias&#125;&#125;&lt;/p&gt;&#x27;</span>,</span><br><span class="line">  data: <span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">    <span class="built_in">return</span> &#123;</span><br><span class="line">      firstName: <span class="string">&#x27;Walter&#x27;</span>,</span><br><span class="line">      lastName: <span class="string">&#x27;White&#x27;</span>,</span><br><span class="line">      <span class="built_in">alias</span>: <span class="string">&#x27;Heisenberg&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/09/03/vue-init/">
    <time datetime="2021-09-03T09:01:07.000Z" class="entry-date">
        2021-09-03
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-vue-lifeCycle" class="post-vue-lifeCycle post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/09/03/vue-lifeCycle/">vue-lifeCycle</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/09/03/vue-lifeCycle/" data-id="cl023jlk90007h1078lq46bzq" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">设置当前实例</span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> setActiveInstance(vm: Component) &#123;</span><br><span class="line">  const prevActiveInstance = activeInstance</span><br><span class="line">  activeInstance = vm</span><br><span class="line">  <span class="built_in">return</span> () =&gt; &#123;</span><br><span class="line">    activeInstance = prevActiveInstance</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> initLifecycle (vm: Component) &#123;</span><br><span class="line">  <span class="comment"># 初始化了一系列的值</span></span><br><span class="line">  const options = vm.<span class="variable">$options</span></span><br><span class="line"></span><br><span class="line">  // locate first non-abstract parent</span><br><span class="line">  <span class="built_in">let</span> parent = options.parent</span><br><span class="line">  <span class="keyword">if</span> (parent &amp;&amp; !options.abstract) &#123;</span><br><span class="line">    <span class="keyword">while</span> (parent.<span class="variable">$options</span>.abstract &amp;&amp; parent.<span class="variable">$parent</span>) &#123;</span><br><span class="line">      parent = parent.<span class="variable">$parent</span></span><br><span class="line">    &#125;</span><br><span class="line">    parent.<span class="variable">$children</span>.push(vm)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  vm.<span class="variable">$parent</span> = parent</span><br><span class="line">  vm.<span class="variable">$root</span> = parent ? parent.<span class="variable">$root</span> : vm</span><br><span class="line"></span><br><span class="line">  vm.<span class="variable">$children</span> = []</span><br><span class="line">  vm.<span class="variable">$refs</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  vm._watcher = null</span><br><span class="line">  vm._inactive = null</span><br><span class="line">  vm._directInactive = <span class="literal">false</span></span><br><span class="line">  vm._isMounted = <span class="literal">false</span></span><br><span class="line">  vm._isDestroyed = <span class="literal">false</span></span><br><span class="line">  vm._isBeingDestroyed = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># _update将虚拟dom渲染成实际dom</span></span><br><span class="line">Vue.prototype._update = <span class="keyword">function</span> (vnode: VNode, hydrating?: boolean) &#123;</span><br><span class="line">    const vm: Component = this</span><br><span class="line">    const prevEl = vm.<span class="variable">$el</span></span><br><span class="line">    const prevVnode = vm._vnode</span><br><span class="line">    const restoreActiveInstance = setActiveInstance(vm)</span><br><span class="line">    vm._vnode = vnode</span><br><span class="line">    // Vue.prototype.__patch__ is injected <span class="keyword">in</span> entry points</span><br><span class="line">    // based on the rendering backend used.</span><br><span class="line">    <span class="keyword">if</span> (!prevVnode) &#123;</span><br><span class="line">      // initial render</span><br><span class="line">      vm.<span class="variable">$el</span> = vm.__patch__(vm.<span class="variable">$el</span>, vnode, hydrating, <span class="literal">false</span> /* removeOnly */)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      // updates</span><br><span class="line">      vm.<span class="variable">$el</span> = vm.__patch__(prevVnode, vnode)</span><br><span class="line">    &#125;</span><br><span class="line">    restoreActiveInstance()</span><br><span class="line">    // update __vue__ reference</span><br><span class="line">    <span class="keyword">if</span> (prevEl) &#123;</span><br><span class="line">      prevEl.__vue__ = null</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (vm.<span class="variable">$el</span>) &#123;</span><br><span class="line">      vm.<span class="variable">$el</span>.__vue__ = vm</span><br><span class="line">    &#125;</span><br><span class="line">    // <span class="keyword">if</span> parent is an HOC, update its <span class="variable">$el</span> as well</span><br><span class="line">    <span class="keyword">if</span> (vm.<span class="variable">$vnode</span> &amp;&amp; vm.<span class="variable">$parent</span> &amp;&amp; vm.<span class="variable">$vnode</span> === vm.<span class="variable">$parent</span>._vnode) &#123;</span><br><span class="line">      vm.<span class="variable">$parent</span>.<span class="variable">$el</span> = vm.<span class="variable">$el</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Vue.prototype.<span class="variable">$forceUpdate</span> = <span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">    const vm: Component = this</span><br><span class="line">    <span class="keyword">if</span> (vm._watcher) &#123;</span><br><span class="line">      vm._watcher.update()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Vue.prototype.<span class="variable">$destroy</span> = <span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">    const vm: Component = this</span><br><span class="line">    <span class="keyword">if</span> (vm._isBeingDestroyed) &#123;</span><br><span class="line">      <span class="built_in">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 声明钩子函数</span></span><br><span class="line">    callHook(vm, <span class="string">&#x27;beforeDestroy&#x27;</span>)</span><br><span class="line">    vm._isBeingDestroyed = <span class="literal">true</span></span><br><span class="line">    // remove self from parent</span><br><span class="line">    const parent = vm.<span class="variable">$parent</span></span><br><span class="line">    <span class="comment"># 如果有父级，在父级中移除当前子级</span></span><br><span class="line">    <span class="keyword">if</span> (parent &amp;&amp; !parent._isBeingDestroyed &amp;&amp; !vm.<span class="variable">$options</span>.abstract) &#123;</span><br><span class="line">      remove(parent.<span class="variable">$children</span>, vm)</span><br><span class="line">    &#125;</span><br><span class="line">    // teardown watchers</span><br><span class="line">    <span class="keyword">if</span> (vm._watcher) &#123;</span><br><span class="line">      vm._watcher.teardown()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">let</span> i = vm._watchers.length</span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      vm._watchers[i].teardown()</span><br><span class="line">    &#125;</span><br><span class="line">    // remove reference from data ob</span><br><span class="line">    // frozen object may not have observer.</span><br><span class="line">    <span class="keyword">if</span> (vm._data.__ob__) &#123;</span><br><span class="line">      vm._data.__ob__.vmCount--</span><br><span class="line">    &#125;</span><br><span class="line">    // call the last hook...</span><br><span class="line">    vm._isDestroyed = <span class="literal">true</span></span><br><span class="line">    // invoke destroy hooks on current rendered tree</span><br><span class="line">    vm.__patch__(vm._vnode, null)</span><br><span class="line">    // fire destroyed hook</span><br><span class="line">    callHook(vm, <span class="string">&#x27;destroyed&#x27;</span>)</span><br><span class="line">    // turn off all instance listeners.</span><br><span class="line">    vm.<span class="variable">$off</span>()</span><br><span class="line">    // remove __vue__ reference</span><br><span class="line">    <span class="keyword">if</span> (vm.<span class="variable">$el</span>) &#123;</span><br><span class="line">      vm.<span class="variable">$el</span>.__vue__ = null</span><br><span class="line">    &#125;</span><br><span class="line">    // release circular reference (<span class="comment">#6759)</span></span><br><span class="line">    <span class="keyword">if</span> (vm.<span class="variable">$vnode</span>) &#123;</span><br><span class="line">      vm.<span class="variable">$vnode</span>.parent = null</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">export</span> <span class="keyword">function</span> mountComponent (</span><br><span class="line">  vm: Component,</span><br><span class="line">  el: ?Element,</span><br><span class="line">  hydrating?: boolean</span><br><span class="line">): Component &#123;</span><br><span class="line">  vm.<span class="variable">$el</span> = el</span><br><span class="line">  <span class="keyword">if</span> (!vm.<span class="variable">$options</span>.render) &#123;</span><br><span class="line">    vm.<span class="variable">$options</span>.render = createEmptyVNode</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment"># 这时候还没有进行挂载 </span></span><br><span class="line">callHook(vm, <span class="string">&#x27;beforeMount&#x27;</span>)</span><br><span class="line">  <span class="built_in">let</span> updateComponent</span><br><span class="line">  /* istanbul ignore <span class="keyword">if</span> */</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; config.performance &amp;&amp; mark) &#123;</span><br><span class="line">    updateComponent = () =&gt; &#123;</span><br><span class="line">      const name = vm._name</span><br><span class="line">      const id = vm._uid</span><br><span class="line">      const startTag = `vue-perf-start:<span class="variable">$&#123;id&#125;</span>`</span><br><span class="line">      const endTag = `vue-perf-end:<span class="variable">$&#123;id&#125;</span>`</span><br><span class="line"></span><br><span class="line">      mark(startTag)</span><br><span class="line">      const vnode = vm._render() // 生成虚拟dom</span><br><span class="line">      mark(endTag)</span><br><span class="line">      measure(`vue <span class="variable">$&#123;name&#125;</span> render`, startTag, endTag)</span><br><span class="line"></span><br><span class="line">      mark(startTag)</span><br><span class="line">      vm._update(vnode, hydrating) // 传入虚拟dom,渲染成真正的dom</span><br><span class="line">      mark(endTag)</span><br><span class="line">      measure(`vue <span class="variable">$&#123;name&#125;</span> patch`, startTag, endTag)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    updateComponent = () =&gt; &#123;</span><br><span class="line">      vm._update(vm._render(), hydrating)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># 终于在这看到了 new Watcher的入口，updateComponent是一个函数，_update生成了实际的dom,现在我们到watcher里看看对updateComponent的操作</span></span><br><span class="line"></span><br><span class="line">  new Watcher(vm, updateComponent, noop, &#123;</span><br><span class="line">    <span class="function"><span class="title">before</span></span> () &#123;</span><br><span class="line">      <span class="keyword">if</span> (vm._isMounted &amp;&amp; !vm._isDestroyed) &#123;</span><br><span class="line">        callHook(vm, <span class="string">&#x27;beforeUpdate&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="literal">true</span> /* isRenderWatcher */)</span><br><span class="line">  hydrating = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">if</span> (vm.<span class="variable">$vnode</span> == null) &#123;</span><br><span class="line">    vm._isMounted = <span class="literal">true</span></span><br><span class="line">    callHook(vm, <span class="string">&#x27;mounted&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> vm</span><br><span class="line">&#125;</span><br><span class="line">  </span><br></pre></td></tr></table></figure>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/09/03/vue-lifeCycle/">
    <time datetime="2021-09-03T09:00:57.000Z" class="entry-date">
        2021-09-03
    </time>
</a>
    
    
    </footer>
</article>






  
  
    <nav id="pagination">
      <nav id="page-nav">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
      </nav>
    </nav>
  

</div></div>
        <div id="secondary" class="widget-area" role="complementary">
  
    <aside id="search" class="widget widget_search"><form role="search" method="get" accept-charset="utf-8" id="searchform" class="searchform" action="//google.com/search">
    <div>
        <input type="text" value="" name="s" id="s" />
        <input type="submit" id="searchsubmit" value="搜索" />
    </div>
</form></aside>
  
    
  
    
  
    
  <aside class="widget">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-content">
      <ul>
        
          <li>
            <a href="/2021/11/06/%E7%BC%96%E7%A8%8B%E9%A2%98/">编程题</a>
          </li>
        
          <li>
            <a href="/2021/10/11/%E6%80%BB%E7%BB%93/">总结</a>
          </li>
        
          <li>
            <a href="/2021/09/17/webpack/">webpack</a>
          </li>
        
          <li>
            <a href="/2021/09/07/vue-observer/">vue-observer</a>
          </li>
        
          <li>
            <a href="/2021/09/07/vue-state/">vue-state</a>
          </li>
        
      </ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-content">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-content tagcloud">
      <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/vue/" style="font-size: 10px;">vue</a>
    </div>
  </aside>

  
</div>
      </div>
      <footer id="colophon" role="contentinfo">
    <p>&copy; 2022 John Doe
    All rights reserved.</p>
    <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</footer>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/js/share.js'];</script>

<script src="/js/jquery-3.3.1.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


<script src="/js/navigation.js"></script>

<div id="bg"></div>

  </div>
</body>
</html>