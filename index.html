<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  

  
  
  
  
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  

  
  <!-- baidu webmaster push -->
  <script src='//push.zhanzhang.baidu.com/push.js'></script>
<meta name="generator" content="Hexo 5.4.0"></head>
<body class="home blog custom-background custom-font-enabled single-author">
  <div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="Hexo" rel="home">Hexo</a>
      </h1>
      
        <h2 class="site-description hitokoto"></h2>
        <script type="text/javascript" src="https://v1.hitokoto.cn/?encode=js"></script>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Home</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/archives">Archives</a></li>
                
                </ul>
            </div>
    </nav>
</header>

      <div id="main" class="wrapper">
        <div id="primary" class="site-content"><div id="content" role="main">
  
    <article id="post-编程题" class="post-编程题 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/11/06/%E7%BC%96%E7%A8%8B%E9%A2%98/">编程题</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/11/06/%E7%BC%96%E7%A8%8B%E9%A2%98/" data-id="ckxmsj7lo000mou0s4hgdg887" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>使用Math.max()进行排序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> arr = [1,2,4,5,3,5,66,3,32,23232,4545,66,7,11]</span><br><span class="line"><span class="built_in">let</span> newArr  = [];</span><br><span class="line"><span class="keyword">function</span> sliceArr (arr) &#123;</span><br><span class="line">    const index = arr.findIndex(item =&gt;item ===Math.max(...arr));</span><br><span class="line">    newArr.unshift(arr[index])</span><br><span class="line">    arr.splice(index,1)</span><br><span class="line">    arr.length &amp;&amp; sliceArr(arr);</span><br><span class="line">    <span class="built_in">return</span> newArr</span><br><span class="line">&#125;</span><br><span class="line">const res = sliceArr(arr)</span><br></pre></td></tr></table></figure>
<p>1.快速排序<br>原理：取中间数作为基准值，其他值与这个数进行对比，如果小于，则塞入left数组，大于塞入right数组，递归，直到所有的数组剩下一个值，返回</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> quickSort (arr) &#123;</span><br><span class="line">    <span class="keyword">if</span>(arr.length &lt;= 1) &#123;</span><br><span class="line">        <span class="built_in">return</span> arr</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">let</span> index = Math.floor(arr.length/2)</span><br><span class="line">    <span class="built_in">let</span> current = arr.splice(index,1)[0];</span><br><span class="line">    <span class="built_in">let</span> left = [];</span><br><span class="line">    <span class="built_in">let</span> right = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">let</span> i =0;i&lt;arr.length;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[i] &lt; current) &#123;</span><br><span class="line">            left.push(arr[i])</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            right.push(arr[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="built_in">return</span> quickSort(left).concat([current],quickSort(right))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> res = quickSort([1,3,5,3,2,7,78,65,54,78,90,4,55,5677])</span><br><span class="line">console.log(res,<span class="string">&#x27;ressss&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>2.冒泡排序<br>是由两层循环嵌套，每执行一轮内层的循环，都会把最大的值放到数组的最后，所以下一次循环，就会截取arr.length-i-1进行循环</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> pup(arr) &#123;</span><br><span class="line">  <span class="keyword">for</span> ( <span class="built_in">let</span> i =0;i&lt;arr.length-1;i++) &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">let</span> j = 0;j&lt;arr.length-i-1;j++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[j] &gt; arr[j+1]) &#123;</span><br><span class="line">            <span class="built_in">let</span> temp = arr[j];</span><br><span class="line">            arr[j] = arr[j+1]</span><br><span class="line">            arr[j+1] = temp</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> arr</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> res = pup([8,5,4,6,74,54,3232,5545,545,55])</span><br><span class="line">console.log(res,<span class="string">&#x27;resss&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>3.选择排序<br>每次循环里层的时候，找到最小的值的index,对minIndex进行重新赋值，并换位置，使得最小的值总是被提到最前面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> func(arr) &#123;</span><br><span class="line">    <span class="built_in">let</span> minIndex, temp;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">let</span> i = 0; i &lt; arr.length; i++) &#123;</span><br><span class="line">        minIndex = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">let</span> j = i + 1; j &lt; arr.length; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[j] &lt; arr[minIndex]) &#123;</span><br><span class="line">                minIndex = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        temp = arr[i];</span><br><span class="line">        arr[i] = arr[minIndex]</span><br><span class="line">        arr[minIndex] = temp</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> arr</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> res = func([23, 4, 6, 7, 4, 3, 434, 545, 65, 6565, 434, 45])</span><br><span class="line">console.log(res, <span class="string">&#x27;resss&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>4.url拆解问题</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> url = <span class="string">&#x27;http://sample.com/?a=1&amp;e&amp;b=2&amp;c=xx&amp;d#hash&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> fuc(url) &#123;</span><br><span class="line">    <span class="built_in">let</span> obj = &#123;&#125;</span><br><span class="line">    <span class="built_in">let</span> query = url.split(<span class="string">&#x27;?&#x27;</span>)[1].split(<span class="string">&#x27;#&#x27;</span>)[0].split(<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line">    query.forEach(item =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (item.split(<span class="string">&#x27;=&#x27;</span>)[1]) &#123;</span><br><span class="line">            obj[item.split(<span class="string">&#x27;=&#x27;</span>)[0]] = item.split(<span class="string">&#x27;=&#x27;</span>)[1]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">return</span> obj</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> res = fuc(url)</span><br><span class="line">console.log(res, <span class="string">&#x27;ressss&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>5.数组扁平化<br>原地解法： 首选这种</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.flat(3)  // 3代表递归的层数</span><br></pre></td></tr></table></figure>
<p>第一种方法 ： 递归方式实现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> arr = [1, 2, 3, [3, 4, 5], [7, 6, 4]]</span><br><span class="line"><span class="built_in">let</span> newArr = []</span><br><span class="line"><span class="keyword">function</span> func(arr) &#123;</span><br><span class="line">    arr.forEach(item =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (Array.isArray(item)) &#123;</span><br><span class="line">            func(item)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newArr.push(item)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">func(arr)</span><br><span class="line">console.log(newArr, <span class="string">&#x27;newArr&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>第二种方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String(arr).split(<span class="string">&#x27;,&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>第三种</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> flatten(arr) &#123;</span><br><span class="line">    <span class="keyword">while</span>(arr.some(item =&gt; Array.isArray(item))) &#123;</span><br><span class="line">        console.log(arr)</span><br><span class="line">        arr = [].concat(...arr)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> arr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6.深拷贝<br>第一种：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JSON.parse(JSON.stringify(copyObj))</span><br></pre></td></tr></table></figure>
<p>第二种</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> deepClone(obj) &#123;</span><br><span class="line">    <span class="keyword">if</span>(Object.prototype.toString.call(obj)!=<span class="string">&#x27;[object Object]&#x27;</span></span><br><span class="line">     &amp;&amp; Object.prototype.toString.call(obj)!=<span class="string">&#x27;[object Array]&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">return</span> obj</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">let</span> res </span><br><span class="line">    <span class="keyword">if</span>(obj instanceof Array ) &#123;</span><br><span class="line">        res = []</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">       res  = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">if</span>(obj.hasOwnProperty(key)) &#123;</span><br><span class="line">            res[key] = deepClone(obj[key])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> obj = &#123;a:&#123;b:&#123;c:<span class="string">&#x27;ccc&#x27;</span>&#125;&#125;,f:[1,2,3,[4,5,[6,7]]]&#125;</span><br><span class="line"><span class="built_in">let</span> newobj = deepClone(obj)</span><br><span class="line"></span><br><span class="line">obj.a.b = <span class="string">&#x27;111&#x27;</span></span><br><span class="line">console.log(newobj,<span class="string">&#x27;newobj&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>7.浅拷贝<br>第一种：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object.assign(&#123;&#125;,obj)</span><br></pre></td></tr></table></figure>
<p>第二种 ：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> &#123;...cloneObj&#125; = obj</span><br></pre></td></tr></table></figure>
<p>8.手写bind函数<br>这样shuo :bind返回一个函数，这个函数的参数<br>首先看下bind函数的用法 以及bind 函数及apply,call函数的区别<br>bind函数是返回一个函数， apply,call函数是调用原函数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.myBind = <span class="keyword">function</span> (context,...args) &#123;</span><br><span class="line">    // <span class="built_in">bind</span>的原理就是返回一个函数，参数是里外函数参数的集合</span><br><span class="line">    <span class="keyword">if</span>(typeof this !==<span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">       a  </span><br><span class="line">    &#125;</span><br><span class="line">    const _self = this;</span><br><span class="line">    <span class="built_in">return</span> <span class="keyword">function</span>(...anotherArg) &#123;</span><br><span class="line">        <span class="built_in">return</span> _self.apply(context,[...args,...anotherArg])</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">function</span> foo(name,age) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> obj = &#123;lick:<span class="string">&#x27;1222&#x27;</span>&#125;</span><br><span class="line"><span class="built_in">let</span> a = foo.bind(obj)</span><br><span class="line">a(13,12)</span><br><span class="line">console.log(obj)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>9.首先call函数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.myCall = <span class="keyword">function</span>(context,...args) &#123;</span><br><span class="line">    //原理是把foo作为obj的一个属性，然后去调用</span><br><span class="line">    <span class="keyword">if</span>(typeof this !== <span class="string">&#x27;function&#x27;</span>)&#123;</span><br><span class="line">      throw new TypeError(<span class="string">&#x27;It must be a function&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!context) &#123;</span><br><span class="line">        context = window</span><br><span class="line">    &#125;</span><br><span class="line">    const fn = Symbol();</span><br><span class="line">    context[fn] = this;</span><br><span class="line">    const result = context[fn](...args)</span><br><span class="line">    delete context[fn]</span><br><span class="line">    <span class="built_in">return</span> result    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> foo(name,age) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> obj = &#123;lick:<span class="string">&#x27;1222&#x27;</span>&#125;</span><br><span class="line"> foo.myCall(obj,<span class="string">&#x27;12&#x27;</span>,22)</span><br><span class="line"> console.log(obj)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>10.手写apply<br>跟call唯一的区别就是call传的是数组解构后的值，apply 传的是数组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Function.prototype.myApply = <span class="keyword">function</span>(context,args) &#123;</span><br><span class="line">    //原理是把foo作为obj的一个属性，然后去调用</span><br><span class="line">    <span class="keyword">if</span>(typeof this !== <span class="string">&#x27;function&#x27;</span>)&#123;</span><br><span class="line">      throw new TypeError(<span class="string">&#x27;It must be a function&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!context) &#123;</span><br><span class="line">        context = window</span><br><span class="line">    &#125;</span><br><span class="line">    const fn = Symbol();</span><br><span class="line">    context[fn] = this;</span><br><span class="line">    const result = context[fn](...args)</span><br><span class="line">    delete context[fn]</span><br><span class="line">    <span class="built_in">return</span> result    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> foo(name,age) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> obj = &#123;lick:<span class="string">&#x27;1222&#x27;</span>&#125;</span><br><span class="line"> foo.myApply(obj,[<span class="string">&#x27;12&#x27;</span>,22])</span><br><span class="line"> console.log(obj)</span><br></pre></td></tr></table></figure>
<p>11.手写promise.all<br>全部是true才返回列表，否则返回第一个报错的，且参数必须是Promise的集合</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> all(promiseArray) &#123;</span><br><span class="line">    <span class="keyword">if</span>(promiseArray.some(item =&gt;!(item instanceof Promise)))&#123;</span><br><span class="line">         throw new Error(<span class="string">&#x27;有存在不是promise的&#x27;</span>)</span><br><span class="line">         <span class="built_in">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">let</span> result = []</span><br><span class="line">    <span class="built_in">return</span> new Promise((resolve,reject) =&gt; &#123;</span><br><span class="line">        promiseArray.forEach(item =&gt; &#123;</span><br><span class="line">            item.then(res =&gt; &#123;</span><br><span class="line">                result.push(res)</span><br><span class="line">                result.length == promiseArray.length &amp;&amp; (resolve(result))</span><br><span class="line">            &#125;).catch(err =&gt; &#123;</span><br><span class="line">                reject(err)  </span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> p1 = Promise.resolve(1)</span><br><span class="line"><span class="built_in">let</span> p2 = Promise.resolve(2)</span><br><span class="line"><span class="built_in">let</span> p3 =1</span><br><span class="line">all([p1,p2,p3]).<span class="keyword">then</span>(res =&gt; &#123;</span><br><span class="line">    console.log(res,<span class="string">&#x27;ressss&#x27;</span>)</span><br><span class="line">&#125;).catch(err =&gt; &#123;</span><br><span class="line">    console.log(err,<span class="string">&#x27;errr&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>12.race </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// 实现promise.race，返回第一个为<span class="literal">false</span>的值，数组必须是promise的集合</span><br><span class="line"><span class="keyword">function</span> race(promiseArray) &#123;</span><br><span class="line">    <span class="keyword">if</span>(promiseArray.some(item =&gt;!(item instanceof Promise)))&#123;</span><br><span class="line">         throw new Error(<span class="string">&#x27;有存在不是promise的&#x27;</span>)</span><br><span class="line">         <span class="built_in">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> new Promise((resolve,reject) =&gt; &#123;</span><br><span class="line">        promiseArray.forEach(item =&gt; &#123;</span><br><span class="line">            item.then(res =&gt; &#123;</span><br><span class="line">                resolve(res)</span><br><span class="line">            &#125;).catch(err =&gt; &#123;</span><br><span class="line">                reject(err)  </span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> p1 = Promise.reject(1)</span><br><span class="line"><span class="built_in">let</span> p2 = Promise.resolve(2)</span><br><span class="line"><span class="built_in">let</span> p3 =Promise.resolve(3)</span><br><span class="line">race([p1,p2,p3]).<span class="keyword">then</span>(res =&gt; &#123;</span><br><span class="line">    console.log(res,<span class="string">&#x27;ressss&#x27;</span>)</span><br><span class="line">&#125;).catch(err =&gt; &#123;</span><br><span class="line">    console.log(err,<span class="string">&#x27;errr&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>13.防抖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> debounce(fn,delay=1000) &#123;</span><br><span class="line">    <span class="built_in">let</span> timer = null;</span><br><span class="line">    <span class="built_in">return</span> (...args) =&gt;  &#123;</span><br><span class="line">        <span class="keyword">if</span>(timer) &#123;</span><br><span class="line">            clearTimeout(timer)</span><br><span class="line">        &#125;</span><br><span class="line">        timer = setTimeout(() =&gt; &#123;</span><br><span class="line">            fn.call(this,...args)</span><br><span class="line">        &#125;,delay)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> input  = document.getElementById(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">input.addEventListener(<span class="string">&#x27;keyup&#x27;</span>,debounce(() =&gt; &#123;</span><br><span class="line">    console.log(<span class="string">&#x27;执行&#x27;</span>)</span><br><span class="line">&#125;,3000))</span><br></pre></td></tr></table></figure>
<p>14.节流</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> throttle(func,delay) &#123;</span><br><span class="line">    <span class="built_in">let</span> acTime  = 0;</span><br><span class="line">    <span class="built_in">return</span> () =&gt; &#123;</span><br><span class="line">        const current = Date.now();</span><br><span class="line">        <span class="keyword">if</span>(current-acTime &gt; delay) &#123;</span><br><span class="line">            func.apply(this,arguments)</span><br><span class="line">            acTime = Date.now()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">let</span> input = document.getElementById(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">input.addEventListener(<span class="string">&#x27;keyup&#x27;</span>, throttle(() =&gt; &#123;</span><br><span class="line">    console.log(<span class="string">&#x27;执行&#x27;</span>)</span><br><span class="line">&#125;, 5000))</span><br></pre></td></tr></table></figure>
<p>15.如何用Ajax实现一个post请求</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var ajax = new XMLHttpRequest();</span><br><span class="line">ajax.open(<span class="string">&#x27;post&#x27;</span>,url,)</span><br><span class="line">ajax.setRequestHeader(<span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;text-plain&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span>(data) &#123;</span><br><span class="line">  ajax.send(data)</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">  ajax.send()</span><br><span class="line">&#125;</span><br><span class="line">ajax.onreadystatechange = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">  <span class="keyword">if</span>(ajax.readyState ==4 &amp;&amp; ajax.status ===200) &#123;</span><br><span class="line">    console.log(responseText)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>16.vue的双向绑定过程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> Target = null;</span><br><span class="line"><span class="built_in">let</span> data = &#123;</span><br><span class="line">    a: 1,</span><br><span class="line">    b: 2,</span><br><span class="line">    c: &#123; d: <span class="string">&#x27;111&#x27;</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">let</span> i <span class="keyword">in</span> data) &#123;</span><br><span class="line">    observer(i, data[i], data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> observer(key, value, data) &#123;</span><br><span class="line">    <span class="built_in">let</span> subs = [];</span><br><span class="line">    value = value || data[key]</span><br><span class="line">    Object.defineProperty(data, key,</span><br><span class="line">        &#123;</span><br><span class="line">            get: <span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">                console.log(Target,<span class="string">&#x27;11&#x27;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (Target) &#123;</span><br><span class="line">                    subs.push(Target)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">return</span> value</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="built_in">set</span>: <span class="keyword">function</span> (newValue) &#123;</span><br><span class="line">                value = newValue</span><br><span class="line">                subs.forEach(fn =&gt; fn())</span><br><span class="line">                <span class="built_in">return</span> value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> watch(key, callback) &#123;</span><br><span class="line">    console.log(key,callback)</span><br><span class="line">    Target = callback;</span><br><span class="line">    data[key];</span><br><span class="line">    Target = null;</span><br><span class="line">&#125;</span><br><span class="line">watch(<span class="string">&#x27;a&#x27;</span>,<span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">    console.log(12)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>17.继承</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> Parent(name,eye) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.eye = eye</span><br><span class="line">&#125;</span><br><span class="line">Parent.prototype.getName = <span class="function"><span class="title">function</span></span>() &#123;</span><br><span class="line">    <span class="built_in">return</span> this.name</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> Child(name,age,...args) &#123;</span><br><span class="line">    Parent.call(this,name,age)</span><br><span class="line">    this.other = args</span><br><span class="line">&#125;</span><br><span class="line">Child.prototype = Parent.prototype</span><br><span class="line"><span class="built_in">let</span> child = new Child(<span class="string">&#x27;一个名字1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">console.log(child.getName())</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>18.eventBus实现 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">// 试下eventbus</span><br><span class="line">class EventBus &#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span></span>() &#123;</span><br><span class="line">        this.event = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    on(name,fn) &#123;</span><br><span class="line">       </span><br><span class="line">        (!this.event[name] &amp;&amp; (this.event[name] = [])).push(fn)</span><br><span class="line">    &#125;</span><br><span class="line">    emit(name,...args) &#123;</span><br><span class="line">        this.event[name] &amp;&amp; this.event[name].forEach(fn=&gt; &#123;</span><br><span class="line">            fn(...args)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    once(name,fn) &#123;</span><br><span class="line">        const cb = (...args) =&gt; &#123;</span><br><span class="line">            fn.apply(this,args)</span><br><span class="line">            this.off(name,fn)</span><br><span class="line">        &#125;</span><br><span class="line">        this.on(name,cb)</span><br><span class="line">    &#125;</span><br><span class="line">    off(name,offcb) &#123;</span><br><span class="line">        <span class="keyword">if</span>(this.event[name]) &#123;</span><br><span class="line">            <span class="built_in">let</span> index = this.event[name].findIndex(fn=&gt;&#123;</span><br><span class="line">                <span class="built_in">return</span> fn===offcb</span><br><span class="line">            &#125;)</span><br><span class="line">            this.event[name].splice(index,1)</span><br><span class="line">            <span class="keyword">if</span>(!this.event[name].length) &#123;</span><br><span class="line">                delete this.event[name]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> bus = new EventBus();</span><br><span class="line">bus.on(<span class="string">&quot;start&quot;</span>, <span class="keyword">function</span> (...arg) &#123;</span><br><span class="line">    console.log(arg,<span class="string">&#x27;arg&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">bus.emit(<span class="string">&#x27;start&#x27;</span>,<span class="string">&#x27;ad&#x27;</span>,<span class="string">&#x27;ed&#x27;</span>)</span><br><span class="line">bus.emit(<span class="string">&#x27;start&#x27;</span>,<span class="string">&#x27;vvvv&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>19,手写Promise</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">//手写一个promise</span><br><span class="line">const RESOLVED = <span class="string">&#x27;RESOLVED&#x27;</span>;</span><br><span class="line">const REJECTED = <span class="string">&#x27;REJECTED&#x27;</span>;</span><br><span class="line">const PENDING = <span class="string">&#x27;PENDING&#x27;</span>;</span><br><span class="line">class MyPromise &#123;</span><br><span class="line">    constructor(excutor) &#123;</span><br><span class="line">        this.status = PENDING;</span><br><span class="line">        this.value = undefined;</span><br><span class="line">        this.reason = undefined;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">let</span> catchs = (rej) =&gt; &#123;</span><br><span class="line">            rej(this.reason)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="built_in">let</span> resolve = (value) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (this.status == PENDING) &#123;</span><br><span class="line">                this.value = value;</span><br><span class="line">                this.status = RESOLVED</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">let</span> reject = (reason) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (this.status == PENDING) &#123;</span><br><span class="line">                this.reason = reason;</span><br><span class="line">                this.status = REJECTED</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            excutor(resolve, reject)</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">            reject(e)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">then</span>(onfulfilled, onrejected) &#123;</span><br><span class="line">        <span class="keyword">if</span> (this.status == RESOLVED) &#123;</span><br><span class="line">            <span class="built_in">let</span> res = onfulfilled(this.value)</span><br><span class="line">            <span class="built_in">return</span> new MyPromise((resolve, reject)=&gt;  &#123;</span><br><span class="line">                resolve(res)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (this.status == REJECTED) &#123;</span><br><span class="line">            <span class="built_in">let</span> rej = onrejected &amp;&amp; onrejected(this.reason)</span><br><span class="line">            <span class="built_in">return</span> new MyPromise((resolve, reject) =&gt; &#123;</span><br><span class="line">                reject(rej || this.reason)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    catch(onrejected) &#123;</span><br><span class="line">       this.status == REJECTED&amp;&amp;  onrejected(this.reason)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> p = new MyPromise((res, rej) =&gt; &#123;</span><br><span class="line">    rej(<span class="string">&#x27;错了&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">p.then(res =&gt; &#123;</span><br><span class="line">    console.log(res, <span class="string">&#x27;1111&#x27;</span>)</span><br><span class="line">&#125;).<span class="keyword">then</span>(res =&gt; &#123;</span><br><span class="line">    console.log(res, <span class="string">&#x27;reeeee&#x27;</span>)</span><br><span class="line">&#125;).catch(err =&gt; &#123;</span><br><span class="line">    console.log(err, 111)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>








      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/11/06/%E7%BC%96%E7%A8%8B%E9%A2%98/">
    <time datetime="2021-11-06T07:50:22.000Z" class="entry-date">
        2021-11-06
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-自动化生成页面模板" class="post-自动化生成页面模板 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/07/30/%E8%87%AA%E5%8A%A8%E5%8C%96%E7%94%9F%E6%88%90%E9%A1%B5%E9%9D%A2%E6%A8%A1%E6%9D%BF/">自动化生成页面模板</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/07/30/%E8%87%AA%E5%8A%A8%E5%8C%96%E7%94%9F%E6%88%90%E9%A1%B5%E9%9D%A2%E6%A8%A1%E6%9D%BF/" data-id="ckxmsj7lp000nou0sbr8m1hzw" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>场景 ： 满足新增带修改页面的模板或新增一个单独的vue文件，区分变量 simple<br>使用方法 ：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run bpage src/views/admin/pages/position <span class="built_in">test</span> simple</span><br></pre></td></tr></table></figure>
<p>pageage.json中 scripts 添加命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;bpage&quot;</span>: <span class="string">&quot;node ./src/utils/build-page.js&quot;</span>,</span><br></pre></td></tr></table></figure>
<p>新建build-page.js,写入下面代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">var fs = require(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line">var path = require(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">// 获取要写入的URL</span><br><span class="line"><span class="built_in">let</span> pathUrl = process.argv[2];</span><br><span class="line">// 创建的文件夹的名称</span><br><span class="line"><span class="built_in">let</span> fileName = process.argv[3];</span><br><span class="line">// 是否只创建单页面</span><br><span class="line"><span class="built_in">let</span> simple = process.argv[4];</span><br><span class="line">// 检测path是否以/结尾</span><br><span class="line"><span class="built_in">let</span> regEnd = /\/$/  </span><br><span class="line"><span class="built_in">let</span> regStart = /^\// </span><br><span class="line">// 格式化path 和name，path后面带/，name前面不带/</span><br><span class="line"><span class="built_in">let</span> aPath = regEnd.test(pathUrl) ? pathUrl : pathUrl+<span class="string">&#x27;/&#x27;</span></span><br><span class="line"><span class="built_in">let</span> aName = regStart.test(fileName) ? fileName.slice(1) : fileName</span><br><span class="line">//path.resolve(aPath+aName)获取到的是相对路径，比如在 项目根目录下执行结果为 /User/.../项目根目录/写入的目录</span><br><span class="line"><span class="built_in">let</span> fullPath = path.resolve(aPath+aName)</span><br><span class="line">//文件写入</span><br><span class="line">const fileWrite = <span class="keyword">function</span>(from,to) &#123;</span><br><span class="line">  <span class="built_in">let</span> readable=fs.createReadStream(from,&#123;encoding:<span class="string">&#x27;utf8&#x27;</span>&#125;);</span><br><span class="line">  //simple判断是不是新增一个单独的vue页面（），如果是单独的页面，以to+<span class="string">&#x27;.vue&#x27;</span>创建文件</span><br><span class="line">  <span class="built_in">let</span> writable=simple ? fs.createWriteStream(to+<span class="string">&#x27;.vue&#x27;</span>) : fs.createWriteStream(to);</span><br><span class="line">  readable.pipe(writable);</span><br><span class="line">&#125;</span><br><span class="line">//文件夹写入</span><br><span class="line">const dirWrite = <span class="keyword">function</span>(from,to,callback) &#123;</span><br><span class="line">  //创建新的目录，并执行回调</span><br><span class="line">  fs.mkdir(to,<span class="keyword">function</span>(error)&#123;</span><br><span class="line">    <span class="keyword">if</span>(error)&#123;</span><br><span class="line">        console.log(error);</span><br><span class="line">        <span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  callback(from,to);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const copyDir = <span class="keyword">function</span>(from,to) &#123;</span><br><span class="line">  //读取源文件夹，得到的paths是文件的集合</span><br><span class="line">  fs.readdir(from,<span class="keyword">function</span>(err,paths)&#123;</span><br><span class="line">    <span class="keyword">if</span>(err)throw err;</span><br><span class="line">    paths.forEach(pathName =&gt; &#123;</span><br><span class="line">      //获取到文件的路径</span><br><span class="line">      var _copyFrom=from+<span class="string">&#x27;/&#x27;</span>+pathName;</span><br><span class="line">      var _copyTo=to+<span class="string">&#x27;/&#x27;</span>+pathName;</span><br><span class="line">      //判断目标文件是否存在，不存在先创建再写入，存在的话直接写入</span><br><span class="line">      fs.access(_copyTo, fs.constants.F_OK, (err) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123; </span><br><span class="line">          //如果不存在，调用copy  </span><br><span class="line">          copy(_copyFrom,_copyTo,copyDir)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          copyDir(_copyFrom,_copyTo);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const copy = <span class="keyword">function</span> (from ,to ,callback) &#123;</span><br><span class="line">  fs.stat(from ,<span class="keyword">function</span> (err,stats) &#123;</span><br><span class="line">    <span class="keyword">if</span>(stats.isFile()) &#123;</span><br><span class="line">      fileWrite(from ,to)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123; </span><br><span class="line">      dirWrite(from,to,callback)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//components/common/add-page-withedit 下存放的是带修改功能的文件 ，components/common/add-simplepage/index.vue 是单文件</span><br><span class="line"></span><br><span class="line"><span class="built_in">let</span> templatePath = !simple ?  <span class="string">&#x27;../components/common/add-page-withedit&#x27;</span> : <span class="string">&#x27;../components/common/add-simplepage/index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line">copy(path.resolve(__dirname,templatePath),fullPath,copyDir)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>




      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/07/30/%E8%87%AA%E5%8A%A8%E5%8C%96%E7%94%9F%E6%88%90%E9%A1%B5%E9%9D%A2%E6%A8%A1%E6%9D%BF/">
    <time datetime="2021-07-30T08:49:41.000Z" class="entry-date">
        2021-07-30
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-vue添加全局水印" class="post-vue添加全局水印 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/07/27/vue%E6%B7%BB%E5%8A%A0%E5%85%A8%E5%B1%80%E6%B0%B4%E5%8D%B0/">vue添加全局水印</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/07/27/vue%E6%B7%BB%E5%8A%A0%E5%85%A8%E5%B1%80%E6%B0%B4%E5%8D%B0/" data-id="ckxmsj7li000cou0s8dx0gval" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>首先在utils目录下增加watermarkDom文件，文件内容如下,这里因为想达到类似企业微信的水印做了一下修改，增加了str2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;use strict&#x27;</span></span><br><span class="line">import store from <span class="string">&#x27;@/store&#x27;</span></span><br><span class="line">const watermark = &#123;</span><br><span class="line">    <span class="built_in">set</span>: <span class="keyword">function</span> (str, str2) &#123;</span><br><span class="line">        var canvas = document.createElement(<span class="string">&#x27;canvas&#x27;</span>)</span><br><span class="line">        canvas.width = 450;</span><br><span class="line">        canvas.height = 200;</span><br><span class="line">        // canvas.style.display = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">        var shuiyin = canvas.getContext(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">        // 控制文字的旋转角度和上下位置</span><br><span class="line">        // shuiyin.rotate(-15 * Math.PI / 180);</span><br><span class="line">        // shuiyin.translate(-50, 20)</span><br><span class="line">        //文字颜色</span><br><span class="line">        shuiyin.fillStyle = <span class="string">&quot;rgba(200, 200, 200, 0.2)&quot;</span>;</span><br><span class="line">        //文字样式</span><br><span class="line">        shuiyin.font = <span class="string">&quot;14px Vedana&quot;</span>;</span><br><span class="line">        shuiyin.fillText(str, 0, 50)</span><br><span class="line">        shuiyin.fillText(str2, 220, 150)</span><br><span class="line">        /* 新建一个用于填充canvas水印的标签，之所以没有直接在body上添加，</span><br><span class="line">           是因为z-index对个别内容影响，才考虑的不用body */</span><br><span class="line">        var watermark = document.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">        const styleStr = `</span><br><span class="line">            position:fixed;</span><br><span class="line">            top:-20vh;</span><br><span class="line">            left:-50vw;</span><br><span class="line">            width:200vw;</span><br><span class="line">            height:200vh;</span><br><span class="line">            z-index:99999;</span><br><span class="line">            transform : rotate(-15deg);</span><br><span class="line">            pointer-events:none;</span><br><span class="line">            background-repeat:repeat;</span><br><span class="line">            mix-blend-mode: multiply;</span><br><span class="line">            background-image:url(<span class="string">&#x27;$&#123;canvas.toDataURL(&quot;image/png&quot;)&#125;&#x27;</span>)`;</span><br><span class="line">        watermark.setAttribute(<span class="string">&#x27;style&#x27;</span>, styleStr);</span><br><span class="line">        watermark.classList.add(<span class="string">&#x27;watermark&#x27;</span>)</span><br><span class="line">        document.body.appendChild(watermark)</span><br><span class="line"></span><br><span class="line">        //此方法是防止用户通过控制台修改样式去除水印效果</span><br><span class="line">        /* MutationObserver 是一个可以监听DOM结构变化的接口。 */</span><br><span class="line">        const observer = new MutationObserver(() =&gt; &#123;</span><br><span class="line">            const wmInstance = document.querySelector(<span class="string">&#x27;.watermark&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> ((wmInstance &amp;&amp; wmInstance.getAttribute(<span class="string">&#x27;style&#x27;</span>) !== styleStr) || !wmInstance) &#123;</span><br><span class="line">                //如果标签在，只修改了属性，重新赋值属性</span><br><span class="line">                <span class="keyword">if</span> (wmInstance) &#123;</span><br><span class="line">                    // 避免一直触发</span><br><span class="line">                    // observer.disconnect();</span><br><span class="line">                    // console.log(<span class="string">&#x27;水印属性修改了&#x27;</span>);</span><br><span class="line">                    wmInstance.setAttribute(<span class="string">&#x27;style&#x27;</span>, styleStr);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    /* 此处根据用户登录状态，判断是否终止监听，避免用户退出后登录页面仍然有水印 */</span><br><span class="line">                    <span class="keyword">if</span> (store.state.user.token) &#123;</span><br><span class="line">                        //标签被移除，重新添加标签</span><br><span class="line">                        console.log(<span class="string">&#x27;水印标签被移除了&#x27;</span>);</span><br><span class="line">                        document.body.appendChild(watermark)</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        observer.disconnect();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        observer.observe(document.body, &#123;</span><br><span class="line">            attributes: <span class="literal">true</span>,</span><br><span class="line">            subtree: <span class="literal">true</span>,</span><br><span class="line">            childList: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    close: <span class="function"><span class="title">function</span></span> () &#123;</span><br><span class="line">        /* 关闭页面的水印，即要移除水印标签 */</span><br><span class="line">        <span class="built_in">let</span> watermark = document.querySelector(<span class="string">&#x27;.watermark&#x27;</span>)</span><br><span class="line">        document.body.removeChild(watermark)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">export</span> default watermark</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在获取用户信息接口中，调用watermark.set()，接口调用完之后，页面会出现水印</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/07/27/vue%E6%B7%BB%E5%8A%A0%E5%85%A8%E5%B1%80%E6%B0%B4%E5%8D%B0/">
    <time datetime="2021-07-27T02:27:53.000Z" class="entry-date">
        2021-07-27
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-Vue" class="post-Vue post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/07/08/Vue/">Vue</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/07/08/Vue/" data-id="ckxmsj7kz0000ou0sh8u3fanm" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>inheritAttrs: false, //一个没见过的</p>
<p>接下来，按我的理解来理一下vue实现的过程<br>首先打开项目node_modules的vue/src/core/index.js,从这可以看到，入口文件是’instance/index’,</p>
<p>执行了[initGlobalAPI(Vue)]</p>
<p>进到 instance/index中，这个文件对Vue做了一系列的初始化</p>
<p>首先执行this._init(options)，所以先看init.js 文件</p>
<p>我在一个页面打印 console.log(this, this.constructor, “this”);打印出的结果如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> VueComponent (options) &#123;</span><br><span class="line">      this._init(options);</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<p>这段代码在Vue.extend中找到了，可见后面创建的页面应该是通过Vue.extend创建的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> resolveConstructorOptions (Ctor: Class&lt;Component&gt;) &#123;</span><br><span class="line">  <span class="built_in">let</span> options = Ctor.options</span><br><span class="line">  <span class="keyword">if</span> (Ctor.super) &#123;</span><br><span class="line">    // 通过Vue.extend 生成的实例会有super属性，</span><br><span class="line">    const superOptions = resolveConstructorOptions(Ctor.super)</span><br><span class="line">    const cachedSuperOptions = Ctor.superOptions</span><br><span class="line">    <span class="keyword">if</span> (superOptions !== cachedSuperOptions) &#123;</span><br><span class="line">      // super option changed,</span><br><span class="line">      // need to resolve new options.</span><br><span class="line">      Ctor.superOptions = superOptions</span><br><span class="line">      // check <span class="keyword">if</span> there are any late-modified/attached options (<span class="comment">#4976)</span></span><br><span class="line">      const modifiedOptions = resolveModifiedOptions(Ctor)</span><br><span class="line">      // update base extend options</span><br><span class="line">      <span class="keyword">if</span> (modifiedOptions) &#123;</span><br><span class="line">        extend(Ctor.extendOptions, modifiedOptions)</span><br><span class="line">      &#125;</span><br><span class="line">      options = Ctor.options = mergeOptions(superOptions, Ctor.extendOptions)</span><br><span class="line">      <span class="keyword">if</span> (options.name) &#123;</span><br><span class="line">        options.components[options.name] = Ctor</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> options</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Vue.use</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> toArray (list, start) &#123;</span><br><span class="line">  start = start || 0;</span><br><span class="line">  var i = list.length - start;</span><br><span class="line">  var ret = new Array(i);</span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    ret[i] = list[i + start];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Vue.use = <span class="keyword">function</span> (plugin) &#123;</span><br><span class="line">   var installedPlugins = (this._installedPlugins || (this._installedPlugins = []));</span><br><span class="line">   <span class="keyword">if</span> (installedPlugins.indexOf(plugin) &gt; -1) &#123;</span><br><span class="line">     <span class="built_in">return</span> this</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   // additional parameters</span><br><span class="line">   var args = toArray(arguments, 1);</span><br><span class="line">   args.unshift(this);</span><br><span class="line">   <span class="keyword">if</span> (typeof plugin.install === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">     plugin.install.apply(plugin, args);</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeof plugin === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">     plugin.apply(null, args);</span><br><span class="line">   &#125;</span><br><span class="line">   installedPlugins.push(plugin);</span><br><span class="line">   <span class="built_in">return</span> this</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>

<h2 id="optionMergeStrategies"><a href="#optionMergeStrategies" class="headerlink" title="optionMergeStrategies"></a>optionMergeStrategies</h2><p>在vue/src/core/config.js中有一段代码,约定optionMergeStrategies是有一个个函数组成的对象</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="built_in">type</span> Config = &#123;</span><br><span class="line">    optionMergeStrategies: &#123; [key: string]: Function &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面代码是默认合并策略，优先取子级，没有的话取父级</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var defaultStrat = <span class="keyword">function</span> (parentVal, childVal) &#123;</span><br><span class="line">  <span class="built_in">return</span> childVal === undefined</span><br><span class="line">    ? parentVal</span><br><span class="line">    : childVal</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="el，propsData"><a href="#el，propsData" class="headerlink" title="el，propsData"></a>el，propsData</h3><p>el，propsData采用默认合并</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const strats = config.optionMergeStrategies = Object.create(null);</span><br><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">  strats.el = strats.propsData = <span class="keyword">function</span> (parent, child, vm, key) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!vm) &#123;</span><br><span class="line">      warn<span class="variable">$1</span>(</span><br><span class="line">        <span class="string">&quot;option \&quot;&quot;</span> + key + <span class="string">&quot;\&quot; can only be used during instance &quot;</span> +</span><br><span class="line">        <span class="string">&#x27;creation with the `new` keyword.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> defaultStrat(parent, child)</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="data"><a href="#data" class="headerlink" title="data"></a>data</h3><p>在!vm情况下，子级不存在，取父级，否则mergeDataOrFn合并，vm存在，mergeDataOrFn合并，参数增加vm</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">strats.data = <span class="keyword">function</span> (</span><br><span class="line">  parentVal,</span><br><span class="line">  childVal,</span><br><span class="line">  vm</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!vm) &#123;</span><br><span class="line">    <span class="keyword">if</span> (childVal &amp;&amp; typeof childVal !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; warn<span class="variable">$1</span>(</span><br><span class="line">        <span class="string">&#x27;The &quot;data&quot; option should be a function &#x27;</span> +</span><br><span class="line">        <span class="string">&#x27;that returns a per-instance value in component &#x27;</span> +</span><br><span class="line">        <span class="string">&#x27;definitions.&#x27;</span>,</span><br><span class="line">        vm</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="built_in">return</span> parentVal</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> mergeDataOrFn(parentVal, childVal)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> mergeDataOrFn(parentVal, childVal, vm)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>看下mergeDataOrFn是什么<br>在没有vm时，return mergedDataFn，else return mergedInstanceDataFn,这里有个区别parentVal.call(this, this)和parentVal.call(vm, vm)，这两个函数都返回mergeData（child,parent）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> mergeDataOrFn (</span><br><span class="line">  parentVal,</span><br><span class="line">  childVal,</span><br><span class="line">  vm</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!vm) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!childVal) &#123;</span><br><span class="line">      <span class="built_in">return</span> parentVal</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!parentVal) &#123;</span><br><span class="line">      <span class="built_in">return</span> childVal</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> <span class="keyword">function</span> <span class="function"><span class="title">mergedDataFn</span></span> () &#123;</span><br><span class="line">      <span class="built_in">return</span> mergeData(</span><br><span class="line">        typeof childVal === <span class="string">&#x27;function&#x27;</span> ? childVal.call(this, this) : childVal,</span><br><span class="line">        typeof parentVal === <span class="string">&#x27;function&#x27;</span> ? parentVal.call(this, this) : parentVal</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">return</span> <span class="keyword">function</span> <span class="function"><span class="title">mergedInstanceDataFn</span></span> () &#123;</span><br><span class="line">      // instance merge</span><br><span class="line">      var instanceData = typeof childVal === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? childVal.call(vm, vm)</span><br><span class="line">        : childVal;</span><br><span class="line">      var defaultData = typeof parentVal === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">        ? parentVal.call(vm, vm)</span><br><span class="line">        : parentVal;</span><br><span class="line">      <span class="keyword">if</span> (instanceData) &#123;</span><br><span class="line">        <span class="built_in">return</span> mergeData(instanceData, defaultData)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">return</span> defaultData</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>接下来看mergeData,如果子级没有key,则把父级的key给子级赋值，如果父级和子级都是对象，则调用mergeData，最终作用就是把父级有，子级没有的拷贝，其他不做处理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> mergeData (to, from) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!from) &#123; <span class="built_in">return</span> to &#125;</span><br><span class="line">  var key, toVal, fromVal;</span><br><span class="line">  var keys = Object.keys(from);</span><br><span class="line">  <span class="keyword">for</span> (var i = 0; i &lt; keys.length; i++) &#123;</span><br><span class="line">    key = keys[i];</span><br><span class="line">    toVal = to[key];</span><br><span class="line">    fromVal = from[key];</span><br><span class="line">    <span class="keyword">if</span> (!hasOwn(to, key)) &#123;</span><br><span class="line">      <span class="built_in">set</span>(to, key, fromVal);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isPlainObject(toVal) &amp;&amp; isPlainObject(fromVal)) &#123;</span><br><span class="line">      mergeData(toVal, fromVal);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> to</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="hooks钩子"><a href="#hooks钩子" class="headerlink" title="hooks钩子"></a>hooks钩子</h3><p>子级存在，如果父级存在，使用concat将子级合并到父级数组里，如果不存在，判断子级是不是数组，如果是返回子级，否，返回[ 子级 ]<br>子级不存在，返回父级</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var LIFECYCLE_HOOKS = [<span class="string">&#x27;beforeCreate&#x27;</span>,<span class="string">&#x27;created&#x27;</span>,<span class="string">&#x27;beforeMount&#x27;</span>,<span class="string">&#x27;mounted&#x27;</span>,<span class="string">&#x27;beforeUpdate&#x27;</span>,<span class="string">&#x27;updated&#x27;</span>,<span class="string">&#x27;beforeDestroy&#x27;</span>,<span class="string">&#x27;destroyed&#x27;</span>,<span class="string">&#x27;activated&#x27;</span>,<span class="string">&#x27;deactivated&#x27;</span>,<span class="string">&#x27;errorCaptured&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> mergeHook (</span><br><span class="line">  parentVal: ?Array&lt;Function&gt;,</span><br><span class="line">  childVal: ?Function | ?Array&lt;Function&gt;</span><br><span class="line">): ?Array&lt;Function&gt; &#123;</span><br><span class="line">  <span class="built_in">return</span> childVal</span><br><span class="line">    ? parentVal</span><br><span class="line">      ? parentVal.concat(childVal)</span><br><span class="line">      : Array.isArray(childVal)</span><br><span class="line">        ? childVal</span><br><span class="line">        : [childVal]</span><br><span class="line">    : parentVal</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LIFECYCLE_HOOKS.forEach(hook =&gt; &#123;</span><br><span class="line">  strats[hook] = mergeHook</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="components-directives-filters"><a href="#components-directives-filters" class="headerlink" title="components,directives,filters"></a>components,directives,filters</h3><p>extend函数就是一个复制的函数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">var ASSET_TYPES = [</span><br><span class="line">  <span class="string">&#x27;component&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;directive&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;filter&#x27;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> assertObjectType (name, value, vm) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!isPlainObject(value)) &#123;</span><br><span class="line">    warn<span class="variable">$1</span>(</span><br><span class="line">      <span class="string">&quot;Invalid value for option \&quot;&quot;</span> + name + <span class="string">&quot;\&quot;: expected an Object, &quot;</span> +</span><br><span class="line">      <span class="string">&quot;but got &quot;</span> + (toRawType(value)) + <span class="string">&quot;.&quot;</span>,</span><br><span class="line">      vm</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> extend (to, _from) &#123;</span><br><span class="line">  <span class="keyword">for</span> (var key <span class="keyword">in</span> _from) &#123;</span><br><span class="line">    to[key] = _from[key];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> to</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> mergeAssets (</span><br><span class="line">  parentVal,</span><br><span class="line">  childVal,</span><br><span class="line">  vm,</span><br><span class="line">  key</span><br><span class="line">) &#123;</span><br><span class="line">  var res = Object.create(parentVal || null); //新建一个以父级为原型的函数</span><br><span class="line">  <span class="keyword">if</span> (childVal) &#123;</span><br><span class="line">    //如果子级有值，就把子级的值复制到res中，childVal必须是一个对象，否则报错</span><br><span class="line">    process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; assertObjectType(key, childVal, vm);</span><br><span class="line">    <span class="built_in">return</span> extend(res, childVal)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ASSET_TYPES.forEach(<span class="keyword">function</span> (<span class="built_in">type</span>) &#123;</span><br><span class="line">  strats[<span class="built_in">type</span> + <span class="string">&#x27;s&#x27;</span>] = mergeAssets;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h3><p>返回ret:{key:[…parent,…child]},每个key的值最后都是一个数组，这个数组里面注册着父子中定义的所有同属性的回调函数。而且执行顺序是父亲先孩子后</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">strats.watch = <span class="keyword">function</span> (</span><br><span class="line">  parentVal,</span><br><span class="line">  childVal,</span><br><span class="line">  vm,</span><br><span class="line">  key</span><br><span class="line">) &#123;</span><br><span class="line">  //看不懂</span><br><span class="line">  <span class="keyword">if</span> (parentVal === nativeWatch) &#123; parentVal = undefined; &#125;</span><br><span class="line">  <span class="keyword">if</span> (childVal === nativeWatch) &#123; childVal = undefined; &#125;</span><br><span class="line">  //子级不存在，以父级为原型创建对象</span><br><span class="line">  <span class="keyword">if</span> (!childVal) &#123; <span class="built_in">return</span> Object.create(parentVal || null) &#125;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    assertObjectType(key, childVal, vm);</span><br><span class="line">  &#125;</span><br><span class="line">  //父级不存在，直接返回子级</span><br><span class="line">  <span class="keyword">if</span> (!parentVal) &#123; <span class="built_in">return</span> childVal &#125;</span><br><span class="line">  //都存在的情况，首先将父级的值复制到ret中</span><br><span class="line">  var ret = &#123;&#125;;</span><br><span class="line">  extend(ret, parentVal);</span><br><span class="line">  <span class="keyword">for</span> (var key<span class="variable">$1</span> <span class="keyword">in</span> childVal) &#123;</span><br><span class="line">    //遍历子级元素，如果父级有值（不是数组就使用[]进行包装），最后使用concat合并子级，否则返回子级</span><br><span class="line">    var parent = ret[key<span class="variable">$1</span>];</span><br><span class="line">    var child = childVal[key<span class="variable">$1</span>];</span><br><span class="line">    <span class="keyword">if</span> (parent &amp;&amp; !Array.isArray(parent)) &#123;</span><br><span class="line">      parent = [parent];</span><br><span class="line">    &#125;</span><br><span class="line">    ret[key<span class="variable">$1</span>] = parent</span><br><span class="line">      ? parent.concat(child)</span><br><span class="line">      : Array.isArray(child) ? child : [child];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> ret</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="props-methods-inject-computed"><a href="#props-methods-inject-computed" class="headerlink" title="props ,methods,inject,computed"></a>props ,methods,inject,computed</h3><p> extend(ret, parentVal),extend(ret, childVal)，将父级子级分别复制到ret中，返回ret，子组件会覆盖父组件的值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">strats.props =</span><br><span class="line">strats.methods =</span><br><span class="line">strats.inject =</span><br><span class="line">strats.computed = <span class="keyword">function</span> (</span><br><span class="line">  parentVal,</span><br><span class="line">  childVal,</span><br><span class="line">  vm,</span><br><span class="line">  key</span><br><span class="line">) &#123;</span><br><span class="line">  <span class="keyword">if</span> (childVal &amp;&amp; process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    assertObjectType(key, childVal, vm);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!parentVal) &#123; <span class="built_in">return</span> childVal &#125;</span><br><span class="line">  var ret = Object.create(null);</span><br><span class="line">  extend(ret, parentVal);</span><br><span class="line">  <span class="keyword">if</span> (childVal) &#123; extend(ret, childVal); &#125;</span><br><span class="line">  <span class="built_in">return</span> ret</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="provide"><a href="#provide" class="headerlink" title="provide"></a>provide</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strats.provide = mergeDataOrFn;</span><br></pre></td></tr></table></figure>

<h3 id="看下strats是什么"><a href="#看下strats是什么" class="headerlink" title="看下strats是什么"></a>看下strats是什么</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const options = &#123;&#125;</span><br><span class="line"><span class="built_in">let</span> key</span><br><span class="line"><span class="keyword">for</span> (key <span class="keyword">in</span> parent) &#123;</span><br><span class="line">  mergeField(key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (key <span class="keyword">in</span> child) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!hasOwn(parent, key)) &#123;</span><br><span class="line">    mergeField(key)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> mergeField (key) &#123;</span><br><span class="line">  const strat = strats[key] || defaultStrat</span><br><span class="line">  options[key] = strat(parent[key], child[key], vm, key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">return</span> option</span><br></pre></td></tr></table></figure>
<h3 id="mergeOptions"><a href="#mergeOptions" class="headerlink" title="mergeOptions"></a>mergeOptions</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> <span class="keyword">function</span> mergeOptions (</span><br><span class="line">  parent: Object,</span><br><span class="line">  child: Object,</span><br><span class="line">  vm?: Component</span><br><span class="line">): Object &#123;</span><br><span class="line">  //检测子级是不是组件</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    checkComponents(child)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 在global-api.js中，Vue.options = Object.create(null) 有对options进行初始化</span><br><span class="line">  <span class="keyword">if</span> (typeof child === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">    child = child.options</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  normalizeProps(child, vm)</span><br><span class="line">  normalizeInject(child, vm)</span><br><span class="line">  normalizeDirectives(child)</span><br><span class="line">  //没看懂</span><br><span class="line">  <span class="keyword">if</span> (!child._base) &#123;</span><br><span class="line">    <span class="keyword">if</span> (child.extends) &#123;</span><br><span class="line">      parent = mergeOptions(parent, child.extends, vm)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (child.mixins) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">let</span> i = 0, l = child.mixins.length; i &lt; l; i++) &#123;</span><br><span class="line">        parent = mergeOptions(parent, child.mixins[i], vm)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const options = &#123;&#125;</span><br><span class="line">  <span class="built_in">let</span> key</span><br><span class="line">  <span class="keyword">for</span> (key <span class="keyword">in</span> parent) &#123;</span><br><span class="line">    mergeField(key)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (key <span class="keyword">in</span> child) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!hasOwn(parent, key)) &#123;</span><br><span class="line">      mergeField(key)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> mergeField (key) &#123;</span><br><span class="line">    const strat = strats[key] || defaultStrat</span><br><span class="line">    options[key] = strat(parent[key], child[key], vm, key)</span><br><span class="line">  &#125;</span><br><span class="line">  /**</span><br><span class="line">  strats[key]是特定的策略合并函数，如果没有，就使用默认的策略合并函数</span><br><span class="line">  options[key] 是执行特定策略函数得到的结果</span><br><span class="line">  mergeOptions的作用 : 如果child有extends或mixins，合并得到新的parent，</span><br><span class="line">  声明一个options为空对象，遍历parent，执行mergeField(key)，就是得到这个key的策略合并函数，并将执行结果赋值给options【key】 </span><br><span class="line">  如果parent已经存在key，child 就不调用，避免重复调用</span><br><span class="line">  最终的接口就是options将parent和child的key进行合并</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line">  <span class="built_in">return</span> options</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>normalizeProps做的事情，检测props是不是数组，是数组的话说明存的是prop的名字，使用camelize(val)转驼峰，结果为[name]:{ type: null };<br>如果props是个对象，遍历，检测prop是不是对象，不是的话转为对象[name]:{type:val},是的话不做处理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> normalizeProps (options: Object, vm: ?Component) &#123;</span><br><span class="line">  const props = options.props</span><br><span class="line">  <span class="keyword">if</span> (!props) <span class="built_in">return</span></span><br><span class="line">  const res = &#123;&#125;</span><br><span class="line">  <span class="built_in">let</span> i, val, name</span><br><span class="line">  <span class="keyword">if</span> (Array.isArray(props)) &#123;</span><br><span class="line">    i = props.length</span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      val = props[i]</span><br><span class="line">      <span class="keyword">if</span> (typeof val === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        name = camelize(val)</span><br><span class="line">        res[name] = &#123; <span class="built_in">type</span>: null &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">        warn(<span class="string">&#x27;props must be strings when using array syntax.&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isPlainObject(props)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (const key <span class="keyword">in</span> props) &#123;</span><br><span class="line">      val = props[key]</span><br><span class="line">      name = camelize(key)</span><br><span class="line">      res[name] = isPlainObject(val)</span><br><span class="line">        ? val</span><br><span class="line">        : &#123; <span class="built_in">type</span>: val &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">   ...</span><br><span class="line">  &#125;</span><br><span class="line">  options.props = res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>normalizeInject做的事情，定义normalized={},如果options.inject是个数组，normalized[name]= {from:name},如果inject是个对象，判断每一项的值是不是对象，如果是对象，合并{from:key}和val，最后得到的是normalized[name]={from:key, …val},如果val是简单类型的值，得到normalized[name] = {from:val}</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> normalizeInject (options: Object, vm: ?Component) &#123;</span><br><span class="line">  const inject = options.inject</span><br><span class="line">  <span class="keyword">if</span> (!inject) <span class="built_in">return</span></span><br><span class="line">  const normalized = options.inject = &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (Array.isArray(inject)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">let</span> i = 0; i &lt; inject.length; i++) &#123;</span><br><span class="line">      normalized[inject[i]] = &#123; from: inject[i] &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isPlainObject(inject)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (const key <span class="keyword">in</span> inject) &#123;</span><br><span class="line">      const val = inject[key]</span><br><span class="line">      normalized[key] = isPlainObject(val)</span><br><span class="line">        ? extend(&#123; from: key &#125;, val)</span><br><span class="line">        : &#123; from: val &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    warn(</span><br><span class="line">      `Invalid value <span class="keyword">for</span> option <span class="string">&quot;inject&quot;</span>: expected an Array or an Object, ` +</span><br><span class="line">      `but got <span class="variable">$&#123;toRawType(inject)&#125;</span>.`,</span><br><span class="line">      vm</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>normalizeDirectives做的事情，转换成对象，就是把val 转换成 {bind:val,update:val}</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> normalizeDirectives (options: Object) &#123;</span><br><span class="line">  const <span class="built_in">dirs</span> = options.directives</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">dirs</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (const key <span class="keyword">in</span> <span class="built_in">dirs</span>) &#123;</span><br><span class="line">      const def = <span class="built_in">dirs</span>[key]</span><br><span class="line">      <span class="keyword">if</span> (typeof def === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        <span class="built_in">dirs</span>[key] = &#123; <span class="built_in">bind</span>: def, update: def &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="nextTick"><a href="#nextTick" class="headerlink" title="$nextTick"></a>$nextTick</h2><p>在下次dom更新之后执行回调，确保拿到的是dom最新的值 因为dom是异步更新</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/07/08/Vue/">
    <time datetime="2021-07-08T02:22:40.000Z" class="entry-date">
        2021-07-08
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-浏览器" class="post-浏览器 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/07/07/%E6%B5%8F%E8%A7%88%E5%99%A8/">浏览器</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/07/07/%E6%B5%8F%E8%A7%88%E5%99%A8/" data-id="ckxmsj7ln000kou0s8o1f9ewb" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h2 id="URLSearchParams"><a href="#URLSearchParams" class="headerlink" title="URLSearchParams"></a>URLSearchParams</h2><p>浏览器内置链接参数操作工具 </p>
<p>如何使用？<br><img src="/2021/07/07/%E6%B5%8F%E8%A7%88%E5%99%A8/URLSP"></p>
<p>判断某一参数是否存在</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchParams.has(<span class="string">&#x27;processInstanceId&#x27;</span>) &gt; <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>get 获取参数的值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchParams.get(<span class="string">&#x27;processInstanceId&#x27;</span>) &gt; 37749504</span><br></pre></td></tr></table></figure>
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/07/07/%E6%B5%8F%E8%A7%88%E5%99%A8/">
    <time datetime="2021-07-07T08:39:16.000Z" class="entry-date">
        2021-07-07
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-axios学习笔记" class="post-axios学习笔记 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">axios学习笔记</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="ckxmsj7lb0002ou0septf60tw" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <h1 id="查找入口文件"><a href="#查找入口文件" class="headerlink" title="查找入口文件"></a>查找入口文件</h1><p><img src="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/package.png"></p>
<h1 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a>index.js</h1><p><img src="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/indexjs.png"></p>
<h1 id="找到lib-axios-js"><a href="#找到lib-axios-js" class="headerlink" title="找到lib/axios.js"></a>找到lib/axios.js</h1><p>为了避免迷糊，先放一段defaultConfig的伪代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> defaultConfig = &#123;</span><br><span class="line">      baseURL,</span><br><span class="line">      timeout: TIMEOUT_MILLISECONDS,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      params: payLoadParams</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>进入文件倒数第二行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">module.exports = axios;</span><br></pre></td></tr></table></figure>
<p>可知axios文件输出axios，axios = createInstance(defaults)，看下createInstance内部做了什么</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> createInstance(defaultConfig) &#123;</span><br><span class="line">  var context = new Axios(defaultConfig);</span><br><span class="line">  var instance = <span class="built_in">bind</span>(Axios.prototype.request, context);</span><br><span class="line">  utils.extend(instance, Axios.prototype, context);</span><br><span class="line">  utils.extend(instance, context);</span><br><span class="line">   <span class="built_in">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解释一下上面的代码 ： </p>
<p>第一行： var context = new Axios(defaultConfig),</p>
<p>得到结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">context = &#123;</span><br><span class="line">  default:defaultConfig,</span><br><span class="line">  interceptors: &#123;</span><br><span class="line">    request :  new InterCeptorManager(),</span><br><span class="line">    responese : new InterCeptorManager(),</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二行： var instance = bind(Axios.prototype.request, context);<br>先看下bind方法<br><img src="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/bind.png"><br>bind方法返回一个wrap函数，并将wrap的参数传给外层函数fn,绑定上下文context<br>执行结果为</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">instance = <span class="keyword">function</span> <span class="function"><span class="title">wrap</span></span>() &#123;</span><br><span class="line">  ... </span><br><span class="line">  <span class="built_in">return</span> Axios.prototype.request.apply(thisArg, args)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 调用instance，返回Axios.prototype.request的执行结果，并将调用instance的参数作为axios.prototype.request执行的传参</span></span><br></pre></td></tr></table></figure>
<p>第三行：utils.extend(instance, Axios.prototype, context);<br>看下extend方法<br><img src="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/extend.png"><br>代码逻辑为 ： 遍历Axios.prototype ，因为Axios.prototype上有方法request，getUri,delete,get,head,options,post,put,patch,直接执行if代码块，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">instance[<span class="string">&#x27;get&#x27;</span>] = <span class="built_in">bind</span>(Axios.prototype.get,context)</span><br><span class="line"><span class="comment"># instance.get(url,config)相当于 Axios.prototype.get(url,config)</span></span><br></pre></td></tr></table></figure>
<p>第四行：<br>utils.extend(instance, context);<br>只有两个参数，说明是要instance 复制context的属性 ， 根据上面代码所得到的context可知，<br>会得到一下结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">instance.default = context.default;</span><br><span class="line">instance.interceptor = context.interceptor;</span><br></pre></td></tr></table></figure>
<p>现在的instance 已经拥有了Axios.prototype和context的属性和方法，通过调用createInstance返回,赋值给axios。</p>
<p>可以看到context是Axios的实例，Axios 是核心 </p>
<h3 id="进入Axios-js"><a href="#进入Axios-js" class="headerlink" title="进入Axios.js"></a>进入Axios.js</h3><p> 看下Axios.prototype.request做了些什么<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (typeof config === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">   config = arguments[1] || &#123;&#125;;</span><br><span class="line">   config.url = arguments[0];</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   config = config || &#123;&#125;;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment"># 这段代码是为了支持axios(url,config)</span></span><br><span class="line"></span><br><span class="line"> config = mergeConfig(this.defaults, config);</span><br><span class="line"> <span class="comment">#  参数中config是指调用比如axios.get(condig = &#123;&#125;)的参数</span></span><br><span class="line"></span><br><span class="line"> config.method = config.method ? config.method.toLowerCase() : <span class="string">&#x27;get&#x27;</span>;</span><br><span class="line"> <span class="comment"># 指定methods或默认get</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># ！！！这儿是重点，dispatchRequest会在接下来介绍</span></span><br><span class="line"> var chain = [dispatchRequest, undefined];</span><br><span class="line"> var promise = Promise.resolve(config); <span class="comment"># 可以使用promise.then</span></span><br><span class="line"> this.interceptors.request.forEach(<span class="keyword">function</span> unshiftRequestInterceptors(interceptor) &#123;</span><br><span class="line">   chain.unshift(interceptor.fulfilled, interceptor.rejected);</span><br><span class="line"> &#125;);</span><br><span class="line"> <span class="comment"># use和forEach的代码在下面， 遍历handlers，如果值存在，就执行unshiftRequestInterceptors，参数是我们使用this.interceptors.request.use传入的值， 在chain从开始处插入interceptor.fulfilled, interceptor.rejected</span></span><br><span class="line"></span><br><span class="line"> this.interceptors.response.forEach(<span class="keyword">function</span> pushResponseInterceptors(interceptor) &#123;</span><br><span class="line">   chain.push(interceptor.fulfilled, interceptor.rejected);</span><br><span class="line"> &#125;);</span><br><span class="line"> <span class="comment"># 同上，执行pushResponseInterceptors，在chain结尾处插入interceptor.fulfilled, interceptor.rejected，此时，chain = [interceptor.fulfilled(request), interceptor.rejected(request),dispatchRequest,undefined,interceptor.fulfilled, interceptor.rejected],</span></span><br><span class="line"> <span class="keyword">while</span> (chain.length) &#123;</span><br><span class="line">   promise = promise.then(chain.shift(), chain.shift());</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment"># 首先取出index = 0,1位置的request fulfilled和rejected执行，因为是promise是链式操作，所以第一个 chain.shift() 执行要返回config作为下一步传参，第二个 chain.shift是处理异常</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment"># 定义Axios.prototype上的方法，可以通过axios[method](url,config)来调用</span></span><br><span class="line"> utils.forEach([<span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;head&#x27;</span>, <span class="string">&#x27;options&#x27;</span>], <span class="keyword">function</span> forEachMethodNoData(method) &#123;</span><br><span class="line">   Axios.prototype[method] = <span class="keyword">function</span>(url, config) &#123;</span><br><span class="line">     <span class="built_in">return</span> this.request(utils.merge(config || &#123;&#125;, &#123;</span><br><span class="line">       method: method,</span><br><span class="line">       url: url</span><br><span class="line">     &#125;));</span><br><span class="line">   &#125;;</span><br><span class="line"> &#125;);</span><br><span class="line"></span><br><span class="line"> utils.forEach([<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;put&#x27;</span>, <span class="string">&#x27;patch&#x27;</span>], <span class="keyword">function</span> forEachMethodWithData(method) &#123;</span><br><span class="line">   Axios.prototype[method] = <span class="keyword">function</span>(url, data, config) &#123;</span><br><span class="line">     <span class="built_in">return</span> this.request(utils.merge(config || &#123;&#125;, &#123;</span><br><span class="line">       method: method,</span><br><span class="line">       url: url,</span><br><span class="line">       data: data</span><br><span class="line">     &#125;));</span><br><span class="line">   &#125;;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="跳出Axios-js"><a href="#跳出Axios-js" class="headerlink" title="跳出Axios.js"></a>跳出Axios.js</h3><h3 id="请求和返回的拦截都用到了new-InterceptorManager（），-接下来看下InterceptorManager-构造函数都做了什么"><a href="#请求和返回的拦截都用到了new-InterceptorManager（），-接下来看下InterceptorManager-构造函数都做了什么" class="headerlink" title="请求和返回的拦截都用到了new InterceptorManager（）， 接下来看下InterceptorManager 构造函数都做了什么"></a>请求和返回的拦截都用到了new InterceptorManager（）， 接下来看下InterceptorManager 构造函数都做了什么</h3><h4 id="lib-core-InterceptorManager-js-【"><a href="#lib-core-InterceptorManager-js-【" class="headerlink" title="lib/core/InterceptorManager.js 【"></a>lib/core/InterceptorManager.js 【</h4> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">function</span> <span class="function"><span class="title">InterceptorManager</span></span>() &#123;</span><br><span class="line">  this.handlers = [];</span><br><span class="line">  <span class="comment"># 定义一个数组用来存放数据</span></span><br><span class="line">  InterceptorManager.prototype.use = <span class="keyword">function</span> use(fulfilled, rejected) &#123;</span><br><span class="line">  this.handlers.push(&#123;</span><br><span class="line">    fulfilled: fulfilled,</span><br><span class="line">    rejected: rejected</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">return</span> this.handlers.length - 1;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment"># 我们在项目里的写法是instance.interceptors.request.use((config) =&gt; &#123; return config&#125;) ; instance.interceptors.response.use((response) =&gt; &#123; return response&#125;,err =&gt; &#123;...&#125;) ,fulfilled, rejected分别是成功回调，失败回调,use返回值为数组最后一项，即新添加进来的回调对象</span></span><br><span class="line">  InterceptorManager.prototype.forEach = <span class="keyword">function</span> forEach(fn) &#123;</span><br><span class="line">    utils.forEach(this.handlers, <span class="keyword">function</span> forEachHandler(h) &#123;</span><br><span class="line">      <span class="keyword">if</span> (h !== null) &#123;</span><br><span class="line">        fn(h);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="跳出InterceptorManager-js-】"><a href="#跳出InterceptorManager-js-】" class="headerlink" title="跳出InterceptorManager.js  】"></a>跳出InterceptorManager.js  】</h4><h4 id="dispatchRequest-【"><a href="#dispatchRequest-【" class="headerlink" title="dispatchRequest 【"></a>dispatchRequest 【</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">throwIfCancellationRequested(config);</span><br><span class="line"><span class="comment"># 如果设置了config.cancelToken，且有中断原因，抛出</span></span><br><span class="line"><span class="keyword">if</span> (config.baseURL &amp;&amp; !isAbsoluteURL(config.url)) &#123;</span><br><span class="line">  config.url = combineURLs(config.baseURL, config.url);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#  如果URL不是绝对路径，合并url</span></span><br><span class="line">config.headers = config.headers || &#123;&#125;;</span><br><span class="line">config.data = transformData(</span><br><span class="line">    config.data,</span><br><span class="line">    config.headers,</span><br><span class="line">    config.transformRequest</span><br><span class="line">  );</span><br><span class="line">config.headers = utils.merge(</span><br><span class="line">    config.headers.common || &#123;&#125;,</span><br><span class="line">    config.headers[config.method] || &#123;&#125;,</span><br><span class="line">    config.headers || &#123;&#125;</span><br><span class="line">  ); </span><br><span class="line">  <span class="comment"># 合并request config传入的headers.common和headers[&#x27;method&#x27;]，headers</span></span><br><span class="line">  utils.forEach(</span><br><span class="line">    [<span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;head&#x27;</span>, <span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;put&#x27;</span>, <span class="string">&#x27;patch&#x27;</span>, <span class="string">&#x27;common&#x27;</span>],</span><br><span class="line">    <span class="keyword">function</span> cleanHeaderConfig(method) &#123;</span><br><span class="line">      delete config.headers[method];</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  <span class="comment"># 因为已经将 config.headers[method]的值合并到config.headers ,所以删除config.headers[method]，避免出现config.headers.get 依然存在的现象</span></span><br><span class="line"></span><br><span class="line"> var adapter = config.adapter || defaults.adapter; <span class="comment"># </span></span><br><span class="line"> <span class="comment"># adapter后面会介绍default.js文件会介绍</span></span><br><span class="line"> <span class="built_in">return</span> adapter(config).<span class="keyword">then</span>(response =&gt; &#123;</span><br><span class="line">  根据transformResponse对response.data 进行转换 </span><br><span class="line">  <span class="built_in">return</span> response </span><br><span class="line"> &#125;,err =&gt; &#123;</span><br><span class="line"></span><br><span class="line"> &#125;)</span><br><span class="line"><span class="comment">#  config是从interceptor.resolve() return出来的，adapter(config)会发送请求，定义response，通过return new Promise((resolve) =&gt; &#123;resolve(response)&#125;)</span></span><br><span class="line"><span class="comment">#  将response返回给后面的链接</span></span><br></pre></td></tr></table></figure>
<h4 id="跳出dispatchRequest】"><a href="#跳出dispatchRequest】" class="headerlink" title="跳出dispatchRequest】"></a>跳出dispatchRequest】</h4><p>接着看axios.js中的代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var axios = createInstance(defaults);</span><br><span class="line">axios.Axios = Axios;</span><br><span class="line">axios.Cancel = require(<span class="string">&#x27;./cancel/Cancel&#x27;</span>);</span><br><span class="line">axios.CancelToken = require(<span class="string">&#x27;./cancel/CancelToken&#x27;</span>);</span><br><span class="line">axios.isCancel = require(<span class="string">&#x27;./cancel/isCancel&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>defaults就是defaultConfig，defaults引自require(‘./defaults’) ，</p>
<h3 id="进入axios-lib-defaults-js【"><a href="#进入axios-lib-defaults-js【" class="headerlink" title="进入axios/lib/defaults.js【"></a>进入axios/lib/defaults.js【</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">var DEFAULT_CONTENT_TYPE = &#123;</span><br><span class="line">  <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line">default = &#123;</span><br><span class="line">  <span class="comment"># 适配器。代码在下面</span></span><br><span class="line">  adapter : getDefaultAdapter(),</span><br><span class="line">  transformRequest:[f()], <span class="comment"># 这两个我还没看懂是怎么个用法</span></span><br><span class="line">  transformResponse:[f()],</span><br><span class="line">  timeout：0,</span><br><span class="line">  xsrfCookieName: <span class="string">&#x27;XSRF-TOKEN&#x27;</span>,</span><br><span class="line">  xsrfHeaderName: <span class="string">&#x27;X-XSRF-TOKEN&#x27;</span>,</span><br><span class="line">  maxContentLength: -1,</span><br><span class="line">  validateStatus: <span class="keyword">function</span> validateStatus(status) &#123;</span><br><span class="line">    <span class="built_in">return</span> status &gt;= 200 &amp;&amp; status &lt; 300;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># 响应状态</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">getDefaultAdapter</span></span>() &#123;</span><br><span class="line">  var adapter;</span><br><span class="line">  <span class="comment"># adapter适配器，根据nodejs 和浏览器环境，分别使用http 和xhr进行请求</span></span><br><span class="line">  <span class="keyword">if</span> (typeof process !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; Object.prototype.toString.call(process) === <span class="string">&#x27;[object process]&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment"># For node use HTTP adapter</span></span><br><span class="line">    adapter = require(<span class="string">&#x27;./adapters/http&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeof XMLHttpRequest !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment"># For browsers use XHR adapter</span></span><br><span class="line">    adapter = require(<span class="string">&#x27;./adapters/xhr&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> adapter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defaults.headers = &#123;</span><br><span class="line">  common: &#123;</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">utils.forEach([<span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;head&#x27;</span>], <span class="keyword">function</span> forEachMethodNoData(method) &#123;</span><br><span class="line">  defaults.headers[method] = &#123;&#125;;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment"># &#x27;delete&#x27;, &#x27;get&#x27;, &#x27;head&#x27;为&#123;&#125;</span></span><br><span class="line"></span><br><span class="line">utils.forEach([<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;put&#x27;</span>, <span class="string">&#x27;patch&#x27;</span>], <span class="keyword">function</span> forEachMethodWithData(method) &#123;</span><br><span class="line">  defaults.headers[method] = utils.merge(DEFAULT_CONTENT_TYPE);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment"># post , put,patch 默认请求头为&#123;&#x27;Content-Type&#x27;: &#x27;application/x-www-form-urlencoded&#x27;&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>着重看下adapter = require(‘./adapters/xhr’);</p>
<h4 id="进入axios-lib-adapters-xhr-js【"><a href="#进入axios-lib-adapters-xhr-js【" class="headerlink" title="进入axios/lib/adapters/xhr.js【"></a>进入axios/lib/adapters/xhr.js【</h4><p>xhrAdapter 返回一个promise函数，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">var requestData = config.data;</span><br><span class="line"><span class="keyword">if</span> (utils.isFormData(requestData)) &#123;</span><br><span class="line">  delete requestHeaders[<span class="string">&#x27;Content-Type&#x27;</span>];</span><br><span class="line">  <span class="comment"># 如果是FormData格式，删除Content-Type，由浏览器赋值</span></span><br><span class="line">&#125;</span><br><span class="line">var request = new XMLHttpRequest();</span><br><span class="line"><span class="comment"># XMLHttpRequest在其他文章里可以查看，是浏览器内置构造函数</span></span><br><span class="line"><span class="comment"># open方法三个参数分别为：请求方法,url,是否异步</span></span><br><span class="line">request.open(config.method.toUpperCase(), buildURL(config.url, config.params, config.paramsSerializer), <span class="literal">true</span>);</span><br><span class="line">var responseHeaders = <span class="string">&#x27;getAllResponseHeaders&#x27;</span> <span class="keyword">in</span> request ? parseHeaders(request.getAllResponseHeaders()) : null;</span><br><span class="line">var responseData = !config.responseType || config.responseType === <span class="string">&#x27;text&#x27;</span> ? request.responseText : request.response;</span><br><span class="line">request.onreadystatechange = <span class="function"><span class="title">f</span></span>()&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment"># 定义了response</span></span><br><span class="line">  var response = &#123;</span><br><span class="line">    data: responseData,</span><br><span class="line">    status: request.status,</span><br><span class="line">    statusText: request.statusText,</span><br><span class="line">    headers: responseHeaders,</span><br><span class="line">    config: config,</span><br><span class="line">    request: request</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">settle(resolve, reject, response);</span><br><span class="line"><span class="comment"># 设置响应状态，是resolve(response) 还是抛出异常，settle代码在下面</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#处理请求并抛出异常，将request设为null</span></span><br><span class="line">request.onabort  = f()</span><br><span class="line">request.onerror  = f()</span><br><span class="line">request.ontimeout  = f() </span><br><span class="line"></span><br><span class="line"><span class="comment">#用户设置config.cancelToken，来中断请求</span></span><br><span class="line"><span class="keyword">if</span> (config.cancelToken) &#123;</span><br><span class="line">// Handle cancellation</span><br><span class="line">  config.cancelToken.promise.then(<span class="keyword">function</span> onCanceled(cancel) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!request) &#123;</span><br><span class="line">      <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request.abort();</span><br><span class="line">    reject(cancel);</span><br><span class="line">    // Clean up request</span><br><span class="line">    request = null;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#发送请求</span></span><br><span class="line">request.send(requestData); </span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">module.exports = <span class="keyword">function</span> settle(resolve, reject, response) &#123;</span><br><span class="line">  var validateStatus = response.config.validateStatus;</span><br><span class="line">  <span class="keyword">if</span> (!validateStatus || validateStatus(response.status)) &#123;</span><br><span class="line">    resolve(response);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject(createError(</span><br><span class="line">      <span class="string">&#x27;Request failed with status code &#x27;</span> + response.status,</span><br><span class="line">      response.config,</span><br><span class="line">      null,</span><br><span class="line">      response.request,</span><br><span class="line">      response</span><br><span class="line">    ));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/response.png"><br>可以看到request.onreadystatechange 里面定义了response的内容，和接口返回的response是一样的构造,然后根据response.connfig.validateStatus(status &gt;= 200 &amp;&amp; status &lt; 300)设置响应状态是resolve(response) 还是报错</p>
<h4 id="跳出xhr-js】"><a href="#跳出xhr-js】" class="headerlink" title="跳出xhr.js】"></a>跳出xhr.js】</h4><h3 id="跳出default-js】"><a href="#跳出default-js】" class="headerlink" title="跳出default.js】"></a>跳出default.js】</h3><p>接着看axios.js中的代码<br>在代码中，出现Cancel，CancelToken，isCancel，首先我们进入文件看下这三个到底是什么<br>cancel是一个相对简单的类，是用于抛出取消请求返回的信息<br><img src="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/cancel.png"><br>cancelToken是可用于请求取消操作的对象。<br><img src="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/cancelToken.png"><br>首先cancelToken的参数executor必须是一个函数，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var resolvePromise;</span><br><span class="line">this.promise = new Promise(<span class="keyword">function</span> promiseExecutor(resolve) &#123;</span><br><span class="line">  resolvePromise = resolve;</span><br><span class="line">&#125;);</span><br><span class="line">executor(<span class="keyword">function</span> cancel(message) &#123;</span><br><span class="line">    <span class="keyword">if</span> (token.reason) &#123;</span><br><span class="line">      // Cancellation has already been requested</span><br><span class="line">      <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    token.reason = new Cancel(message); = &#123;message : <span class="string">&#x27;...&#x27;</span>&#125;</span><br><span class="line">    resolvePromise(token.reason);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>使得resolve可以在外部被执行,resolvePromise().then，下面代码摘自xhr.js,<br>当config.cancelToken为true，通过 request.abort()终止请求，并且抛出终止信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (config.cancelToken) &#123;</span><br><span class="line">  // Handle cancellation</span><br><span class="line">  config.cancelToken.promise.then(<span class="keyword">function</span> onCanceled(cancel) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!request) &#123;</span><br><span class="line">      <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    request.abort();</span><br><span class="line">    reject(cancel);</span><br><span class="line">    // Clean up request</span><br><span class="line">    request = null;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>config.cancelToken.promise.then()要求用户设置config.cancelToken 必须是CancelToken的实例，才能调用promise,所以</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> cancel </span><br><span class="line">config.cancelToken = new cancelToken(<span class="keyword">function</span> e(c) &#123;</span><br><span class="line">  cancel = c</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>在接口被第一次请求的时候，用cancel保存中止函数，当需要进行中止操作，比如重复请求，调用cancel</p>
<p>一般我们应用的场景是当在接口还没返回，重复请求，取消之前请求，保留最后一个请求，如何做到判断一个接口还没请求完，开始了第二次请求</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/06/29/axios%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
    <time datetime="2021-06-29T08:38:00.000Z" class="entry-date">
        2021-06-29
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-js方法" class="post-js方法 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/06/16/js%E6%96%B9%E6%B3%95/">js方法</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/06/16/js%E6%96%B9%E6%B3%95/" data-id="ckxmsj7ld0004ou0sas1v8s61" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        
      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/06/16/js%E6%96%B9%E6%B3%95/">
    <time datetime="2021-06-16T10:14:18.000Z" class="entry-date">
        2021-06-16
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-XMLHttpRequest" class="post-XMLHttpRequest post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/06/16/XMLHttpRequest/">XMLHttpRequest</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/06/16/XMLHttpRequest/" data-id="ckxmsj7la0001ou0shxa206yz" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>概念：浏览器通过XMLHttpRequest对象进行http通信，换句话说，我们通过XMLHttpRequest对象来发送Ajax请求</p>
<p>详解地址 (<a target="_blank" rel="noopener" href="https://www.w3school.com.cn/xmldom/dom_http.asp">https://www.w3school.com.cn/xmldom/dom_http.asp</a>)</p>
<p>如何判断某网站应用了http/2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">    // 保证这个方法只在支持loadTimes的chrome浏览器下执行</span><br><span class="line">    <span class="keyword">if</span>(window.chrome &amp;&amp; typeof chrome.loadTimes === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">        var loadTimes = window.chrome.loadTimes();</span><br><span class="line">        var spdy = loadTimes.wasFetchedViaSpdy;</span><br><span class="line">        var info = loadTimes.npnNegotiatedProtocol || loadTimes.connectionInfo;</span><br><span class="line">        // 就以 「h2」作为判断标识</span><br><span class="line">        <span class="keyword">if</span>(spdy &amp;&amp; /^h2/i.test(info)) &#123;</span><br><span class="line">            <span class="built_in">return</span> console.info(<span class="string">&#x27;本站点使用了HTTP/2&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    console.warn(<span class="string">&#x27;本站点没有使用HTTP/2&#x27;</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>


      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/06/16/XMLHttpRequest/">
    <time datetime="2021-06-16T09:31:21.000Z" class="entry-date">
        2021-06-16
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-queryString" class="post-queryString post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/05/12/queryString/">queryString</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/05/12/queryString/" data-id="ckxmsj7lf0007ou0scl8k8g5l" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>如何在复杂的路径中分离出query的值</p>
<p>比如遇到了 ‘<a target="_blank" rel="noopener" href="http://xxx/xxx/?code=xx&amp;state=null#/flow/contract-renewal/index?processType=empRenewContractProcess&#39;">http://xxx/xxx/?code=xx&amp;state=null#/flow/contract-renewal/index?processType=empRenewContractProcess&#39;</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> reg = new Reg(<span class="string">&#x27;(^|&amp;)&#x27;</span>+name+<span class="string">&#x27;=([^&amp;#]*)(&amp;|$)&#x27;</span>,<span class="string">&#x27;i&#x27;</span>)</span><br></pre></td></tr></table></figure>



      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/05/12/queryString/">
    <time datetime="2021-05-12T12:08:24.000Z" class="entry-date">
        2021-05-12
    </time>
</a>
    
    
    </footer>
</article>






  
    <article id="post-内存和硬盘的区别" class="post-内存和硬盘的区别 post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title">
      <a class="article-title" href="/2021/05/01/%E5%86%85%E5%AD%98%E5%92%8C%E7%A1%AC%E7%9B%98%E7%9A%84%E5%8C%BA%E5%88%AB/">内存和硬盘的区别</a>
    </h1>
  

        
        <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="http://example.com/2021/05/01/%E5%86%85%E5%AD%98%E5%92%8C%E7%A1%AC%E7%9B%98%E7%9A%84%E5%8C%BA%E5%88%AB/" data-id="ckxmsj7lk000eou0s9545bz5i" class="leave-reply bdsharebuttonbox" data-cmd="more">Share</a>
        </div><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
        <p>1.性质不同<br>内存（RAM random随机 access访问，存取（电脑文档）memory ）是计算机的工作场所 ，是与CPU直接交换数据的内存存储器，可以随时读写，作为运行中的机器临时数据存储介质<br>硬盘（ROM Read-Only Memory 固定存储器）是用来存放暂时不用的东西,只能读出无法写入信息</p>
<p>2.制作材料不同</p>
<p>内存是半导体材料制作，硬盘是磁性材料制作</p>
<p>3.内存中的信息会随电而丢失，硬盘中信息长期保存</p>
<p>4.硬盘容量比较大，内存容量比较小</p>
<p>5.内存是CPU和硬盘数据之间的缓冲，CPU只能读取内存中的数据，CPU是计算机运算核心，负责读取指令，执行指令，是信息处理，程序运行的执行单元</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2021/05/01/%E5%86%85%E5%AD%98%E5%92%8C%E7%A1%AC%E7%9B%98%E7%9A%84%E5%8C%BA%E5%88%AB/">
    <time datetime="2021-05-01T02:31:52.000Z" class="entry-date">
        2021-05-01
    </time>
</a>
    
    
    </footer>
</article>






  
  
    <nav id="pagination">
      <nav id="page-nav">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
      </nav>
    </nav>
  

</div></div>
        <div id="secondary" class="widget-area" role="complementary">
  
    <aside id="search" class="widget widget_search"><form role="search" method="get" accept-charset="utf-8" id="searchform" class="searchform" action="//google.com/search">
    <div>
        <input type="text" value="" name="s" id="s" />
        <input type="submit" id="searchsubmit" value="搜索" />
    </div>
</form></aside>
  
    
  
    
  
    
  <aside class="widget">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-content">
      <ul>
        
          <li>
            <a href="/2021/11/06/%E7%BC%96%E7%A8%8B%E9%A2%98/">编程题</a>
          </li>
        
          <li>
            <a href="/2021/07/30/%E8%87%AA%E5%8A%A8%E5%8C%96%E7%94%9F%E6%88%90%E9%A1%B5%E9%9D%A2%E6%A8%A1%E6%9D%BF/">自动化生成页面模板</a>
          </li>
        
          <li>
            <a href="/2021/07/27/vue%E6%B7%BB%E5%8A%A0%E5%85%A8%E5%B1%80%E6%B0%B4%E5%8D%B0/">vue添加全局水印</a>
          </li>
        
          <li>
            <a href="/2021/07/08/Vue/">Vue</a>
          </li>
        
          <li>
            <a href="/2021/07/07/%E6%B5%8F%E8%A7%88%E5%99%A8/">浏览器</a>
          </li>
        
      </ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-content">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI/" rel="tag">UI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-content tagcloud">
      <a href="/tags/UI/" style="font-size: 10px;">UI</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/vue/" style="font-size: 20px;">vue</a>
    </div>
  </aside>

  
</div>
      </div>
      <footer id="colophon" role="contentinfo">
    <p>&copy; 2021 John Doe
    All rights reserved.</p>
    <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</footer>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/js/share.js'];</script>

<script src="/js/jquery-3.3.1.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


<script src="/js/navigation.js"></script>

<div id="bg"></div>

  </div>
</body>
</html>